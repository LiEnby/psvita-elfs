var UserInitiatedProfileName="org.webkit.profiles.user-initiated";WebInspector.ProfileType=function(a,b){this._id=a;this._name=b;this._profiles=[];this._profilesIdMap={};this.treeElement=null};WebInspector.ProfileType.Events={AddProfileHeader:"add-profile-header",RemoveProfileHeader:"remove-profile-header",ProgressUpdated:"progress-updated",ViewUpdated:"view-updated"};
WebInspector.ProfileType.prototype={statusBarItems:function(){return[]},get buttonTooltip(){return""},get id(){return this._id},get treeItemTitle(){return this._name},get name(){return this._name},buttonClicked:function(){return!1},get description(){return""},isInstantProfile:function(){return!1},getProfiles:function(){return this._profiles.filter(function(a){return!a.isTemporary})},decorationElement:function(){return null},getProfile:function(a){return this._profilesIdMap[this._makeKey(a)]},createTemporaryProfile:function(a){throw Error("Needs implemented.");
},createProfile:function(a){throw Error("Not supported for "+this._name+" profiles.");},_makeKey:function(a){return a+"/"+escape(this.id)},addProfile:function(a){this._profiles.push(a);this._profilesIdMap[this._makeKey(a.uid)]=a;this.dispatchEventToListeners(WebInspector.ProfileType.Events.AddProfileHeader,a)},removeProfile:function(a){for(var b=0;b<this._profiles.length;++b)if(this._profiles[b].uid===a.uid){this._profiles.splice(b,1);break}delete this._profilesIdMap[this._makeKey(a.uid)]},findTemporaryProfile:function(){for(var a=
0;a<this._profiles.length;++a)if(this._profiles[a].isTemporary)return this._profiles[a];return null},_reset:function(){for(var a=this._profiles.slice(0),b=0;b<a.length;++b){var c=a[b],e=c.existingView();e&&(e.detach(),"dispose"in e&&e.dispose());this.dispatchEventToListeners(WebInspector.ProfileType.Events.RemoveProfileHeader,c)}this.treeElement.removeChildren();this._profiles=[];this._profilesIdMap={}},_requestProfilesFromBackend:function(a){},_populateProfiles:function(){this._requestProfilesFromBackend(function(a,
b){if(!a){b.sort(function(a,b){return a.uid-b.uid});for(var c=b.length,e=0;e<c;++e)this.addProfile(this.createProfile(b[e]))}}.bind(this))},__proto__:WebInspector.Object.prototype};WebInspector.ProfileHeader=function(a,b,c){this._profileType=a;this.title=b;this.uid=(this.isTemporary=void 0===c)?-1:c;this._fromFile=!1};
WebInspector.ProfileHeader.prototype={profileType:function(){return this._profileType},createSidebarTreeElement:function(){throw Error("Needs implemented.");},existingView:function(){return this._view},view:function(a){this._view||(this._view=this.createView(a));return this._view},createView:function(a){throw Error("Not implemented.");},dispose:function(){},load:function(a){},canSaveToFile:function(){return!1},saveToFile:function(){throw Error("Needs implemented");},loadFromFile:function(a){throw Error("Needs implemented");
},fromFile:function(){return this._fromFile}};
WebInspector.ProfilesPanel=function(a,b){var c="undefined"!==typeof a;a=a||"profiles";WebInspector.Panel.call(this,a);this.registerRequiredCSS("panelEnablerView.css");this.registerRequiredCSS("heapProfiler.css");this.registerRequiredCSS("profilesPanel.css");this.createSidebarViewWithTree();this.profilesItemTreeElement=new WebInspector.ProfilesSidebarTreeElement(this);this.sidebarTree.appendChild(this.profilesItemTreeElement);this._singleProfileMode=c;this._profileTypesByIdMap={};var e=WebInspector.UIString("You need to enable profiling before you can use the Profiles panel."),
d=WebInspector.UIString("Enabling profiling will make scripts run slower."),f=WebInspector.UIString("Enable Profiling");this.panelEnablerView=new WebInspector.PanelEnablerView(a,e,d,f);this.panelEnablerView.addEventListener("enable clicked",this.enableProfiler,this);this.profileViews=document.createElement("div");this.profileViews.id="profile-views";this.splitView.mainElement.appendChild(this.profileViews);this._statusBarButtons=[];this.enableToggleButton=new WebInspector.StatusBarButton("","enable-toggle-status-bar-item");
Capabilities.profilerCausesRecompilation&&(this._statusBarButtons.push(this.enableToggleButton),this.enableToggleButton.addEventListener("click",this._onToggleProfiling,this));this.recordButton=new WebInspector.StatusBarButton("","record-profile-status-bar-item");this.recordButton.addEventListener("click",this.toggleRecordButton,this);this._statusBarButtons.push(this.recordButton);this.clearResultsButton=new WebInspector.StatusBarButton(WebInspector.UIString("Clear all profiles."),"clear-status-bar-item");
this.clearResultsButton.addEventListener("click",this._clearProfiles,this);this._statusBarButtons.push(this.clearResultsButton);this._profileTypeStatusBarItemsContainer=document.createElement("div");this._profileTypeStatusBarItemsContainer.className="status-bar-items";this._profileViewStatusBarItemsContainer=document.createElement("div");this._profileViewStatusBarItemsContainer.className="status-bar-items";this._profilerEnabled=!Capabilities.profilerCausesRecompilation;c?(this._launcherView=this._createLauncherView(),
this._registerProfileType(b),this._selectedProfileType=b,this._updateProfileTypeSpecificUI()):(this._launcherView=new WebInspector.MultiProfileLauncherView(this),this._launcherView.addEventListener(WebInspector.MultiProfileLauncherView.EventTypes.ProfileTypeSelected,this._onProfileTypeSelected,this),this._registerProfileType(new WebInspector.CPUProfileType),WebInspector.WorkerManager.isWorkerFrontend()||this._registerProfileType(new WebInspector.CSSSelectorProfileType),Capabilities.heapProfilerPresent&&
this._registerProfileType(new WebInspector.HeapSnapshotProfileType),!WebInspector.WorkerManager.isWorkerFrontend()&&WebInspector.experimentsSettings.canvasInspection.isEnabled()&&this._registerProfileType(new WebInspector.CanvasProfileType));this._reset();this._createFileSelectorElement();this.element.addEventListener("contextmenu",this._handleContextMenuEvent.bind(this),!0);WebInspector.ContextMenu.registerProvider(this)};
WebInspector.ProfilesPanel.prototype={_createFileSelectorElement:function(){this._fileSelectorElement&&this.element.removeChild(this._fileSelectorElement);this._fileSelectorElement=WebInspector.createFileSelectorElement(this._loadFromFile.bind(this));this.element.appendChild(this._fileSelectorElement)},_createLauncherView:function(){return new WebInspector.ProfileLauncherView(this)},_loadFromFile:function(a){if(a.name.endsWith(".heapsnapshot")){var b=this.getProfileType(WebInspector.HeapSnapshotProfileType.TypeId);
if(b.findTemporaryProfile())WebInspector.log(WebInspector.UIString("Can't load profile when other profile is recording."));else{var c=b.createTemporaryProfile(WebInspector.ProfilesPanelDescriptor.UserInitiatedProfileName+"."+a.name);b.addProfile(c);c._fromFile=!0;c.loadFromFile(a);this._createFileSelectorElement()}}else WebInspector.log(WebInspector.UIString("Only heap snapshots from files with extension '.heapsnapshot' can be loaded."))},statusBarItems:function(){return this._statusBarButtons.select("element").concat(this._profileTypeStatusBarItemsContainer,
this._profileViewStatusBarItemsContainer)},toggleRecordButton:function(){var a=this._selectedProfileType.buttonClicked();this.setRecordingProfile(this._selectedProfileType.id,a)},_populateAllProfiles:function(){if(this._profilerEnabled&&!this._profilesWereRequested){this._profilesWereRequested=!0;for(var a in this._profileTypesByIdMap)this._profileTypesByIdMap[a]._populateProfiles()}},wasShown:function(){WebInspector.Panel.prototype.wasShown.call(this);this._populateAllProfiles()},_profilerWasEnabled:function(){this._profilerEnabled||
(this._profilerEnabled=!0,this._reset(),this.isShowing()&&this._populateAllProfiles())},_profilerWasDisabled:function(){this._profilerEnabled&&(this._profilerEnabled=!1,this._reset())},_onProfileTypeSelected:function(a){this._selectedProfileType=a.data;this._updateProfileTypeSpecificUI()},_updateProfileTypeSpecificUI:function(){this.recordButton.title=this._selectedProfileType.buttonTooltip;this._profileTypeStatusBarItemsContainer.removeChildren();var a=this._selectedProfileType.statusBarItems();
if(a)for(var b=0;b<a.length;++b)this._profileTypeStatusBarItemsContainer.appendChild(a[b]);this._resize(this.splitView.sidebarWidth())},_reset:function(){WebInspector.Panel.prototype.reset.call(this);for(var a in this._profileTypesByIdMap)this._profileTypesByIdMap[a]._reset();delete this.visibleView;delete this.currentQuery;this.searchCanceled();this._profileGroups={};this._profilesWereRequested=!1;this.recordButton.toggled=!1;this._selectedProfileType&&(this.recordButton.title=this._selectedProfileType.buttonTooltip);
this._launcherView.profileFinished();this.sidebarTreeElement.removeStyleClass("some-expandable");this.profileViews.removeChildren();this._profileViewStatusBarItemsContainer.removeChildren();this.removeAllListeners();this._updateInterface();this.profilesItemTreeElement.select();this._showLauncherView()},_showLauncherView:function(){this.closeVisibleView();this._profileViewStatusBarItemsContainer.removeChildren();this._launcherView.show(this.splitView.mainElement);this.visibleView=this._launcherView},
_clearProfiles:function(){ProfilerAgent.clearProfiles();HeapProfilerAgent.clearProfiles();this._reset()},_garbageCollectButtonClicked:function(){HeapProfilerAgent.collectGarbage()},_registerProfileType:function(a){this._profileTypesByIdMap[a.id]=a;this._launcherView.addProfileType(a);a.treeElement=new WebInspector.SidebarSectionTreeElement(a.treeItemTitle,null,!0);a.treeElement.hidden=!this._singleProfileMode;this.sidebarTree.appendChild(a.treeElement);a.treeElement.childrenListElement.addEventListener("contextmenu",
this._handleContextMenuEvent.bind(this),!0);a.addEventListener(WebInspector.ProfileType.Events.ViewUpdated,this._updateProfileTypeSpecificUI,this);a.addEventListener(WebInspector.ProfileType.Events.AddProfileHeader,function(a){this._addProfileHeader(a.data)},this);a.addEventListener(WebInspector.ProfileType.Events.RemoveProfileHeader,function(a){this._removeProfileHeader(a.data)},this);a.addEventListener(WebInspector.ProfileType.Events.ProgressUpdated,function(a){this._reportProfileProgress(a.data.profile,
a.data.done,a.data.total)},this)},_handleContextMenuEvent:function(a){for(var b=a.srcElement;b&&!b.treeElement&&b!==this.element;)b=b.parentElement;if(b)if(b.treeElement&&b.treeElement.handleContextMenuEvent)b.treeElement.handleContextMenuEvent(a,this);else if(b!==this.element||a.srcElement===this.sidebarElement)b=new WebInspector.ContextMenu(a),this.visibleView instanceof WebInspector.HeapSnapshotView&&this.visibleView.populateContextMenu(b,a),b.appendItem(WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?
"Load heap snapshot\u2026":"Load Heap Snapshot\u2026"),this._fileSelectorElement.click.bind(this._fileSelectorElement)),b.show()},_makeTitleKey:function(a,b){return escape(a)+"/"+escape(b)},_addProfileHeader:function(a){a.isTemporary||this._removeTemporaryProfile(a.profileType().id);var b=a.profileType(),c=b.id,b=b.treeElement,e=b.hidden=!1,d;if(!WebInspector.ProfilesPanelDescriptor.isUserInitiatedProfile(a.title)&&!a.isTemporary){var f=this._makeTitleKey(a.title,c);f in this._profileGroups||(this._profileGroups[f]=
[]);f=this._profileGroups[f];f.push(a);if(2===f.length){f._profilesTreeElement=new WebInspector.ProfileGroupSidebarTreeElement(this,a.title);var g=b.children.indexOf(f[0]._profilesTreeElement);b.insertChild(f._profilesTreeElement,g);g=f[0]._profilesTreeElement.selected;b.removeChild(f[0]._profilesTreeElement);f._profilesTreeElement.appendChild(f[0]._profilesTreeElement);g&&f[0]._profilesTreeElement.revealAndSelect();f[0]._profilesTreeElement.small=!0;f[0]._profilesTreeElement.mainTitle=WebInspector.UIString("Run %d",
1);this.sidebarTreeElement.addStyleClass("some-expandable")}2<=f.length&&(b=f._profilesTreeElement,d=WebInspector.UIString("Run %d",f.length),e=!0)}f=a.createSidebarTreeElement();a.sidebarElement=f;f.small=e;d&&(f.mainTitle=d);a._profilesTreeElement=f;b.appendChild(f);a.isTemporary||(this.visibleView||this._showProfile(a),this.dispatchEventToListeners("profile added",{type:c}))},_removeProfileHeader:function(a){a.dispose();a.profileType().removeProfile(a);var b=a.profileType().treeElement,c=this._makeTitleKey(a.title,
a.profileType().id),e=this._profileGroups[c];if(e){e.splice(e.indexOf(a),1);if(1===e.length){var d=b.children.indexOf(e._profilesTreeElement);b.insertChild(e[0]._profilesTreeElement,d);e[0]._profilesTreeElement.small=!1;e[0]._profilesTreeElement.mainTitle=e[0].title;b.removeChild(e._profilesTreeElement)}0!==e.length?b=e._profilesTreeElement:delete this._profileGroups[c]}b.removeChild(a._profilesTreeElement);b.children.length||(this.profilesItemTreeElement.select(),this._showLauncherView(),b.hidden=
!this._singleProfileMode)},_showProfile:function(a){if(a&&!a.isTemporary){var b=a.view(this);if(b!==this.visibleView&&(this.closeVisibleView(),b.show(this.profileViews),a._profilesTreeElement._suppressOnSelect=!0,a._profilesTreeElement.revealAndSelect(),delete a._profilesTreeElement._suppressOnSelect,this.visibleView=b,this._profileViewStatusBarItemsContainer.removeChildren(),a=b.statusBarItems()))for(b=0;b<a.length;++b)this._profileViewStatusBarItemsContainer.appendChild(a[b])}},showObject:function(a,
b){for(var c=this.getProfileType(WebInspector.HeapSnapshotProfileType.TypeId).getProfiles(),e=0;e<c.length;e++){var d=c[e];if(d.maxJSObjectId>=a){this._showProfile(d);var f=d.view(this);f.changeView(b,function(){f.dataGrid.highlightObjectByHeapSnapshotId(a)});break}}},_createTemporaryProfile:function(a){a=this.getProfileType(a);a.findTemporaryProfile()||a.addProfile(a.createTemporaryProfile())},_removeTemporaryProfile:function(a){(a=this.getProfileType(a).findTemporaryProfile())&&this._removeProfileHeader(a)},
getProfile:function(a,b){return this.getProfileType(a).getProfile(b)},showView:function(a){this._showProfile(a.profile)},getProfileType:function(a){return this._profileTypesByIdMap[a]},showProfile:function(a,b){this._showProfile(this.getProfile(a,Number(b)))},closeVisibleView:function(){this.visibleView&&this.visibleView.detach();delete this.visibleView},performSearch:function(a){function b(){WebInspector.searchController.updateSearchMatchesCount(this._totalSearchMatches,this);WebInspector.searchController.updateCurrentMatchIndex(this._currentSearchResultIndex,
this);g=null}function c(a,c){c&&(this._totalSearchMatches+=c,this._searchResults.push(a),this.searchMatchFound&&this.searchMatchFound(a,c),g||(g=setTimeout(b.bind(this),500)),a===f&&a.jumpToFirstSearchResult())}function e(){var b=d[h];++h>=d.length&&(k._currentSearchChunkIntervalIdentifier===m&&delete k._currentSearchChunkIntervalIdentifier,clearInterval(m));b&&(b.currentQuery=a,b.performSearch(a,l))}this.searchCanceled();var d=this._searchableViews();if(d&&d.length){var f=this.visibleView,g=null,
h=0,k=this,l=c.bind(this),m=null;e();this._currentSearchChunkIntervalIdentifier=m=setInterval(e,25)}},jumpToNextSearchResult:function(){if(this.showView&&this._searchResults&&this._searchResults.length){var a=!1;this._currentSearchResultIndex=this._searchResults.indexOf(this.visibleView);-1===this._currentSearchResultIndex&&(this._currentSearchResultIndex=0,a=!0);var b=this._searchResults[this._currentSearchResultIndex];b.showingLastSearchResult()&&(++this._currentSearchResultIndex>=this._searchResults.length&&
(this._currentSearchResultIndex=0),b=this._searchResults[this._currentSearchResultIndex],a=!0);WebInspector.searchController.updateCurrentMatchIndex(this._currentSearchResultIndex,this);b!==this.visibleView&&(this.showView(b),WebInspector.searchController.showSearchField());a?b.jumpToFirstSearchResult():b.jumpToNextSearchResult()}},jumpToPreviousSearchResult:function(){if(this.showView&&this._searchResults&&this._searchResults.length){var a=!1;this._currentSearchResultIndex=this._searchResults.indexOf(this.visibleView);
-1===this._currentSearchResultIndex&&(this._currentSearchResultIndex=0,a=!0);var b=this._searchResults[this._currentSearchResultIndex];b.showingFirstSearchResult()&&(0>--this._currentSearchResultIndex&&(this._currentSearchResultIndex=this._searchResults.length-1),b=this._searchResults[this._currentSearchResultIndex],a=!0);WebInspector.searchController.updateCurrentMatchIndex(this._currentSearchResultIndex,this);b!==this.visibleView&&(this.showView(b),WebInspector.searchController.showSearchField());
a?b.jumpToLastSearchResult():b.jumpToPreviousSearchResult()}},_getAllProfiles:function(){var a=[],b;for(b in this._profileTypesByIdMap)a=a.concat(this._profileTypesByIdMap[b].getProfiles());return a},_searchableViews:function(){for(var a=this._getAllProfiles(),b=[],c=0;c<a.length;++c){var e=a[c].view(this);e.performSearch&&b.push(e)}a=b.indexOf(this.visibleView);0<a&&(b[a]=b[0],b[0]=this.visibleView);return b},searchMatchFound:function(a,b){a.profile._profilesTreeElement.searchMatches=b},searchCanceled:function(){if(this._searchResults)for(var a=
0;a<this._searchResults.length;++a){var b=this._searchResults[a];b.searchCanceled&&b.searchCanceled();delete b.currentQuery}WebInspector.Panel.prototype.searchCanceled.call(this);this._currentSearchChunkIntervalIdentifier&&(clearInterval(this._currentSearchChunkIntervalIdentifier),delete this._currentSearchChunkIntervalIdentifier);this._currentSearchResultIndex=this._totalSearchMatches=0;this._searchResults=[];b=this._getAllProfiles();for(a=0;a<b.length;++a)b[a]._profilesTreeElement.searchMatches=
0},_updateInterface:function(){this._profilerEnabled?(this.enableToggleButton.title=WebInspector.UIString("Profiling enabled. Click to disable."),this.enableToggleButton.toggled=!0,this.recordButton.visible=!0,this._profileViewStatusBarItemsContainer.removeStyleClass("hidden"),this.clearResultsButton.element.removeStyleClass("hidden"),this.panelEnablerView.detach()):(this.enableToggleButton.title=WebInspector.UIString("Profiling disabled. Click to enable."),this.enableToggleButton.toggled=!1,this.recordButton.visible=
!1,this._profileViewStatusBarItemsContainer.addStyleClass("hidden"),this.clearResultsButton.element.addStyleClass("hidden"),this.panelEnablerView.show(this.element))},get profilerEnabled(){return this._profilerEnabled},enableProfiler:function(){this._profilerEnabled||this._toggleProfiling(this.panelEnablerView.alwaysEnabled)},disableProfiler:function(){this._profilerEnabled&&this._toggleProfiling(this.panelEnablerView.alwaysEnabled)},_onToggleProfiling:function(a){this._toggleProfiling(!0)},_toggleProfiling:function(a){this._profilerEnabled?
(WebInspector.settings.profilerEnabled.set(!1),ProfilerAgent.disable(this._profilerWasDisabled.bind(this))):(WebInspector.settings.profilerEnabled.set(a),ProfilerAgent.enable(this._profilerWasEnabled.bind(this)))},sidebarResized:function(a){this._resize(a.data)},onResize:function(){this._resize(this.splitView.sidebarWidth())},_resize:function(a){var b=this._statusBarButtons[this._statusBarButtons.length-1].element,b=b.totalOffsetLeft()+b.offsetWidth;this._profileTypeStatusBarItemsContainer.style.left=
b+"px";b+=this._profileTypeStatusBarItemsContainer.offsetWidth-1;this._profileViewStatusBarItemsContainer.style.left=Math.max(b,a)+"px"},setRecordingProfile:function(a,b){var c=this.getProfileType(a);this.recordButton.toggled=b;this.recordButton.title=c.buttonTooltip;b?(this._launcherView.profileStarted(),this._createTemporaryProfile(a)):this._launcherView.profileFinished()},_reportProfileProgress:function(a,b,c){a.sidebarElement.subtitle=WebInspector.UIString("%.0f%",b/c*100);a.sidebarElement.wait=
!0},appendApplicableItems:function(a,b,c){function e(a){HeapProfilerAgent.getHeapObjectId(f,d.bind(this,a))}function d(a,b,c){WebInspector.inspectorView.currentPanel()===this&&(b||this.showObject(c,a))}if(WebInspector.inspectorView.currentPanel()===this){var f=c.objectId;f&&this.getProfileType(WebInspector.HeapSnapshotProfileType.TypeId).getProfiles().length&&(b.appendItem(WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?"Reveal in Dominators view":"Reveal in Dominators View"),e.bind(this,
"Dominators")),b.appendItem(WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?"Reveal in Summary view":"Reveal in Summary View"),e.bind(this,"Summary")))}},__proto__:WebInspector.Panel.prototype};
WebInspector.ProfileSidebarTreeElement=function(a,b,c){this.profile=a;this._titleFormat=b;WebInspector.ProfilesPanelDescriptor.isUserInitiatedProfile(this.profile.title)&&(this._profileNumber=WebInspector.ProfilesPanelDescriptor.userInitiatedProfileIndex(this.profile.title));WebInspector.SidebarTreeElement.call(this,c,"","",a,!1);this.refreshTitles()};
WebInspector.ProfileSidebarTreeElement.prototype={onselect:function(){this._suppressOnSelect||this.treeOutline.panel._showProfile(this.profile)},ondelete:function(){this.treeOutline.panel._removeProfileHeader(this.profile);return!0},get mainTitle(){return this._mainTitle?this._mainTitle:WebInspector.ProfilesPanelDescriptor.isUserInitiatedProfile(this.profile.title)?WebInspector.UIString(this._titleFormat,this._profileNumber):this.profile.title},set mainTitle(a){this._mainTitle=a;this.refreshTitles()},
set searchMatches(a){a?(this.bubbleText=a,this.bubbleElement.addStyleClass("search-matches")):this.bubbleElement&&(this.bubbleElement.removeStyleClass("search-matches"),this.bubbleText="")},handleContextMenuEvent:function(a,b){var c=this.profile,e=new WebInspector.ContextMenu(a);c.canSaveToFile()?(e.appendItem(WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?"Save heap snapshot\u2026":"Save Heap Snapshot\u2026"),c.saveToFile.bind(c)),e.appendItem(WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?
"Load heap snapshot\u2026":"Load Heap Snapshot\u2026"),b._fileSelectorElement.click.bind(b._fileSelectorElement)),e.appendItem(WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?"Delete heap snapshot":"Delete Heap Snapshot"),this.ondelete.bind(this))):(e.appendItem(WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?"Load heap snapshot\u2026":"Load Heap Snapshot\u2026"),b._fileSelectorElement.click.bind(b._fileSelectorElement)),e.appendItem(WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?
"Delete profile":"Delete Profile"),this.ondelete.bind(this)));e.show()},__proto__:WebInspector.SidebarTreeElement.prototype};WebInspector.ProfileGroupSidebarTreeElement=function(a,b,c){WebInspector.SidebarTreeElement.call(this,"profile-group-sidebar-tree-item",b,c,null,!0);this._panel=a};WebInspector.ProfileGroupSidebarTreeElement.prototype={onselect:function(){0<this.children.length&&this._panel._showProfile(this.children[this.children.length-1].profile)},__proto__:WebInspector.SidebarTreeElement.prototype};
WebInspector.ProfilesSidebarTreeElement=function(a){this._panel=a;this.small=!1;WebInspector.SidebarTreeElement.call(this,"profile-launcher-view-tree-item",WebInspector.UIString("Profiles"),"",null,!1)};WebInspector.ProfilesSidebarTreeElement.prototype={onselect:function(){this._panel._showLauncherView()},get selectable(){return!0},__proto__:WebInspector.SidebarTreeElement.prototype};WebInspector.CPUProfilerPanel=function(){WebInspector.ProfilesPanel.call(this,"cpu-profiler",new WebInspector.CPUProfileType)};
WebInspector.CPUProfilerPanel.prototype={__proto__:WebInspector.ProfilesPanel.prototype};WebInspector.CSSSelectorProfilerPanel=function(){WebInspector.ProfilesPanel.call(this,"css-profiler",new WebInspector.CSSSelectorProfileType)};WebInspector.CSSSelectorProfilerPanel.prototype={__proto__:WebInspector.ProfilesPanel.prototype};WebInspector.HeapProfilerPanel=function(){WebInspector.ProfilesPanel.call(this,"heap-profiler",new WebInspector.HeapSnapshotProfileType)};
WebInspector.HeapProfilerPanel.prototype={__proto__:WebInspector.ProfilesPanel.prototype};WebInspector.CanvasProfilerPanel=function(){WebInspector.ProfilesPanel.call(this,"canvas-profiler",new WebInspector.CanvasProfileType)};WebInspector.CanvasProfilerPanel.prototype={__proto__:WebInspector.ProfilesPanel.prototype};
WebInspector.ProfileDataGridNode=function(a,b,c){this.profileNode=a;WebInspector.DataGridNode.call(this,null,c);this.tree=b;this.childrenByCallUID={};this.lastComparator=null;this.callUID=a.callUID;this.selfTime=a.selfTime;this.totalTime=a.totalTime;this.functionName=a.functionName;this.numberOfCalls=a.numberOfCalls;this.url=a.url};
WebInspector.ProfileDataGridNode.prototype={get data(){function a(a){return Capabilities.samplingCPUProfiler?WebInspector.UIString("%.0f\u2009ms",a):WebInspector.UIString("%.3f\u2009ms",a)}var b={};b["function"]=this.functionName;b.calls=this.numberOfCalls;this.tree.profileView.showSelfTimeAsPercent.get()?b.self=WebInspector.UIString("%.2f%",this.selfPercent):b.self=a(this.selfTime);this.tree.profileView.showTotalTimeAsPercent.get()?b.total=WebInspector.UIString("%.2f%",this.totalPercent):b.total=
a(this.totalTime);this.tree.profileView.showAverageTimeAsPercent.get()?b.average=WebInspector.UIString("%.2f%",this.averagePercent):b.average=a(this.averageTime);return b},createCell:function(a){var b=WebInspector.DataGridNode.prototype.createCell.call(this,a);"self"===a&&this._searchMatchedSelfColumn?b.addStyleClass("highlight"):"total"===a&&this._searchMatchedTotalColumn?b.addStyleClass("highlight"):"average"===a&&this._searchMatchedAverageColumn?b.addStyleClass("highlight"):"calls"===a&&this._searchMatchedCallsColumn&&
b.addStyleClass("highlight");if("function"!==a)return b;this.profileNode._searchMatchedFunctionColumn&&b.addStyleClass("highlight");this.profileNode.url&&(a=this.tree.profileView._linkifier.linkifyLocation(this.profileNode.url,this.profileNode.lineNumber?this.profileNode.lineNumber-1:0,0,"profile-node-file"),a.style.maxWidth="75%",b.insertBefore(a,b.firstChild));return b},select:function(a){WebInspector.DataGridNode.prototype.select.call(this,a);this.tree.profileView._dataGridNodeSelected(this)},
deselect:function(a){WebInspector.DataGridNode.prototype.deselect.call(this,a);this.tree.profileView._dataGridNodeDeselected(this)},sort:function(a,b){for(var c=[[this]],e=0;e<c.length;++e)for(var d=c[e],f=d.length,g=0;g<f;++g){var h=d[g];if(b||h.expanded&&h.lastComparator!==a){h.lastComparator=a;var h=h.children,k=h.length;if(k){h.sort(a);for(var l=0;l<k;++l)h[l]._recalculateSiblings(l);c.push(h)}}else h.children.length&&(h.shouldRefreshChildren=!0)}},insertChild:function(a,b){WebInspector.DataGridNode.prototype.insertChild.call(this,
a,b);this.childrenByCallUID[a.callUID]=a},removeChild:function(a){WebInspector.DataGridNode.prototype.removeChild.call(this,a);delete this.childrenByCallUID[a.callUID]},removeChildren:function(){WebInspector.DataGridNode.prototype.removeChildren.call(this);this.childrenByCallUID={}},findChild:function(a){return a?this.childrenByCallUID[a.callUID]:null},get averageTime(){return this.selfTime/Math.max(1,this.numberOfCalls)},get averagePercent(){return this.averageTime/this.tree.totalTime*100},get selfPercent(){return this.selfTime/
this.tree.totalTime*100},get totalPercent(){return this.totalTime/this.tree.totalTime*100},get _parent(){return this.parent!==this.dataGrid?this.parent:this.tree},populate:function(){if(!this._populated&&(this._populated=!0,this._sharedPopulate(),this._parent)){var a=this._parent.lastComparator;a&&this.sort(a,!0)}},_save:function(){this._savedChildren||(this._savedSelfTime=this.selfTime,this._savedTotalTime=this.totalTime,this._savedNumberOfCalls=this.numberOfCalls,this._savedChildren=this.children.slice())},
_restore:function(){if(this._savedChildren){this.selfTime=this._savedSelfTime;this.totalTime=this._savedTotalTime;this.numberOfCalls=this._savedNumberOfCalls;this.removeChildren();for(var a=this._savedChildren,b=a.length,c=0;c<b;++c)a[c]._restore(),this.appendChild(a[c])}},_merge:function(a,b){this.selfTime+=a.selfTime;b||(this.totalTime+=a.totalTime,this.numberOfCalls+=a.numberOfCalls);var c=this.children.slice();this.removeChildren();for(var e=c.length,d=0;d<e;++d)b&&c[d]===a||this.appendChild(c[d]);
c=a.children.slice();e=c.length;for(d=0;d<e;++d){var f=c[d],g=this.childrenByCallUID[f.callUID];g?g._merge(f,!1):this.appendChild(f)}},__proto__:WebInspector.DataGridNode.prototype};WebInspector.ProfileDataGridTree=function(a,b){this.tree=this;this.children=[];this.profileView=a;this.totalTime=b.totalTime;this.lastComparator=null;this.childrenByCallUID={}};
WebInspector.ProfileDataGridTree.prototype={get expanded(){return!0},appendChild:function(a){this.insertChild(a,this.children.length)},insertChild:function(a,b){this.children.splice(b,0,a);this.childrenByCallUID[a.callUID]=a},removeChildren:function(){this.children=[];this.childrenByCallUID={}},findChild:WebInspector.ProfileDataGridNode.prototype.findChild,sort:WebInspector.ProfileDataGridNode.prototype.sort,_save:function(){this._savedChildren||(this._savedTotalTime=this.totalTime,this._savedChildren=
this.children.slice())},restore:function(){if(this._savedChildren){this.children=this._savedChildren;this.totalTime=this._savedTotalTime;for(var a=this.children,b=a.length,c=0;c<b;++c)a[c]._restore();this._savedChildren=null}}};WebInspector.ProfileDataGridTree.propertyComparators=[{},{}];
WebInspector.ProfileDataGridTree.propertyComparator=function(a,b){var c=WebInspector.ProfileDataGridTree.propertyComparators[b?1:0][a];c||(c=b?function(b,c){return b[a]<c[a]?-1:b[a]>c[a]?1:0}:function(b,c){return b[a]>c[a]?-1:b[a]<c[a]?1:0},WebInspector.ProfileDataGridTree.propertyComparators[b?1:0][a]=c);return c};WebInspector.BottomUpProfileDataGridNode=function(a,b){WebInspector.ProfileDataGridNode.call(this,a,b,this._willHaveChildren(a));this._remainingNodeInfos=[]};
WebInspector.BottomUpProfileDataGridNode.prototype={_takePropertiesFromProfileDataGridNode:function(a){this._save();this.selfTime=a.selfTime;this.totalTime=a.totalTime;this.numberOfCalls=a.numberOfCalls},_keepOnlyChild:function(a){this._save();this.removeChildren();this.appendChild(a)},_exclude:function(a){this._remainingNodeInfos&&this.populate();this._save();for(var b=this.children,c=this.children.length;c--;)b[c]._exclude(a);(a=this.childrenByCallUID[a])&&this._merge(a,!0)},_restore:function(){WebInspector.ProfileDataGridNode.prototype._restore();
this.children.length||(this.hasChildren=this._willHaveChildren(this.profileNode))},_merge:function(a,b){this.selfTime-=a.selfTime;WebInspector.ProfileDataGridNode.prototype._merge.call(this,a,b)},_sharedPopulate:function(){for(var a=this._remainingNodeInfos,b=a.length,c=0;c<b;++c){var e=a[c],d=e.ancestor,f=e.focusNode,g=this.findChild(d);if(g){var h=e.totalTimeAccountedFor;g.selfTime+=f.selfTime;g.numberOfCalls+=f.numberOfCalls;h||(g.totalTime+=f.totalTime)}else g=new WebInspector.BottomUpProfileDataGridNode(d,
this.tree),d!==f&&(g.selfTime=f.selfTime,g.totalTime=f.totalTime,g.numberOfCalls=f.numberOfCalls),this.appendChild(g);(d=d.parent)&&d.parent&&(e.ancestor=d,g._remainingNodeInfos.push(e))}delete this._remainingNodeInfos},_willHaveChildren:function(a){return!(!a.parent||!a.parent.parent)},__proto__:WebInspector.ProfileDataGridNode.prototype};
WebInspector.BottomUpProfileDataGridTree=function(a,b){WebInspector.ProfileDataGridTree.call(this,a,b);var c=0,e=[[],[b]],d={};this._remainingNodeInfos=[];for(var f=0;f<e.length;++f)for(var g=e[f],h=e[++f],k=h.length,l=0;l<k;++l){var m=h[l];m.UID||(m.UID=++c);if(m.head&&m!==m.head){var n=d[m.callUID],p=!1;if(n)for(var q=g.length,s=0;s<q;++s){if(n[g[s].UID]){p=!0;break}}else n={},d[m.callUID]=n;n[m.UID]=!0;this._remainingNodeInfos.push({ancestor:m,focusNode:m,totalTimeAccountedFor:p})}n=m.children;
n.length&&(e.push(g.concat([m])),e.push(n))}WebInspector.BottomUpProfileDataGridNode.prototype.populate.call(this);return this};
WebInspector.BottomUpProfileDataGridTree.prototype={focus:function(a){if(a){this._save();for(var b=a,c=a;b.parent&&b instanceof WebInspector.ProfileDataGridNode;)b._takePropertiesFromProfileDataGridNode(a),c=b,b=b.parent,b instanceof WebInspector.ProfileDataGridNode&&b._keepOnlyChild(c);this.children=[c];this.totalTime=a.totalTime}},exclude:function(a){if(a){this._save();a=a.callUID;var b=this.childrenByCallUID[a];b&&this.children.remove(b);for(var b=this.children,c=b.length,e=0;e<c;++e)b[e]._exclude(a);
this.lastComparator&&this.sort(this.lastComparator,!0)}},_sharedPopulate:WebInspector.BottomUpProfileDataGridNode.prototype._sharedPopulate,__proto__:WebInspector.ProfileDataGridTree.prototype};
WebInspector.CPUProfileView=function(a){WebInspector.View.call(this);this.element.addStyleClass("profile-view");this.showSelfTimeAsPercent=WebInspector.settings.createSetting("cpuProfilerShowSelfTimeAsPercent",!0);this.showTotalTimeAsPercent=WebInspector.settings.createSetting("cpuProfilerShowTotalTimeAsPercent",!0);this.showAverageTimeAsPercent=WebInspector.settings.createSetting("cpuProfilerShowAverageTimeAsPercent",!0);this._viewType=WebInspector.settings.createSetting("cpuProfilerView",WebInspector.CPUProfileView._TypeHeavy);
var b=[];b.push({id:"self",title:WebInspector.UIString("Self"),width:"72px",sort:WebInspector.DataGrid.Order.Descending,sortable:!0});b.push({id:"total",title:WebInspector.UIString("Total"),width:"72px",sortable:!0});Capabilities.samplingCPUProfiler||(b.push({id:"average",title:WebInspector.UIString("Average"),width:"72px",sortable:!0}),b.push({id:"calls",title:WebInspector.UIString("Calls"),width:"54px",sortable:!0}));b.push({id:"function",title:WebInspector.UIString("Function"),disclosure:!0,sortable:!0});
this.dataGrid=new WebInspector.DataGrid(b);this.dataGrid.addEventListener(WebInspector.DataGrid.Events.SortingChanged,this._sortProfile,this);this.dataGrid.element.addEventListener("mousedown",this._mouseDownInDataGrid.bind(this),!0);WebInspector.experimentsSettings.cpuFlameChart.isEnabled()?(this._splitView=new WebInspector.SplitView(!1,"flameChartSplitLocation"),this._splitView.show(this.element),this.flameChart=new WebInspector.FlameChart(this),this.flameChart.addEventListener(WebInspector.FlameChart.Events.SelectedNode,
this._revealProfilerNode.bind(this)),this.flameChart.show(this._splitView.firstElement()),this.dataGrid.show(this._splitView.secondElement())):this.dataGrid.show(this.element);this.viewSelectComboBox=new WebInspector.StatusBarComboBox(this._changeView.bind(this));var b=this.viewSelectComboBox.createOption(WebInspector.UIString("Heavy (Bottom Up)"),"",WebInspector.CPUProfileView._TypeHeavy),c=this.viewSelectComboBox.createOption(WebInspector.UIString("Tree (Top Down)"),"",WebInspector.CPUProfileView._TypeTree);
this.viewSelectComboBox.select(this._viewType.get()===WebInspector.CPUProfileView._TypeHeavy?b:c);this.percentButton=new WebInspector.StatusBarButton("","percent-time-status-bar-item");this.percentButton.addEventListener("click",this._percentClicked,this);this.focusButton=new WebInspector.StatusBarButton(WebInspector.UIString("Focus selected function."),"focus-profile-node-status-bar-item");this.focusButton.setEnabled(!1);this.focusButton.addEventListener("click",this._focusClicked,this);this.excludeButton=
new WebInspector.StatusBarButton(WebInspector.UIString("Exclude selected function."),"exclude-profile-node-status-bar-item");this.excludeButton.setEnabled(!1);this.excludeButton.addEventListener("click",this._excludeClicked,this);this.resetButton=new WebInspector.StatusBarButton(WebInspector.UIString("Restore all functions."),"reset-profile-status-bar-item");this.resetButton.visible=!1;this.resetButton.addEventListener("click",this._resetClicked,this);this.profileHead=null;this.profile=a;this._linkifier=
new WebInspector.Linkifier(new WebInspector.Linkifier.DefaultFormatter(30));ProfilerAgent.getCPUProfile(this.profile.uid,this._getCPUProfileCallback.bind(this))};WebInspector.CPUProfileView._TypeTree="Tree";WebInspector.CPUProfileView._TypeHeavy="Heavy";
WebInspector.CPUProfileView.prototype={_revealProfilerNode:function(a){for(var b=this.profileDataGridTree.children[0];b&&b.profileNode!==a.data;)b=b.traverseNextNode(!1,null,!1);b&&b.revealAndSelect()},_getCPUProfileCallback:function(a,b){!a&&b.head&&(this.profileHead=b.head,this.samples=b.samples,b.idleTime&&this._injectIdleTimeNode(b),this._assignParentsInProfile(),this.samples&&this._buildIdToNodeMap(),this._changeView(),this._updatePercentButton(),this.flameChart&&this.flameChart.update())},statusBarItems:function(){return[this.viewSelectComboBox.element,
this.percentButton.element,this.focusButton.element,this.excludeButton.element,this.resetButton.element]},_getBottomUpProfileDataGridTree:function(){this._bottomUpProfileDataGridTree||(this._bottomUpProfileDataGridTree=new WebInspector.BottomUpProfileDataGridTree(this,this.profileHead));return this._bottomUpProfileDataGridTree},_getTopDownProfileDataGridTree:function(){this._topDownProfileDataGridTree||(this._topDownProfileDataGridTree=new WebInspector.TopDownProfileDataGridTree(this,this.profileHead));
return this._topDownProfileDataGridTree},willHide:function(){this._currentSearchResultIndex=-1},refresh:function(){var a=this.dataGrid.selectedNode?this.dataGrid.selectedNode.profileNode:null;this.dataGrid.rootNode().removeChildren();for(var b=this.profileDataGridTree.children,c=b.length,e=0;e<c;++e)this.dataGrid.rootNode().appendChild(b[e]);a&&(a.selected=!0)},refreshVisibleData:function(){for(var a=this.dataGrid.rootNode().children[0];a;)a.refresh(),a=a.traverseNextNode(!1,null,!0)},refreshShowAsPercents:function(){this._updatePercentButton();
this.refreshVisibleData()},searchCanceled:function(){if(this._searchResults)for(var a=0;a<this._searchResults.length;++a){var b=this._searchResults[a].profileNode;delete b._searchMatchedSelfColumn;delete b._searchMatchedTotalColumn;delete b._searchMatchedAverageColumn;delete b._searchMatchedCallsColumn;delete b._searchMatchedFunctionColumn;b.refresh()}delete this._searchFinishedCallback;this._currentSearchResultIndex=-1;this._searchResults=[]},performSearch:function(a,b){this.searchCanceled();a=a.trim();
if(a.length){this._searchFinishedCallback=b;var c=a.startsWith(">"),e=a.startsWith("<"),d=a.startsWith("=")||(c||e)&&1===a.indexOf("="),f=a.lastIndexOf("%")===a.length-1,g=2<a.length&&a.lastIndexOf("ms")===a.length-2,h=!g&&a.lastIndexOf("s")===a.length-1,k=parseFloat(a);if(c||e||d)k=d&&(c||e)?parseFloat(a.substring(2)):parseFloat(a.substring(1));var l=h?1E3*k:k;isNaN(k)||c||e||(d=!0);for(var m=RegExp(a.escapeForRegExp(),"i"),n=this.profileDataGridTree.children[0];n;){var p;p=n;delete p._searchMatchedSelfColumn;
delete p._searchMatchedTotalColumn;delete p._searchMatchedAverageColumn;delete p._searchMatchedCallsColumn;delete p._searchMatchedFunctionColumn;f?(e?(p.selfPercent<k&&(p._searchMatchedSelfColumn=!0),p.totalPercent<k&&(p._searchMatchedTotalColumn=!0),p.averagePercent<l&&(p._searchMatchedAverageColumn=!0)):c&&(p.selfPercent>k&&(p._searchMatchedSelfColumn=!0),p.totalPercent>k&&(p._searchMatchedTotalColumn=!0),p.averagePercent<l&&(p._searchMatchedAverageColumn=!0)),d&&(p.selfPercent==k&&(p._searchMatchedSelfColumn=
!0),p.totalPercent==k&&(p._searchMatchedTotalColumn=!0),p.averagePercent<l&&(p._searchMatchedAverageColumn=!0))):g||h?(e?(p.selfTime<l&&(p._searchMatchedSelfColumn=!0),p.totalTime<l&&(p._searchMatchedTotalColumn=!0),p.averageTime<l&&(p._searchMatchedAverageColumn=!0)):c&&(p.selfTime>l&&(p._searchMatchedSelfColumn=!0),p.totalTime>l&&(p._searchMatchedTotalColumn=!0),p.averageTime>l&&(p._searchMatchedAverageColumn=!0)),d&&(p.selfTime==l&&(p._searchMatchedSelfColumn=!0),p.totalTime==l&&(p._searchMatchedTotalColumn=
!0),p.averageTime==l&&(p._searchMatchedAverageColumn=!0))):(d&&p.numberOfCalls==k&&(p._searchMatchedCallsColumn=!0),c&&p.numberOfCalls>k&&(p._searchMatchedCallsColumn=!0),e&&p.numberOfCalls<k&&(p._searchMatchedCallsColumn=!0));if(p.functionName.match(m)||p.url&&p.url.match(m))p._searchMatchedFunctionColumn=!0;p._searchMatchedSelfColumn||p._searchMatchedTotalColumn||p._searchMatchedAverageColumn||p._searchMatchedCallsColumn||p._searchMatchedFunctionColumn?(p.refresh(),p=!0):p=!1;p&&this._searchResults.push({profileNode:n});
n=n.traverseNextNode(!1,null,!1)}b(this,this._searchResults.length)}},jumpToFirstSearchResult:function(){this._searchResults&&this._searchResults.length&&(this._currentSearchResultIndex=0,this._jumpToSearchResult(this._currentSearchResultIndex))},jumpToLastSearchResult:function(){this._searchResults&&this._searchResults.length&&(this._currentSearchResultIndex=this._searchResults.length-1,this._jumpToSearchResult(this._currentSearchResultIndex))},jumpToNextSearchResult:function(){this._searchResults&&
this._searchResults.length&&(++this._currentSearchResultIndex>=this._searchResults.length&&(this._currentSearchResultIndex=0),this._jumpToSearchResult(this._currentSearchResultIndex))},jumpToPreviousSearchResult:function(){this._searchResults&&this._searchResults.length&&(0>--this._currentSearchResultIndex&&(this._currentSearchResultIndex=this._searchResults.length-1),this._jumpToSearchResult(this._currentSearchResultIndex))},showingFirstSearchResult:function(){return 0===this._currentSearchResultIndex},
showingLastSearchResult:function(){return this._searchResults&&this._currentSearchResultIndex===this._searchResults.length-1},_jumpToSearchResult:function(a){(a=this._searchResults[a])&&a.profileNode.revealAndSelect()},_changeView:function(){if(this.profile){switch(this.viewSelectComboBox.selectedOption().value){case WebInspector.CPUProfileView._TypeTree:this.profileDataGridTree=this._getTopDownProfileDataGridTree();this._sortProfile();this._viewType.set(WebInspector.CPUProfileView._TypeTree);break;
case WebInspector.CPUProfileView._TypeHeavy:this.profileDataGridTree=this._getBottomUpProfileDataGridTree(),this._sortProfile(),this._viewType.set(WebInspector.CPUProfileView._TypeHeavy)}this.currentQuery&&this._searchFinishedCallback&&this._searchResults&&(this._searchFinishedCallback(this,-this._searchResults.length),this.performSearch(this.currentQuery,this._searchFinishedCallback))}},_percentClicked:function(a){a=this.showSelfTimeAsPercent.get()&&this.showTotalTimeAsPercent.get()&&this.showAverageTimeAsPercent.get();
this.showSelfTimeAsPercent.set(!a);this.showTotalTimeAsPercent.set(!a);this.showAverageTimeAsPercent.set(!a);this.refreshShowAsPercents()},_updatePercentButton:function(){this.showSelfTimeAsPercent.get()&&this.showTotalTimeAsPercent.get()&&this.showAverageTimeAsPercent.get()?(this.percentButton.title=WebInspector.UIString("Show absolute total and self times."),this.percentButton.toggled=!0):(this.percentButton.title=WebInspector.UIString("Show total and self times as percentages."),this.percentButton.toggled=
!1)},_focusClicked:function(a){this.dataGrid.selectedNode&&(this.resetButton.visible=!0,this.profileDataGridTree.focus(this.dataGrid.selectedNode),this.refresh(),this.refreshVisibleData())},_excludeClicked:function(a){if(a=this.dataGrid.selectedNode)a.deselect(),this.resetButton.visible=!0,this.profileDataGridTree.exclude(a),this.refresh(),this.refreshVisibleData()},_resetClicked:function(a){this.resetButton.visible=!1;this.profileDataGridTree.restore();this._linkifier.reset();this.refresh();this.refreshVisibleData()},
_dataGridNodeSelected:function(a){this.focusButton.setEnabled(!0);this.excludeButton.setEnabled(!0)},_dataGridNodeDeselected:function(a){this.focusButton.setEnabled(!1);this.excludeButton.setEnabled(!1)},_sortProfile:function(){var a=this.dataGrid.isSortOrderAscending(),b={average:"averageTime",self:"selfTime",total:"totalTime",calls:"numberOfCalls","function":"functionName"}[this.dataGrid.sortColumnIdentifier()];this.profileDataGridTree.sort(WebInspector.ProfileDataGridTree.propertyComparator(b,
a));this.refresh()},_mouseDownInDataGrid:function(a){if(!(2>a.detail)){var b=a.target.enclosingNodeOrSelfWithNodeName("td");b&&(b.hasStyleClass("total-column")||b.hasStyleClass("self-column")||b.hasStyleClass("average-column"))&&(b.hasStyleClass("total-column")?this.showTotalTimeAsPercent.set(!this.showTotalTimeAsPercent.get()):b.hasStyleClass("self-column")?this.showSelfTimeAsPercent.set(!this.showSelfTimeAsPercent.get()):b.hasStyleClass("average-column")&&this.showAverageTimeAsPercent.set(!this.showAverageTimeAsPercent.get()),
this.refreshShowAsPercents(),a.consume(!0))}},_assignParentsInProfile:function(){var a=this.profileHead;a.parent=null;a.head=null;for(var b=[{parent:a,children:a.children}];0<b.length;)for(var c=b.pop(),e=c.parent,c=c.children,d=c.length,f=0;f<d;++f)c[f].head=a,c[f].parent=e,0<c[f].children.length&&b.push({parent:c[f],children:c[f].children})},_buildIdToNodeMap:function(){for(var a=this._idToNode={},b=[this.profileHead];b.length;){var c=b.pop();a[c.id]=c;for(var e=0;e<c.children.length;e++)b.push(c.children[e])}},
_injectIdleTimeNode:function(a){var b=a.idleTime;a=a.head.children;for(var c={selfTime:0},e=a.length-1;0<=e;--e)if("(program)"===a[e].functionName){c=a[e];break}e=c.selfTime;b>e&&(b=e);e-=b;c.selfTime=e;c.totalTime=e;a.push({functionName:"(idle)",url:null,lineNumber:0,totalTime:b,selfTime:b,numberOfCalls:0,visible:!0,callUID:0,children:[]})},__proto__:WebInspector.View.prototype};
WebInspector.CPUProfileType=function(){WebInspector.ProfileType.call(this,WebInspector.CPUProfileType.TypeId,WebInspector.UIString("Collect JavaScript CPU Profile"));InspectorBackend.registerProfilerDispatcher(this);this._recording=!1;WebInspector.CPUProfileType.instance=this};WebInspector.CPUProfileType.TypeId="CPU";
WebInspector.CPUProfileType.prototype={get buttonTooltip(){return this._recording?WebInspector.UIString("Stop CPU profiling."):WebInspector.UIString("Start CPU profiling.")},buttonClicked:function(){if(this._recording)return this.stopRecordingProfile(),!1;this.startRecordingProfile();return!0},get treeItemTitle(){return WebInspector.UIString("CPU PROFILES")},get description(){return WebInspector.UIString("CPU profiles show where the execution time is spent in your page's JavaScript functions.")},
addProfileHeader:function(a){this.addProfile(this.createProfile(a))},isRecordingProfile:function(){return this._recording},startRecordingProfile:function(){this._recording=!0;WebInspector.userMetrics.ProfilesCPUProfileTaken.record();ProfilerAgent.start()},stopRecordingProfile:function(){this._recording=!1;ProfilerAgent.stop()},setRecordingProfile:function(a){this._recording=a},createTemporaryProfile:function(a){a=a||WebInspector.UIString("Recording\u2026");return new WebInspector.CPUProfileHeader(this,
a)},createProfile:function(a){return new WebInspector.CPUProfileHeader(this,a.title,a.uid)},removeProfile:function(a){WebInspector.ProfileType.prototype.removeProfile.call(this,a);a.isTemporary||ProfilerAgent.removeProfile(this.id,a.uid)},_requestProfilesFromBackend:function(a){ProfilerAgent.getProfileHeaders(a)},resetProfiles:function(){this._reset()},addHeapSnapshotChunk:function(a,b){throw Error("Never called");},finishHeapSnapshot:function(a){throw Error("Never called");},reportHeapSnapshotProgress:function(a,
b){throw Error("Never called");},__proto__:WebInspector.ProfileType.prototype};WebInspector.CPUProfileHeader=function(a,b,c){WebInspector.ProfileHeader.call(this,a,b,c)};WebInspector.CPUProfileHeader.prototype={createSidebarTreeElement:function(){return new WebInspector.ProfileSidebarTreeElement(this,WebInspector.UIString("Profile %d"),"profile-sidebar-tree-item")},createView:function(a){return new WebInspector.CPUProfileView(this)},__proto__:WebInspector.ProfileHeader.prototype};
WebInspector.CSSSelectorDataGridNode=function(a,b){WebInspector.DataGridNode.call(this,b,!1);this._profileView=a};
WebInspector.CSSSelectorDataGridNode.prototype={get data(){var a={};a.selector=this._data.selector;a.matches=this._data.matchCount;this._profileView.showTimeAsPercent.get()?a.time=Number(this._data.timePercent).toFixed(1)+"%":a.time=Number.secondsToString(this._data.time/1E3,!0);return a},get rawData(){return this._data},createCell:function(a){var b=WebInspector.DataGridNode.prototype.createCell.call(this,a);if("selector"===a&&b.firstChild)return b.firstChild.title=this.rawData.selector,b;if("source"!==
a)return b;b.removeChildren();this.rawData.url&&b.createChild("div").appendChild(WebInspector.linkifyResourceAsNode(this.rawData.url,this.rawData.lineNumber));return b},__proto__:WebInspector.DataGridNode.prototype};
WebInspector.CSSSelectorProfileView=function(a){WebInspector.View.call(this);this.element.addStyleClass("profile-view");this.showTimeAsPercent=WebInspector.settings.createSetting("selectorProfilerShowTimeAsPercent",!0);var b=[{id:"selector",title:WebInspector.UIString("Selector"),width:"550px",sortable:!0},{id:"source",title:WebInspector.UIString("Source"),width:"100px",sortable:!0},{id:"time",title:WebInspector.UIString("Total"),width:"72px",sort:WebInspector.DataGrid.Order.Descending,sortable:!0},
{id:"matches",title:WebInspector.UIString("Matches"),width:"72px",sortable:!0}];this.dataGrid=new WebInspector.DataGrid(b);this.dataGrid.element.addStyleClass("selector-profile-view");this.dataGrid.addEventListener(WebInspector.DataGrid.Events.SortingChanged,this._sortProfile,this);this.dataGrid.element.addEventListener("mousedown",this._mouseDownInDataGrid.bind(this),!0);this.dataGrid.show(this.element);this.percentButton=new WebInspector.StatusBarButton("","percent-time-status-bar-item");this.percentButton.addEventListener("click",
this._percentClicked,this);this.profile=a;this._createProfileNodes();this._sortProfile();this._updatePercentButton()};
WebInspector.CSSSelectorProfileView.prototype={statusBarItems:function(){return[this.percentButton.element]},get profile(){return this._profile},set profile(a){this._profile=a},_createProfileNodes:function(){var a=this.profile.data;if(a){this.profile.children=[];for(var b=0;b<a.length;++b){a[b].timePercent=100*a[b].time/this.profile.totalTime;var c=new WebInspector.CSSSelectorDataGridNode(this,a[b]);this.profile.children.push(c)}}},rebuildGridItems:function(){this.dataGrid.rootNode().removeChildren();
for(var a=this.profile.children,b=a.length,c=0;c<b;++c)this.dataGrid.rootNode().appendChild(a[c])},refreshData:function(){for(var a=this.dataGrid.rootNode().children[0];a;)a.refresh(),a=a.traverseNextNode(!1,null,!0)},refreshShowAsPercents:function(){this._updatePercentButton();this.refreshData()},_percentClicked:function(a){this.showTimeAsPercent.set(!this.showTimeAsPercent.get());this.refreshShowAsPercents()},_updatePercentButton:function(){this.showTimeAsPercent.get()?(this.percentButton.title=
WebInspector.UIString("Show absolute times."),this.percentButton.toggled=!0):(this.percentButton.title=WebInspector.UIString("Show times as percentages."),this.percentButton.toggled=!1)},_sortProfile:function(){function a(a,b){var c=b.rawData.selector.compareTo(a.rawData.selector);return d?-c:c}function b(a,b){var c=a.rawData,e=b.rawData,f=e.url.compareTo(c.url);f||(f=e.lineNumber-c.lineNumber);return d?-f:f}function c(a,b){var c=b.rawData.time-a.rawData.time;return d?-c:c}function e(a,b){var c=b.rawData.matchCount-
a.rawData.matchCount;return d?-c:c}var d=this.dataGrid.isSortOrderAscending(),f;switch(this.dataGrid.sortColumnIdentifier()){case "time":f=c;break;case "matches":f=e;break;case "selector":f=a;break;case "source":f=b}this.profile.children.sort(f);this.rebuildGridItems()},_mouseDownInDataGrid:function(a){if(!(2>a.detail)){var b=a.target.enclosingNodeOrSelfWithNodeName("td");b&&b.hasStyleClass("time-column")&&(this.showTimeAsPercent.set(!this.showTimeAsPercent.get()),this.refreshShowAsPercents(),a.consume(!0))}},
__proto__:WebInspector.View.prototype};WebInspector.CSSSelectorProfileType=function(){WebInspector.ProfileType.call(this,WebInspector.CSSSelectorProfileType.TypeId,WebInspector.UIString("Collect CSS Selector Profile"));this._recording=!1;this._profileUid=1;WebInspector.CSSSelectorProfileType.instance=this};WebInspector.CSSSelectorProfileType.TypeId="SELECTOR";
WebInspector.CSSSelectorProfileType.prototype={get buttonTooltip(){return this._recording?WebInspector.UIString("Stop CSS selector profiling."):WebInspector.UIString("Start CSS selector profiling.")},buttonClicked:function(){if(this._recording)return this._stopRecordingProfile(),!1;this._startRecordingProfile();return!0},get treeItemTitle(){return WebInspector.UIString("CSS SELECTOR PROFILES")},get description(){return WebInspector.UIString("CSS selector profiles show how long the selector matching has taken in total and how many times a certain selector has matched DOM elements (the results are approximate due to matching algorithm optimizations.)")},
reset:function(){this._profileUid=1},setRecordingProfile:function(a){this._recording=a},_startRecordingProfile:function(){this._recording=!0;CSSAgent.startSelectorProfiler()},_stopRecordingProfile:function(){this._recording=!1;CSSAgent.stopSelectorProfiler(function(a,b){if(!a){var c=this._profileUid++,e=WebInspector.UIString("Profile %d",c)+String.sprintf(" (%s)",Number.secondsToString(b.totalTime/1E3));this.addProfile(new WebInspector.CSSProfileHeader(this,e,c,b))}}.bind(this))},createTemporaryProfile:function(a){a=
a||WebInspector.UIString("Recording\u2026");return new WebInspector.CSSProfileHeader(this,a)},__proto__:WebInspector.ProfileType.prototype};WebInspector.CSSProfileHeader=function(a,b,c,e){WebInspector.ProfileHeader.call(this,a,b,c);this._protocolData=e};
WebInspector.CSSProfileHeader.prototype={createSidebarTreeElement:function(){return new WebInspector.ProfileSidebarTreeElement(this,this.title,"profile-sidebar-tree-item")},createView:function(a){return new WebInspector.CSSSelectorProfileView(this._protocolData)},__proto__:WebInspector.ProfileHeader.prototype};
WebInspector.FlameChart=function(a){WebInspector.View.call(this);this.registerRequiredCSS("flameChart.css");this.element.className="fill";this.element.id="cpu-flame-chart";this._overviewContainer=this.element.createChild("div","overview-container");this._overviewGrid=new WebInspector.OverviewGrid("flame-chart");this._overviewContainer.appendChild(this._overviewGrid.element);this._overviewCalculator=new WebInspector.FlameChart.OverviewCalculator;this._overviewGrid.addEventListener(WebInspector.OverviewGrid.Events.WindowChanged,
this._onWindowChanged,this);this._overviewCanvas=this._overviewContainer.createChild("canvas");this._chartContainer=this.element.createChild("div","chart-container");this._timelineGrid=new WebInspector.TimelineGrid;this._chartContainer.appendChild(this._timelineGrid.element);this._calculator=new WebInspector.FlameChart.Calculator;this._canvas=this._chartContainer.createChild("canvas");WebInspector.installDragHandle(this._canvas,this._startCanvasDragging.bind(this),this._canvasDragging.bind(this),
this._endCanvasDragging.bind(this),"col-resize");this._cpuProfileView=a;this._windowLeft=0;this._windowRight=1;this._barHeight=15;this._minWidth=1;this._paddingLeft=15;this._canvas.addEventListener("mousewheel",this._onMouseWheel.bind(this),!1);this.element.addEventListener("click",this._onClick.bind(this),!1);this._popoverHelper=new WebInspector.PopoverHelper(this._chartContainer,this._getPopoverAnchor.bind(this),this._showPopover.bind(this));this._popoverHelper.setTimeout(250);this._linkifier=new WebInspector.Linkifier;
this._highlightedNodeIndex=-1;WebInspector.FlameChart._colorGenerator||(WebInspector.FlameChart._colorGenerator=new WebInspector.FlameChart.ColorGenerator)};WebInspector.FlameChart.Calculator=function(){};
WebInspector.FlameChart.Calculator.prototype={_updateBoundaries:function(a){this._minimumBoundaries=a._windowLeft*a._timelineData.totalTime;this._maximumBoundaries=a._windowRight*a._timelineData.totalTime;this._paddingLeft=a._paddingLeft;this._width=a._canvas.width-this._paddingLeft;this._timeToPixel=this._width/this.boundarySpan()},computePosition:function(a){return(a-this._minimumBoundaries)*this._timeToPixel+this._paddingLeft},formatTime:function(a){return Number.secondsToString((a+this._minimumBoundaries)/
1E3)},maximumBoundary:function(){return this._maximumBoundaries},minimumBoundary:function(){return this._minimumBoundaries},zeroTime:function(){return 0},boundarySpan:function(){return this._maximumBoundaries-this._minimumBoundaries}};WebInspector.FlameChart.OverviewCalculator=function(){};
WebInspector.FlameChart.OverviewCalculator.prototype={_updateBoundaries:function(a){this._minimumBoundaries=0;this._maximumBoundaries=a._timelineData.totalTime;this._xScaleFactor=a._canvas.width/a._timelineData.totalTime},computePosition:function(a){return(a-this._minimumBoundaries)*this._xScaleFactor},formatTime:function(a){return Number.secondsToString((a+this._minimumBoundaries)/1E3)},maximumBoundary:function(){return this._maximumBoundaries},minimumBoundary:function(){return this._minimumBoundaries},
zeroTime:function(){return this._minimumBoundaries},boundarySpan:function(){return this._maximumBoundaries-this._minimumBoundaries}};WebInspector.FlameChart.Events={SelectedNode:"SelectedNode"};WebInspector.FlameChart.ColorGenerator=function(){this._colorPairs={};this._currentColorIndex=0};
WebInspector.FlameChart.ColorGenerator.prototype={_colorPairForID:function(a){var b=this._colorPairs,c=b[a];c||(c=++this._currentColorIndex,c=(5*c+c%2*11)%360,b[a]=c={highlighted:"hsla("+c+", 100%, 33%, 0.7)",normal:"hsla("+c+", 100%, 66%, 0.7)"});return c}};WebInspector.FlameChart.Entry=function(a,b,c,e,d){this.colorPair=a;this.depth=b;this.duration=c;this.startTime=e;this.node=d};
WebInspector.FlameChart.prototype={_onWindowChanged:function(a){this._hidePopover();this._scheduleUpdate()},_startCanvasDragging:function(a){if(!this._timelineData)return!1;this._isDragging=!0;this._dragStartPoint=a.pageX;this._dragStartWindowLeft=this._windowLeft;this._dragStartWindowRight=this._windowRight;this._hidePopover();return!0},_canvasDragging:function(a){a=(this._dragStartPoint-a.pageX)/this._totalPixels;a=Math.max(0,this._dragStartWindowLeft+a);a!==this._windowLeft&&(a-=this._dragStartWindowLeft,
a=Math.min(1,this._dragStartWindowRight+a),a!==this._windowRight&&(a-=this._dragStartWindowRight,this._overviewGrid.setWindow(this._dragStartWindowLeft+a,this._dragStartWindowRight+a)))},_endCanvasDragging:function(){this._isDragging=!1},_calculateTimelineData:function(){function a(a,b){for(var c=b.length-1;0<=c;--c)a.push(b[c])}if(this._cpuProfileView.samples)return this._calculateTimelineDataForSamples();if(this._timelineData)return this._timelineData;if(!this._cpuProfileView.profileHead)return null;
var b=0,c=[],e=[];a(e,this._cpuProfileView.profileHead.children);for(var d=[0],f=[0],g=WebInspector.FlameChart._colorGenerator;e.length;){var h=d.length-1,k=e.pop(),l=d[h],m=g._colorPairForID(k.functionName+":"+k.url+":"+k.lineNumber);c.push(new WebInspector.FlameChart.Entry(m,h,k.totalTime,l,k));++b;d[h]+=k.totalTime;k.children.length&&(f.push(e.length),d.push(l+k.selfTime/2),a(e,k.children));for(;e.length===f[f.length-1];)d.pop(),f.pop()}return this._timelineData={entries:c,totalTime:this._cpuProfileView.profileHead.totalTime}},
_calculateTimelineDataForSamples:function(){if(this._timelineData)return this._timelineData;if(!this._cpuProfileView.profileHead)return null;for(var a=this._cpuProfileView.samples,b=this._cpuProfileView._idToNode,c=a.length,e=0,d=[],f=[],g=[],h=WebInspector.FlameChart._colorGenerator,k=0;k<c;k++){var l=b[a[k]];for(g.length=0;l;)g.push(l),l=l.parent;g.pop();for(var m=0,l=g.pop();l&&m<f.length&&l===f[m].node;)d[f[m].index].duration+=1,l=g.pop(),++m;m<f.length&&(f.length=m);if(l)for(;l;){var n=h._colorPairForID(l.functionName+
":"+l.url+":"+l.lineNumber);d.push(new WebInspector.FlameChart.Entry(n,m,1,k,l));f.push({node:l,index:e});++e;l=g.pop();++m}}return this._timelineData={entries:d,totalTime:c}},_getPopoverAnchor:function(a,b){if(this._isDragging)return null;var c=this._coordinatesToNodeIndex(b.offsetX,b.offsetY);this._highlightedNodeIndex=c;this.update();if(-1===c)return null;var e=new AnchorBox;this._entryToAnchorBox(this._timelineData.entries[c],e);e.x+=b.pageX-b.offsetX;e.y+=b.pageY-b.offsetY;return e},_showPopover:function(a,
b){if(!this._isDragging){var c=this._timelineData.entries[this._highlightedNodeIndex].node;if(c){var e=new WebInspector.PopoverContentHelper(c.functionName);e.appendTextRow(WebInspector.UIString("Total time"),Number.secondsToString(c.totalTime/1E3,!0));e.appendTextRow(WebInspector.UIString("Self time"),Number.secondsToString(c.selfTime/1E3,!0));c.numberOfCalls&&e.appendTextRow(WebInspector.UIString("Number of calls"),c.numberOfCalls);c.url&&(c=this._linkifier.linkifyLocation(c.url,c.lineNumber),e.appendElementRow("Location",
c));b.show(e._contentTable,a)}}},_hidePopover:function(){this._popoverHelper.hidePopover();this._linkifier.reset()},_onClick:function(a){-1!==this._highlightedNodeIndex&&this.dispatchEventToListeners(WebInspector.FlameChart.Events.SelectedNode,this._timelineData.entries[this._highlightedNodeIndex].node)},_onMouseWheel:function(a){this._overviewGrid.zoom(0<a.wheelDelta?0.9:1.1,Math.floor((this._pixelWindowLeft+a.offsetX)/this._totalPixels*this._pixelWindowWidth));this._hidePopover()},_coordinatesToNodeIndex:function(a,
b){var c=this._timelineData;if(!c)return-1;for(var c=c.entries,e=(a+this._pixelWindowLeft-this._paddingLeft)*this._pixelToTime,d=Math.floor((this._canvas.height-b)/this._barHeight),f=0;f<c.length&&!(e<c[f].startTime);++f)if(e<c[f].startTime+c[f].duration&&d===c[f].depth)return f;return-1},onResize:function(){this._updateOverviewCanvas=!0;this._hidePopover();this._scheduleUpdate()},_drawOverviewCanvas:function(a,b){this._overviewCanvas.width=a;this._overviewCanvas.height=b;if(this._timelineData){for(var c=
this._timelineData.entries,e=new Uint8Array(a),d=a/this._totalTime,f=0;f<c.length;++f)for(var g=c[f],h=Math.floor((g.startTime+g.duration)*d),k=Math.floor(g.startTime*d);k<h;++k)e[k]=Math.max(e[k],g.depth+1);c=this._overviewCanvas.getContext("2d");c.lineWidth=0.5;c.strokeStyle="rgba(20,0,0,0.8)";c.fillStyle="rgba(214,225,254, 0.8)";c.moveTo(0,b-1);for(k=0;k<a;++k)c.lineTo(k,b-2*e[k]-1);c.moveTo(a-1,b-1);c.moveTo(0,b-1);c.fill();c.stroke();c.closePath()}},_entryToAnchorBox:function(a,b){b.x=Math.floor(a.startTime*
this._timeToPixel)-this._pixelWindowLeft+this._paddingLeft;b.y=this._canvas.height-(a.depth+1)*this._barHeight;b.width=Math.floor(a.duration*this._timeToPixel);b.height=this._barHeight;0>b.x&&(b.width+=b.x,b.x=0);b.width=Number.constrain(b.width,0,this._canvas.width-b.x)},draw:function(a,b){var c=this._calculateTimelineData();if(c){c=c.entries;this._canvas.height=b;this._canvas.width=a;var e=this._barHeight,d=this._canvas.getContext("2d");d.font=e-3+"px sans-serif";d.textBaseline="top";this._dotsWidth=
d.measureText("\u2026").width;for(var e=new AnchorBox,f=0;f<c.length;++f){var g=c[f],h=g.startTime;if(h>this._timeWindowRight)break;h+g.duration<this._timeWindowLeft||(this._entryToAnchorBox(g,e),e.width<this._minWidth||(h=g.colorPair,h=this._highlightedNodeIndex===f?h.highlighted:h.normal,d.beginPath(),d.rect(e.x,e.y,e.width-1,e.height-1),d.fillStyle=h,d.fill(),h=Math.max(0,e.x),!(g=this._prepareTitle(d,g.node.functionName,e.width-2+e.x-h))))||(d.fillStyle="#333",d.fillText(g,h+2,e.y-1))}}},_prepareTitle:function(a,
b,c){if(c<this._dotsWidth)return null;var e=a.measureText(b).width;if(c>e)return b;c-=this._dotsWidth;var d=/[\.\$]/g,f=d.exec(b);if(!f){d=Math.floor(c/e*b.length)+1;if(4>d)return null;do--d,e=b.substring(0,d);while(a.measureText(e).width>c);return b.substring(0,d)+"\u2026"}for(;f;){e=b.substring(f.index+1);f=a.measureText(e).width;if(c>f)return"\u2026"+e;f=d.exec(b)}},_scheduleUpdate:function(){this._updateTimerId||(this._updateTimerId=setTimeout(this.update.bind(this),10))},_updateBoundaries:function(){this._windowLeft=
this._overviewGrid.windowLeft();this._windowRight=this._overviewGrid.windowRight();this._windowWidth=this._windowRight-this._windowLeft;this._totalTime=this._timelineData.totalTime;this._timeWindowLeft=this._windowLeft*this._totalTime;this._timeWindowRight=this._windowRight*this._totalTime;this._pixelWindowWidth=this._chartContainer.clientWidth;this._totalPixels=Math.floor(this._pixelWindowWidth/this._windowWidth);this._pixelWindowLeft=Math.floor(this._totalPixels*this._windowLeft);this._pixelWindowRight=
Math.floor(this._totalPixels*this._windowRight);this._timeToPixel=this._totalPixels/this._totalTime;this._pixelToTime=this._totalTime/this._totalPixels},update:function(){this._updateTimerId=0;this._timelineData||this._calculateTimelineData();this._timelineData&&(this._updateBoundaries(),this.draw(this._chartContainer.clientWidth,this._chartContainer.clientHeight),this._calculator._updateBoundaries(this),this._overviewCalculator._updateBoundaries(this),this._timelineGrid.element.style.width=this.element.clientWidth,
this._timelineGrid.updateDividers(this._calculator),this._overviewGrid.updateDividers(this._overviewCalculator),this._updateOverviewCanvas&&(this._drawOverviewCanvas(this._overviewContainer.clientWidth,this._overviewContainer.clientHeight),this._updateOverviewCanvas=!1))},__proto__:WebInspector.View.prototype};WebInspector.HeapSnapshotArraySlice=function(a,b,c){this._array=a;this._start=b;this.length=c-b};
WebInspector.HeapSnapshotArraySlice.prototype={item:function(a){return this._array[this._start+a]},slice:function(a,b){"undefined"===typeof b&&(b=this.length);return this._array.subarray(this._start+a,this._start+b)}};WebInspector.HeapSnapshotEdge=function(a,b,c){this._snapshot=a;this._edges=b;this.edgeIndex=c||0};
WebInspector.HeapSnapshotEdge.prototype={clone:function(){return new WebInspector.HeapSnapshotEdge(this._snapshot,this._edges,this.edgeIndex)},hasStringName:function(){throw Error("Not implemented");},name:function(){throw Error("Not implemented");},node:function(){return this._snapshot.createNode(this.nodeIndex())},nodeIndex:function(){return this._edges.item(this.edgeIndex+this._snapshot._edgeToNodeOffset)},rawEdges:function(){return this._edges},toString:function(){return"HeapSnapshotEdge: "+this.name()},
type:function(){return this._snapshot._edgeTypes[this._type()]},serialize:function(){var a=this.node();return{name:this.name(),node:a.serialize(),nodeIndex:this.nodeIndex(),type:this.type(),distance:a.distance()}},_type:function(){return this._edges.item(this.edgeIndex+this._snapshot._edgeTypeOffset)}};WebInspector.HeapSnapshotEdgeIterator=function(a){this.edge=a};
WebInspector.HeapSnapshotEdgeIterator.prototype={rewind:function(){this.edge.edgeIndex=0},hasNext:function(){return this.edge.edgeIndex<this.edge._edges.length},index:function(){return this.edge.edgeIndex},setIndex:function(a){this.edge.edgeIndex=a},item:function(){return this.edge},next:function(){this.edge.edgeIndex+=this.edge._snapshot._edgeFieldsCount}};
WebInspector.HeapSnapshotRetainerEdge=function(a,b,c){this._snapshot=a;this._retainedNodeIndex=b;b/=a._nodeFieldCount;this._firstRetainer=a._firstRetainerIndex[b];this._retainersCount=a._firstRetainerIndex[b+1]-this._firstRetainer;this.setRetainerIndex(c)};
WebInspector.HeapSnapshotRetainerEdge.prototype={clone:function(){return new WebInspector.HeapSnapshotRetainerEdge(this._snapshot,this._retainedNodeIndex,this.retainerIndex())},hasStringName:function(){return this._edge().hasStringName()},name:function(){return this._edge().name()},node:function(){return this._node()},nodeIndex:function(){return this._nodeIndex},retainerIndex:function(){return this._retainerIndex},setRetainerIndex:function(a){a!==this._retainerIndex&&(this.edgeIndex=this._retainerIndex=
a)},set edgeIndex(a){a=this._firstRetainer+a;this._globalEdgeIndex=this._snapshot._retainingEdges[a];this._nodeIndex=this._snapshot._retainingNodes[a];delete this._edgeInstance;delete this._nodeInstance},_node:function(){this._nodeInstance||(this._nodeInstance=this._snapshot.createNode(this._nodeIndex));return this._nodeInstance},_edge:function(){if(!this._edgeInstance){var a=this._globalEdgeIndex-this._node()._edgeIndexesStart();this._edgeInstance=this._snapshot.createEdge(this._node().rawEdges(),
a)}return this._edgeInstance},toString:function(){return this._edge().toString()},serialize:function(){var a=this.node();return{name:this.name(),node:a.serialize(),nodeIndex:this.nodeIndex(),type:this.type(),distance:a.distance()}},type:function(){return this._edge().type()}};WebInspector.HeapSnapshotRetainerEdgeIterator=function(a){this.retainer=a};
WebInspector.HeapSnapshotRetainerEdgeIterator.prototype={rewind:function(){this.retainer.setRetainerIndex(0)},hasNext:function(){return this.retainer.retainerIndex()<this.retainer._retainersCount},index:function(){return this.retainer.retainerIndex()},setIndex:function(a){this.retainer.setRetainerIndex(a)},item:function(){return this.retainer},next:function(){this.retainer.setRetainerIndex(this.retainer.retainerIndex()+1)}};
WebInspector.HeapSnapshotNode=function(a,b){this._snapshot=a;this.nodeIndex=this._firstNodeIndex=b};
WebInspector.HeapSnapshotNode.prototype={distance:function(){return this._snapshot._nodeDistances[this.nodeIndex/this._snapshot._nodeFieldCount]},className:function(){throw Error("Not implemented");},classIndex:function(){throw Error("Not implemented");},dominatorIndex:function(){return this._snapshot._dominatorsTree[this.nodeIndex/this._snapshot._nodeFieldCount]*this._snapshot._nodeFieldCount},edges:function(){return new WebInspector.HeapSnapshotEdgeIterator(this._snapshot.createEdge(this.rawEdges(),0))},
edgesCount:function(){return(this._edgeIndexesEnd()-this._edgeIndexesStart())/this._snapshot._edgeFieldsCount},id:function(){throw Error("Not implemented");},isRoot:function(){return this.nodeIndex===this._snapshot._rootNodeIndex},name:function(){return this._snapshot._strings[this._name()]},rawEdges:function(){return new WebInspector.HeapSnapshotArraySlice(this._snapshot._containmentEdges,this._edgeIndexesStart(),this._edgeIndexesEnd())},retainedSize:function(){var a=this._snapshot;return a._nodes[this.nodeIndex+
a._nodeRetainedSizeOffset]},retainers:function(){return new WebInspector.HeapSnapshotRetainerEdgeIterator(this._snapshot.createRetainingEdge(this.nodeIndex,0))},selfSize:function(){var a=this._snapshot;return a._nodes[this.nodeIndex+a._nodeSelfSizeOffset]},type:function(){return this._snapshot._nodeTypes[this._type()]},serialize:function(){return{id:this.id(),name:this.name(),distance:this.distance(),nodeIndex:this.nodeIndex,retainedSize:this.retainedSize(),selfSize:this.selfSize(),type:this.type()}},
_name:function(){var a=this._snapshot;return a._nodes[this.nodeIndex+a._nodeNameOffset]},_edgeIndexesStart:function(){return this._snapshot._firstEdgeIndexes[this._ordinal()]},_edgeIndexesEnd:function(){return this._snapshot._firstEdgeIndexes[this._ordinal()+1]},_ordinal:function(){return this.nodeIndex/this._snapshot._nodeFieldCount},_nextNodeIndex:function(){return this.nodeIndex+this._snapshot._nodeFieldCount},_type:function(){var a=this._snapshot;return a._nodes[this.nodeIndex+a._nodeTypeOffset]}};
WebInspector.HeapSnapshotNodeIterator=function(a){this.node=a;this._nodesLength=a._snapshot._nodes.length};WebInspector.HeapSnapshotNodeIterator.prototype={rewind:function(){this.node.nodeIndex=this.node._firstNodeIndex},hasNext:function(){return this.node.nodeIndex<this._nodesLength},index:function(){return this.node.nodeIndex},setIndex:function(a){this.node.nodeIndex=a},item:function(){return this.node},next:function(){this.node.nodeIndex=this.node._nextNodeIndex()}};
WebInspector.HeapSnapshot=function(a){this.uid=a.snapshot.uid;this._nodes=a.nodes;this._containmentEdges=a.edges;this._metaNode=a.snapshot.meta;this._strings=a.strings;this._rootNodeIndex=0;a.snapshot.root_index&&(this._rootNodeIndex=a.snapshot.root_index);this._snapshotDiffs={};this._aggregatesForDiff=null;this._init()};function HeapSnapshotMetainfo(){this.node_fields=[];this.node_types=[];this.edge_fields=[];this.edge_types=[];this.type_strings={};this.fields=[];this.types=[]}
function HeapSnapshotHeader(){this.title="";this.uid=0;this.meta=new HeapSnapshotMetainfo;this.edge_count=this.node_count=0}
WebInspector.HeapSnapshot.prototype={_init:function(){var a=this._metaNode;this._nodeTypeOffset=a.node_fields.indexOf("type");this._nodeNameOffset=a.node_fields.indexOf("name");this._nodeIdOffset=a.node_fields.indexOf("id");this._nodeSelfSizeOffset=a.node_fields.indexOf("self_size");this._nodeEdgeCountOffset=a.node_fields.indexOf("edge_count");this._nodeFieldCount=a.node_fields.length;this._nodeTypes=a.node_types[this._nodeTypeOffset];this._nodeHiddenType=this._nodeTypes.indexOf("hidden");this._nodeObjectType=
this._nodeTypes.indexOf("object");this._nodeNativeType=this._nodeTypes.indexOf("native");this._nodeCodeType=this._nodeTypes.indexOf("code");this._nodeSyntheticType=this._nodeTypes.indexOf("synthetic");this._edgeFieldsCount=a.edge_fields.length;this._edgeTypeOffset=a.edge_fields.indexOf("type");this._edgeNameOffset=a.edge_fields.indexOf("name_or_index");this._edgeToNodeOffset=a.edge_fields.indexOf("to_node");this._edgeTypes=a.edge_types[this._edgeTypeOffset];this._edgeTypes.push("invisible");this._edgeElementType=
this._edgeTypes.indexOf("element");this._edgeHiddenType=this._edgeTypes.indexOf("hidden");this._edgeInternalType=this._edgeTypes.indexOf("internal");this._edgeShortcutType=this._edgeTypes.indexOf("shortcut");this._edgeWeakType=this._edgeTypes.indexOf("weak");this._edgeInvisibleType=this._edgeTypes.indexOf("invisible");this.nodeCount=this._nodes.length/this._nodeFieldCount;this._edgeCount=this._containmentEdges.length/this._edgeFieldsCount;this._buildEdgeIndexes();this._markInvisibleEdges();this._buildRetainers();
this._calculateFlags();this._calculateDistances();a=this._buildPostOrderIndex();this._dominatorsTree=this._buildDominatorTree(a.postOrderIndex2NodeOrdinal,a.nodeOrdinal2PostOrderIndex);this._calculateRetainedSizes(a.postOrderIndex2NodeOrdinal);this._buildDominatedNodes()},_buildEdgeIndexes:function(){var a=this._nodes,b=this.nodeCount,c=this._firstEdgeIndexes=new Uint32Array(b+1),e=this._nodeFieldCount,d=this._edgeFieldsCount,f=this._nodeEdgeCountOffset;c[b]=this._containmentEdges.length;for(var g=
0,h=0;g<b;++g)c[g]=h,h+=a[g*e+f]*d},_buildRetainers:function(){for(var a=this._retainingNodes=new Uint32Array(this._edgeCount),b=this._retainingEdges=new Uint32Array(this._edgeCount),c=this._firstRetainerIndex=new Uint32Array(this.nodeCount+1),e=this._containmentEdges,d=this._edgeFieldsCount,f=this._nodeFieldCount,g=this._edgeToNodeOffset,h=this._firstEdgeIndexes,k=this.nodeCount,l=g,m=e.length;l<m;l+=d){var n=e[l];if(n%f)throw Error("Invalid toNodeIndex "+n);++c[n/f]}for(m=l=0;l<k;l++){var p=c[l];
c[l]=m;a[m]=p;m+=p}c[k]=a.length;l=h[0];for(m=0;m<k;++m)for(var n=l,l=h[m+1],p=m*f,q=n;q<l;q+=d){n=e[q+g];if(n%f)throw Error("Invalid toNodeIndex "+n);n=c[n/f];n+=--a[n];a[n]=p;b[n]=q}},createNode:function(a){throw Error("Not implemented");},createEdge:function(a,b){throw Error("Not implemented");},createRetainingEdge:function(a,b){throw Error("Not implemented");},dispose:function(){delete this._nodes;delete this._strings;delete this._retainingEdges;delete this._retainingNodes;delete this._firstRetainerIndex;
this._aggregates&&(delete this._aggregates,delete this._aggregatesSortedFlags);delete this._dominatedNodes;delete this._firstDominatedNodeIndex;delete this._nodeDistances;delete this._dominatorsTree},_allNodes:function(){return new WebInspector.HeapSnapshotNodeIterator(this.rootNode())},rootNode:function(){return this.createNode(this._rootNodeIndex)},get rootNodeIndex(){return this._rootNodeIndex},get totalSize(){return this.rootNode().retainedSize()},_getDominatedIndex:function(a){if(a%this._nodeFieldCount)throw Error("Invalid nodeIndex: "+
a);return this._firstDominatedNodeIndex[a/this._nodeFieldCount]},_dominatedNodesOfNode:function(a){var b=this._getDominatedIndex(a.nodeIndex);a=this._getDominatedIndex(a._nextNodeIndex());return new WebInspector.HeapSnapshotArraySlice(this._dominatedNodes,b,a)},aggregates:function(a,b,c){this._aggregates||(this._aggregates={},this._aggregatesSortedFlags={});var e=this._aggregates[b];if(e)return a&&!this._aggregatesSortedFlags[b]&&(this._sortAggregateIndexes(e),this._aggregatesSortedFlags[b]=a),e;
var d;c&&(d=this._parseFilter(c));c=this._buildAggregates(d);this._calculateClassesRetainedSize(c.aggregatesByClassIndex,d);e=c.aggregatesByClassName;a&&this._sortAggregateIndexes(e);this._aggregatesSortedFlags[b]=a;return this._aggregates[b]=e},aggregatesForDiff:function(){if(this._aggregatesForDiff)return this._aggregatesForDiff;var a=this.aggregates(!0,"allObjects");this._aggregatesForDiff={};var b=this.createNode(),c;for(c in a){for(var e=a[c].idxs,d=Array(e.length),f=Array(e.length),g=0;g<e.length;g++)b.nodeIndex=
e[g],d[g]=b.id(),f[g]=b.selfSize();this._aggregatesForDiff[c]={indexes:e,ids:d,selfSizes:f}}return this._aggregatesForDiff},distanceForUserRoot:function(a){return 1},_calculateDistances:function(){for(var a=this._nodeFieldCount,b=new Uint32Array(this.nodeCount),c=new Uint32Array(this.nodeCount),e=0,d=this.rootNode().edges();d.hasNext();d.next()){var f=d.edge.node(),g=this.distanceForUserRoot(f);-1!==g&&(c[e++]=f.nodeIndex,b[f.nodeIndex/a]=g)}this._bfs(c,e,b);e=0;c[e++]=this._rootNodeIndex;b[this._rootNodeIndex/
a]=1;this._bfs(c,e,b);this._nodeDistances=b},_bfs:function(a,b,c){for(var e=this._edgeFieldsCount,d=this._nodeFieldCount,f=this._containmentEdges,g=this._firstEdgeIndexes,h=this._edgeToNodeOffset,k=this._edgeTypeOffset,l=this.nodeCount,m=this._edgeWeakType,n=0;n<b;)for(var p=a[n++]/d,q=c[p]+1,s=g[p+1],p=g[p];p<s;p+=e)if(f[p+k]!=m){var r=f[p+h],t=r/d;c[t]||(c[t]=q,a[b++]=r)}if(b>l)throw Error("BFS failed. Nodes to visit ("+b+") is more than nodes count ("+l+")");},_buildAggregates:function(a){for(var b=
{},c={},e=[],d=this._nodes,f=this.userObjectsMapAndFlag(),g=f?f.map:null,h=f?f.flag:0,k=d.length,l=this._nodeNativeType,m=this._nodeFieldCount,n=this._nodeSelfSizeOffset,p=this._nodeTypeOffset,q=this.rootNode(),s=this._nodeDistances,r=0;r<k;r+=m){var t=r/m;if(!g||g[t]&h)if(q.nodeIndex=r,!a||a(q)){var u=d[r+n];if(u||d[r+p]===l)if(f=q.classIndex(),f in b)f=b[f],f.distance=Math.min(f.distance,s[t]),++f.count,f.self+=u,f.idxs.push(r);else{var w=q.type(),t={count:1,distance:s[t],self:u,maxRet:0,type:w,
name:"object"===w||"native"===w?q.name():null,idxs:[r]};b[f]=t;e.push(f);c[q.className()]=t}}}a=0;for(d=e.length;a<d;++a)f=e[a],b[f].idxs=b[f].idxs.slice();return{aggregatesByClassName:c,aggregatesByClassIndex:b}},_calculateClassesRetainedSize:function(a,b){for(var c=this._rootNodeIndex,e=this.createNode(c),c=[c],d=[-1],f=[],g={},h=this._nodeFieldCount,k=this._nodeTypeOffset,l=this._nodeNativeType,m=this._dominatedNodes,n=this._nodes,p=this.userObjectsMapAndFlag(),q=p?p.map:null,p=p?p.flag:0,s=this._firstDominatedNodeIndex;c.length;){var r=
c.pop();e.nodeIndex=r;var t=e.classIndex(),u=r/h,w=s[u],v=s[u+1];g[t]||q&&!(q[u]&p)||b&&!b(e)||!e.selfSize()&&n[r+k]!==l||(a[t].maxRet+=e.retainedSize(),w!==v&&(g[t]=!0,d.push(c.length),f.push(t)));for(t=w;t<v;t++)c.push(m[t]);for(v=c.length;d[d.length-1]===v;)d.pop(),t=f.pop(),g[t]=!1}},_sortAggregateIndexes:function(a){var b=this.createNode(),c=this.createNode(),e;for(e in a)a[e].idxs.sort(function(a,e){b.nodeIndex=a;c.nodeIndex=e;return b.id()<c.id()?-1:1})},_buildPostOrderIndex:function(){var a=
this._nodeFieldCount,b=this.nodeCount,c=this._rootNodeIndex/a,e=this._edgeFieldsCount,d=this._edgeTypeOffset,f=this._edgeToNodeOffset,g=this._edgeShortcutType,h=this._firstEdgeIndexes,k=this._containmentEdges,l=this.userObjectsMapAndFlag(),m=l?l.map:null,n=l?l.flag:0,p=new Uint32Array(b),q=new Uint32Array(b),s=new Uint32Array(b),l=new Uint8Array(b),r=0,t=0;p[r++]=c;for(l[c]=1;r;){var u=p[r-1];if(1===l[u]){l[u]=2;for(var w=!m||m[u]&n,v=h[u+1],E=h[u];E<v;E+=e)if(u===c||k[E+d]!==g){var D=k[E+f]/a,N=
!m||m[D]&n;u!==c&&N&&!w||l[D]||(l[D]=1,p[r++]=D)}}else s[u]=t,q[t++]=u,--r}if(t!==b){c=this.rootNode();for(e=0;e<b;++e)if(2!==l[e])for(c.nodeIndex=e*a,console.log(JSON.stringify(c.serialize())),d=c.retainers();d;)console.log("edgeName: "+d.item().name()+" nodeClassName: "+d.item().node().className()),d=d.item().node().retainers();throw Error("Postordering failed. "+(b-t)+" hanging nodes");}return{postOrderIndex2NodeOrdinal:q,nodeOrdinal2PostOrderIndex:s}},_buildDominatorTree:function(a,b){for(var c=
this._nodeFieldCount,e=this._firstRetainerIndex,d=this._retainingNodes,f=this._retainingEdges,g=this._edgeFieldsCount,h=this._edgeTypeOffset,k=this._edgeToNodeOffset,l=this._edgeShortcutType,m=this._firstEdgeIndexes,n=this._containmentEdges,p=this._rootNodeIndex,q=this.userObjectsMapAndFlag(),s=q?q.map:null,r=q?q.flag:0,t=a.length,u=t-1,q=new Uint32Array(t),w=0;w<u;++w)q[w]=t;q[u]=u;var v=new Uint8Array(t),E;E=this._rootNodeIndex/c;for(var D=m[E]+k,N=m[E+1];D<N;D+=g){var x=n[D]/c;v[b[x]]=1}for(var G=
!0;G;)for(G=!1,w=u-1;0<=w;--w)if(0!==v[w]&&(v[w]=0,q[w]!==u)){E=a[w];N=!s||s[E]&r;D=t;x=e[E+1];for(E=e[E];E<x;++E){var C=n[f[E]+h],P=d[E];if(P===p||C!==l){var C=P/c,ca=!s||s[C]&r;if(P===p||!N||ca)if(P=b[C],q[P]!==t){if(D===t)D=P;else for(;P!==D;){for(;P<D;)P=q[P];for(;D<P;)D=q[D]}if(D===u)break}}}if(D!==t&&q[w]!==D)for(q[w]=D,G=!0,E=a[w],D=m[E]+k,N=m[E+1];D<N;D+=g)x=n[D]/c,v[b[x]]=1}c=new Uint32Array(t);w=0;for(e=q.length;w<e;++w)E=a[w],c[E]=a[q[w]];return c},_calculateRetainedSizes:function(a){var b=
this.nodeCount,c=this._nodes,e=this._nodeSelfSizeOffset,d=this._nodeFieldCount,f=this._dominatorsTree,g=this._nodeRetainedSizeOffset=this._nodeEdgeCountOffset;delete this._nodeEdgeCountOffset;for(var h=0,k=c.length;h<k;h+=d)c[h+g]=c[h+e];for(e=0;e<b-1;++e)k=a[e],h=k*d,c[f[k]*d+g]+=c[h+g]},_buildDominatedNodes:function(){var a=this._firstDominatedNodeIndex=new Uint32Array(this.nodeCount+1),b=this._dominatedNodes=new Uint32Array(this.nodeCount-1),c=this._nodeFieldCount,e=this._dominatorsTree,d=0,f=
this.nodeCount,g=this._rootNodeIndex/c;if(g===d)d=1;else if(g===f-1)f-=1;else throw Error("Root node is expected to be either first or last");for(g=d;g<f;++g)++a[e[g]];for(var h=g=0,k=this.nodeCount;h<k;++h){var l=b[g]=a[h];a[h]=g;g+=l}a[this.nodeCount]=b.length;for(g=d;g<f;++g)d=a[e[g]],d+=--b[d],b[d]=g*c},_markInvisibleEdges:function(){throw Error("Not implemented");},_numbersComparator:function(a,b){return a<b?-1:a>b?1:0},_calculateFlags:function(){throw Error("Not implemented");},userObjectsMapAndFlag:function(){throw Error("Not implemented");
},calculateSnapshotDiff:function(a,b){var c=this._snapshotDiffs[a];if(c)return c;var c={},e=this.aggregates(!0,"allObjects"),d;for(d in b){var f=this._calculateDiffForClass(b[d],e[d]);f&&(c[d]=f)}f={ids:[],indexes:[],selfSizes:[]};for(d in e)d in b||(c[d]=this._calculateDiffForClass(f,e[d]));return this._snapshotDiffs[a]=c},_calculateDiffForClass:function(a,b){for(var c=a.ids,e=a.indexes,d=a.selfSizes,f=b?b.idxs:[],g=0,h=c.length,k=0,l=f.length,m={addedCount:0,removedCount:0,addedSize:0,removedSize:0,
deletedIndexes:[],addedIndexes:[]},n=this.createNode(f[k]);g<h&&k<l;){var p=c[g];p<n.id()?(m.deletedIndexes.push(e[g]),m.removedCount++,m.removedSize+=d[g],++g):(p>n.id()?(m.addedIndexes.push(f[k]),m.addedCount++,m.addedSize+=n.selfSize()):++g,n.nodeIndex=f[++k])}for(;g<h;)m.deletedIndexes.push(e[g]),m.removedCount++,m.removedSize+=d[g],++g;for(;k<l;)m.addedIndexes.push(f[k]),m.addedCount++,m.addedSize+=n.selfSize(),n.nodeIndex=f[++k];m.countDelta=m.addedCount-m.removedCount;m.sizeDelta=m.addedSize-
m.removedSize;return m.addedCount||m.removedCount?m:null},_nodeForSnapshotObjectId:function(a){for(var b=this._allNodes();b.hasNext();b.next())if(b.node.id()===a)return b.node;return null},nodeClassName:function(a){return(a=this._nodeForSnapshotObjectId(a))?a.className():null},dominatorIdsForNode:function(a){a=this._nodeForSnapshotObjectId(a);if(!a)return null;for(var b=[];!a.isRoot();)b.push(a.id()),a.nodeIndex=a.dominatorIndex();return b},_parseFilter:function(a){return a?eval("(function(){return "+
a+"})()").bind(this):null},createEdgesProvider:function(a,b){var c=this.createNode(a),e=this.containmentEdgesFilter(b);return new WebInspector.HeapSnapshotEdgesProvider(this,e,c.edges())},createEdgesProviderForTest:function(a,b){var c=this.createNode(a);return new WebInspector.HeapSnapshotEdgesProvider(this,b,c.edges())},retainingEdgesFilter:function(a){return null},containmentEdgesFilter:function(a){return null},createRetainingEdgesProvider:function(a,b){var c=this.createNode(a),e=this.retainingEdgesFilter(b);
return new WebInspector.HeapSnapshotEdgesProvider(this,e,c.retainers())},createAddedNodesProvider:function(a,b){return new WebInspector.HeapSnapshotNodesProvider(this,null,this._snapshotDiffs[a][b].addedIndexes)},createDeletedNodesProvider:function(a){return new WebInspector.HeapSnapshotNodesProvider(this,null,a)},classNodesFilter:function(){return null},createNodesProviderForClass:function(a,b){return new WebInspector.HeapSnapshotNodesProvider(this,this.classNodesFilter(),this.aggregates(!1,b)[a].idxs)},
createNodesProviderForDominator:function(a){a=this.createNode(a);return new WebInspector.HeapSnapshotNodesProvider(this,null,this._dominatedNodesOfNode(a))},updateStaticData:function(){return{nodeCount:this.nodeCount,rootNodeIndex:this._rootNodeIndex,totalSize:this.totalSize,uid:this.uid}}};
WebInspector.HeapSnapshotFilteredOrderedIterator=function(a,b,c){this._filter=b;this._iterator=a;this._unfilteredIterationOrder=c;this._iterationOrder=null;this._position=0;this._currentComparator=null;this._sortedPrefixLength=0};
WebInspector.HeapSnapshotFilteredOrderedIterator.prototype={_createIterationOrder:function(){if(!this._iterationOrder)if(this._unfilteredIterationOrder&&!this._filter)this._iterationOrder=this._unfilteredIterationOrder.slice(0),this._unfilteredIterationOrder=null;else{this._iterationOrder=[];var a=this._iterator;if(this._unfilteredIterationOrder||this._filter)if(this._unfilteredIterationOrder){for(var b=this._unfilteredIterationOrder.constructor===Array?this._unfilteredIterationOrder:this._unfilteredIterationOrder.slice(0),
c=0,e=b.length;c<e;++c)a.setIndex(b[c]),this._filter(a.item())&&this._iterationOrder.push(a.index());this._unfilteredIterationOrder=null}else for(a.rewind();a.hasNext();a.next())this._filter(a.item())&&this._iterationOrder.push(a.index());else for(a.rewind();a.hasNext();a.next())this._iterationOrder.push(a.index())}},rewind:function(){this._position=0},hasNext:function(){return this._position<this._iterationOrder.length},isEmpty:function(){if(this._iterationOrder)return!this._iterationOrder.length;
if(this._unfilteredIterationOrder&&!this._filter)return!this._unfilteredIterationOrder.length;var a=this._iterator;if(this._unfilteredIterationOrder||this._filter)if(this._unfilteredIterationOrder)for(var b=this._unfilteredIterationOrder.constructor===Array?this._unfilteredIterationOrder:this._unfilteredIterationOrder.slice(0),c=0,e=b.length;c<e;++c){if(a.setIndex(b[c]),this._filter(a.item()))return!1}else for(a.rewind();a.hasNext();a.next()){if(this._filter(a.item()))return!1}else return a.rewind(),
!a.hasNext();return!0},item:function(){this._iterator.setIndex(this._iterationOrder[this._position]);return this._iterator.item()},get length(){this._createIterationOrder();return this._iterationOrder.length},next:function(){++this._position},serializeItemsRange:function(a,b){this._createIterationOrder();if(a>b)throw Error("Start position > end position: "+a+" > "+b);b>=this._iterationOrder.length&&(b=this._iterationOrder.length);this._sortedPrefixLength<b&&(this.sort(this._currentComparator,this._sortedPrefixLength,
this._iterationOrder.length-1,b-this._sortedPrefixLength),this._sortedPrefixLength=b);for(var c=this._position=a,e=b-a,d=Array(e),f=0;f<e&&this.hasNext();++f,this.next())d[f]=this.item().serialize();d.length=f;d.totalLength=this._iterationOrder.length;d.startPosition=c;d.endPosition=this._position;return d},sortAll:function(){this._createIterationOrder();this._sortedPrefixLength!==this._iterationOrder.length&&(this.sort(this._currentComparator,this._sortedPrefixLength,this._iterationOrder.length-
1,this._iterationOrder.length),this._sortedPrefixLength=this._iterationOrder.length)},sortAndRewind:function(a){this._currentComparator=a;this._sortedPrefixLength=0;this.rewind()}};WebInspector.HeapSnapshotFilteredOrderedIterator.prototype.createComparator=function(a){return{fieldName1:a[0],ascending1:a[1],fieldName2:a[2],ascending2:a[3]}};WebInspector.HeapSnapshotEdgesProvider=function(a,b,c){this.snapshot=a;WebInspector.HeapSnapshotFilteredOrderedIterator.call(this,c,b)};
WebInspector.HeapSnapshotEdgesProvider.prototype={sort:function(a,b,c,e){function d(a,b,c){q.edgeIndex=b;s.edgeIndex=c;if("__proto__"===s.name())return-1;if("__proto__"===q.name())return 1;b=q.hasStringName()===s.hasStringName()?q.name()<s.name()?-1:q.name()>s.name()?1:0:q.hasStringName()?-1:1;return a?b:-b}function f(a,b,c,d){q.edgeIndex=c;r.nodeIndex=q.nodeIndex();c=r[a]();s.edgeIndex=d;t.nodeIndex=s.nodeIndex();a=t[a]();a=c<a?-1:c>a?1:0;return b?a:-a}function g(a,b){var c=d(n,a,b);0===c&&(c=f(m,
p,a,b));return c}function h(a,b){var c=f(l,n,a,b);0===c&&(c=d(p,a,b));return c}function k(a,b){var c=f(l,n,a,b);0===c&&(c=f(m,p,a,b));return c}var l=a.fieldName1,m=a.fieldName2,n=a.ascending1,p=a.ascending2,q=this._iterator.item().clone(),s=q.clone(),r=this.snapshot.createNode(),t=this.snapshot.createNode();"!edgeName"===l?this._iterationOrder.sortRange(g,b,c,e):"!edgeName"===m?this._iterationOrder.sortRange(h,b,c,e):this._iterationOrder.sortRange(k,b,c,e)},__proto__:WebInspector.HeapSnapshotFilteredOrderedIterator.prototype};
WebInspector.HeapSnapshotNodesProvider=function(a,b,c){this.snapshot=a;WebInspector.HeapSnapshotFilteredOrderedIterator.call(this,a._allNodes(),b,c)};
WebInspector.HeapSnapshotNodesProvider.prototype={nodePosition:function(a){this._createIterationOrder();if(this.isEmpty())return-1;this.sortAll();for(var b=this.snapshot.createNode(),c=0;c<this._iterationOrder.length;c++)if(b.nodeIndex=this._iterationOrder[c],b.id()===a)return c;return-1},sort:function(a,b,c,e){function d(a,b){var c=l[a],c="function"!==typeof c?c:c.call(l),d=m[a],d="function"!==typeof d?d:d.call(m),c=c<d?-1:c>d?1:0;return b?c:-c}var f=a.fieldName1,g=a.fieldName2,h=a.ascending1,k=
a.ascending2,l=this.snapshot.createNode(),m=this.snapshot.createNode();this._iterationOrder.sortRange(function(a,b){l.nodeIndex=a;m.nodeIndex=b;var c=d(f,h);0===c&&(c=d(g,k));return c},b,c,e)},__proto__:WebInspector.HeapSnapshotFilteredOrderedIterator.prototype};
WebInspector.HeapSnapshotSortableDataGrid=function(a){WebInspector.DataGrid.call(this,a);this._recursiveSortingDepth=0;this._highlightedNode=null;this._populatedAndSorted=!1;this.addEventListener("sorting complete",this._sortingComplete,this);this.addEventListener(WebInspector.DataGrid.Events.SortingChanged,this.sortingChanged,this)};WebInspector.HeapSnapshotSortableDataGrid.Events={ContentShown:"ContentShown"};
WebInspector.HeapSnapshotSortableDataGrid.prototype={defaultPopulateCount:function(){return 100},dispose:function(){for(var a=this.topLevelNodes(),b=0,c=a.length;b<c;++b)a[b].dispose()},wasShown:function(){this._populatedAndSorted&&this.dispatchEventToListeners(WebInspector.HeapSnapshotSortableDataGrid.Events.ContentShown,this)},_sortingComplete:function(){this.removeEventListener("sorting complete",this._sortingComplete,this);this._populatedAndSorted=!0;this.dispatchEventToListeners(WebInspector.HeapSnapshotSortableDataGrid.Events.ContentShown,
this)},willHide:function(){this._clearCurrentHighlight()},populateContextMenu:function(a,b,c){if(c=c.target.enclosingNodeOrSelfWithNodeName("td")){var e=c.heapSnapshotNode;e instanceof WebInspector.HeapSnapshotInstanceNode||e instanceof WebInspector.HeapSnapshotObjectNode?b.appendItem(WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?"Reveal in Dominators view":"Reveal in Dominators View"),function(){a.showObject(e.snapshotNodeId,"Dominators")}.bind(this)):e instanceof WebInspector.HeapSnapshotDominatorObjectNode&&
b.appendItem(WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?"Reveal in Summary view":"Reveal in Summary View"),function(){a.showObject(e.snapshotNodeId,"Summary")}.bind(this))}},resetSortingCache:function(){delete this._lastSortColumnIdentifier;delete this._lastSortAscending},topLevelNodes:function(){return this.rootNode().children},highlightObjectByHeapSnapshotId:function(a){},highlightNode:function(a){var b=this._highlightedNode;this._clearCurrentHighlight();this._highlightedNode=a;
this._highlightedNode.element.addStyleClass("highlighted-row");if(a===b){a=a.element;var b=a.parentElement,c=a.nextSibling;b.removeChild(a);b.insertBefore(a,c)}},nodeWasDetached:function(a){this._highlightedNode===a&&this._clearCurrentHighlight()},_clearCurrentHighlight:function(){this._highlightedNode&&(this._highlightedNode.element.removeStyleClass("highlighted-row"),this._highlightedNode=null)},changeNameFilter:function(a){a=a.toLowerCase();for(var b=this.topLevelNodes(),c=0,e=b.length;c<e;++c){var d=
b[c];0===d.depth&&(d.revealed=-1!==d._name.toLowerCase().indexOf(a))}this.updateVisibleNodes()},sortingChanged:function(){function a(a,b){var c=a[e[0]],h=b[e[0]],c=c<h?-1:c>h?1:0;e[1]||(c=-c);if(0!==c)return c;c=a[e[2]];h=b[e[2]];c=c<h?-1:c>h?1:0;e[3]||(c=-c);return c}var b=this.isSortOrderAscending(),c=this.sortColumnIdentifier();if(this._lastSortColumnIdentifier!==c||this._lastSortAscending!==b){this._lastSortColumnIdentifier=c;this._lastSortAscending=b;var e=this._sortFields(c,b);this._performSorting(a)}},
_performSorting:function(a){this.recursiveSortingEnter();var b=this._topLevelNodes;this.rootNode().removeChildren();b.sort(a);a=0;for(var c=b.length;a<c;++a){var e=b[a];this.appendChildAfterSorting(e);e.expanded&&e.sort()}this.updateVisibleNodes();this.recursiveSortingLeave()},appendChildAfterSorting:function(a){var b=a.revealed;this.rootNode().appendChild(a);a.revealed=b},updateVisibleNodes:function(){},recursiveSortingEnter:function(){++this._recursiveSortingDepth},recursiveSortingLeave:function(){this._recursiveSortingDepth&&
(--this._recursiveSortingDepth||this.dispatchEventToListeners("sorting complete"))},__proto__:WebInspector.DataGrid.prototype};WebInspector.HeapSnapshotViewportDataGrid=function(a){WebInspector.HeapSnapshotSortableDataGrid.call(this,a);this.scrollContainer.addEventListener("scroll",this._onScroll.bind(this),!0);this._topLevelNodes=[];this._topPadding=new WebInspector.HeapSnapshotPaddingNode;this._bottomPadding=new WebInspector.HeapSnapshotPaddingNode;this._nodeToHighlightAfterScroll=null};
WebInspector.HeapSnapshotViewportDataGrid.prototype={topLevelNodes:function(){return this._topLevelNodes},appendChildAfterSorting:function(a){},updateVisibleNodes:function(){var a=this.scrollContainer.scrollTop,b=this.scrollContainer.offsetHeight;this._removePaddingRows();for(var c=this._topLevelNodes,e=0,d=0;e<c.length;){if(c[e].revealed){var f=d+c[e].nodeHeight();if(f>a)break;d=f}++e}this.rootNode().removeChildren();a=b+(a-d);for(b=0;e<c.length&&b<a;)c[e].revealed&&(this.rootNode().appendChild(c[e]),
b+=c[e].nodeHeight()),++e;for(a=0;e<c.length;)a+=c[e].nodeHeight(),++e;this._addPaddingRows(d,a)},appendTopLevelNode:function(a){this._topLevelNodes.push(a)},removeTopLevelNodes:function(){this.rootNode().removeChildren();this._topLevelNodes=[]},highlightNode:function(a){this._isScrolledIntoView(a.element)?WebInspector.HeapSnapshotSortableDataGrid.prototype.highlightNode.call(this,a):(a.element.scrollIntoViewIfNeeded(!0),this._nodeToHighlightAfterScroll=a)},_isScrolledIntoView:function(a){var b=this.scrollContainer.scrollTop,
c=a.offsetTop;return c+a.offsetHeight<=b+this.scrollContainer.clientHeight&&c>=b},_addPaddingRows:function(a,b){this._topPadding.element.parentNode!==this.dataTableBody&&this.dataTableBody.insertBefore(this._topPadding.element,this.dataTableBody.firstChild);this._bottomPadding.element.parentNode!==this.dataTableBody&&this.dataTableBody.insertBefore(this._bottomPadding.element,this.dataTableBody.lastChild);this._topPadding.setHeight(a);this._bottomPadding.setHeight(b)},_removePaddingRows:function(){this._bottomPadding.removeFromTable();
this._topPadding.removeFromTable()},onResize:function(){WebInspector.HeapSnapshotSortableDataGrid.prototype.onResize.call(this);this.updateVisibleNodes()},_onScroll:function(a){this.updateVisibleNodes();this._nodeToHighlightAfterScroll&&(WebInspector.HeapSnapshotSortableDataGrid.prototype.highlightNode.call(this,this._nodeToHighlightAfterScroll),this._nodeToHighlightAfterScroll=null)},__proto__:WebInspector.HeapSnapshotSortableDataGrid.prototype};
WebInspector.HeapSnapshotPaddingNode=function(){this.element=document.createElement("tr");this.element.addStyleClass("revealed")};WebInspector.HeapSnapshotPaddingNode.prototype={setHeight:function(a){this.element.style.height=a+"px"},removeFromTable:function(){var a=this.element.parentNode;a&&a.removeChild(this.element)}};
WebInspector.HeapSnapshotContainmentDataGrid=function(a){a=a||[{id:"object",title:WebInspector.UIString("Object"),disclosure:!0,sortable:!0},{id:"shallowSize",title:WebInspector.UIString("Shallow Size"),width:"120px",sortable:!0},{id:"retainedSize",title:WebInspector.UIString("Retained Size"),width:"120px",sortable:!0,sort:WebInspector.DataGrid.Order.Descending}];WebInspector.HeapSnapshotSortableDataGrid.call(this,a)};
WebInspector.HeapSnapshotContainmentDataGrid.prototype={setDataSource:function(a,b){this.snapshot=a;var c={node:new WebInspector.HeapSnapshotNode(a,b||a.rootNodeIndex)};this.setRootNode(new WebInspector.HeapSnapshotObjectNode(this,!1,c,null));this.rootNode().sort()},sortingChanged:function(){this.rootNode().sort()},__proto__:WebInspector.HeapSnapshotSortableDataGrid.prototype};
WebInspector.HeapSnapshotRetainmentDataGrid=function(){this.showRetainingEdges=!0;var a=[{id:"object",title:WebInspector.UIString("Object"),disclosure:!0,sortable:!0},{id:"shallowSize",title:WebInspector.UIString("Shallow Size"),width:"120px",sortable:!0},{id:"retainedSize",title:WebInspector.UIString("Retained Size"),width:"120px",sortable:!0},{id:"distance",title:WebInspector.UIString("Distance"),width:"80px",sortable:!0,sort:WebInspector.DataGrid.Order.Ascending}];WebInspector.HeapSnapshotContainmentDataGrid.call(this,
a)};WebInspector.HeapSnapshotRetainmentDataGrid.Events={ExpandRetainersComplete:"ExpandRetainersComplete"};
WebInspector.HeapSnapshotRetainmentDataGrid.prototype={_sortFields:function(a,b){return{object:["_name",b,"_count",!1],count:["_count",b,"_name",!0],shallowSize:["_shallowSize",b,"_name",!0],retainedSize:["_retainedSize",b,"_name",!0],distance:["_distance",b,"_name",!0]}[a]},reset:function(){this.rootNode().removeChildren();this.resetSortingCache()},setDataSource:function(a,b){function c(){this.removeEventListener(WebInspector.HeapSnapshotGridNode.Events.PopulateComplete,c,this);this.expand();if(1===
this.children.length&&0<--d){var a=this.children[0];a.addEventListener(WebInspector.HeapSnapshotGridNode.Events.PopulateComplete,c,a);a.populate()}else e.dispatchEventToListeners(WebInspector.HeapSnapshotRetainmentDataGrid.Events.ExpandRetainersComplete)}WebInspector.HeapSnapshotContainmentDataGrid.prototype.setDataSource.call(this,a,b);var e=this,d=20;this.rootNode().addEventListener(WebInspector.HeapSnapshotGridNode.Events.PopulateComplete,c,this.rootNode())},__proto__:WebInspector.HeapSnapshotContainmentDataGrid.prototype};
WebInspector.HeapSnapshotConstructorsDataGrid=function(){var a=[{id:"object",title:WebInspector.UIString("Constructor"),disclosure:!0,sortable:!0},{id:"distance",title:WebInspector.UIString("Distance"),width:"90px",sortable:!0},{id:"count",title:WebInspector.UIString("Objects Count"),width:"90px",sortable:!0},{id:"shallowSize",title:WebInspector.UIString("Shallow Size"),width:"120px",sortable:!0},{id:"retainedSize",title:WebInspector.UIString("Retained Size"),width:"120px",sort:WebInspector.DataGrid.Order.Descending,
sortable:!0}];WebInspector.HeapSnapshotViewportDataGrid.call(this,a);this._profileIndex=-1;this._topLevelNodes=[];this._objectIdToSelect=null};
WebInspector.HeapSnapshotConstructorsDataGrid.prototype={_sortFields:function(a,b){return{object:["_name",b,"_count",!1],distance:["_distance",b,"_retainedSize",!0],count:["_count",b,"_name",!0],shallowSize:["_shallowSize",b,"_name",!0],retainedSize:["_retainedSize",b,"_name",!0]}[a]},highlightObjectByHeapSnapshotId:function(a){function b(b){for(var e=this.topLevelNodes(),d=0;d<e.length;d++){var f=e[d];if(f._name===b){f.revealNodeBySnapshotObjectId(parseInt(a,10));break}}}this.snapshot?this.snapshot.nodeClassName(parseInt(a,
10),b.bind(this)):this._objectIdToSelect=a},setDataSource:function(a){this.snapshot=a;-1===this._profileIndex&&this._populateChildren();this._objectIdToSelect&&(this.highlightObjectByHeapSnapshotId(this._objectIdToSelect),this._objectIdToSelect=null)},_aggregatesReceived:function(a,b){for(var c in b)this.appendTopLevelNode(new WebInspector.HeapSnapshotConstructorNode(this,c,b[c],a));this.sortingChanged()},_populateChildren:function(){this.dispose();this.removeTopLevelNodes();this.resetSortingCache();
var a=-1===this._profileIndex?"allObjects":this._minNodeId+".."+this._maxNodeId;this.snapshot.aggregates(!1,a,-1===this._profileIndex?null:"function(node) { var id = node.id(); return id > "+this._minNodeId+" && id <= "+this._maxNodeId+"; }",this._aggregatesReceived.bind(this,a))},filterSelectIndexChanged:function(a,b){this._profileIndex=b;delete this._maxNodeId;delete this._minNodeId;-1!==this._profileIndex&&(this._minNodeId=0<b?a[b-1].maxJSObjectId:0,this._maxNodeId=a[b].maxJSObjectId);this._populateChildren()},
__proto__:WebInspector.HeapSnapshotViewportDataGrid.prototype};
WebInspector.HeapSnapshotDiffDataGrid=function(){var a=[{id:"object",title:WebInspector.UIString("Constructor"),disclosure:!0,sortable:!0},{id:"addedCount",title:WebInspector.UIString("# New"),width:"72px",sortable:!0},{id:"removedCount",title:WebInspector.UIString("# Deleted"),width:"72px",sortable:!0},{id:"countDelta",title:"# Delta",width:"64px",sortable:!0},{id:"addedSize",title:WebInspector.UIString("Alloc. Size"),width:"72px",sortable:!0,sort:WebInspector.DataGrid.Order.Descending},{id:"removedSize",
title:WebInspector.UIString("Freed Size"),width:"72px",sortable:!0},{id:"sizeDelta",title:"Size Delta",width:"72px",sortable:!0}];WebInspector.HeapSnapshotViewportDataGrid.call(this,a)};
WebInspector.HeapSnapshotDiffDataGrid.prototype={defaultPopulateCount:function(){return 50},_sortFields:function(a,b){return{object:["_name",b,"_count",!1],addedCount:["_addedCount",b,"_name",!0],removedCount:["_removedCount",b,"_name",!0],countDelta:["_countDelta",b,"_name",!0],addedSize:["_addedSize",b,"_name",!0],removedSize:["_removedSize",b,"_name",!0],sizeDelta:["_sizeDelta",b,"_name",!0]}[a]},setDataSource:function(a){this.snapshot=a},setBaseDataSource:function(a){this.baseSnapshot=a;this.dispose();
this.removeTopLevelNodes();this.resetSortingCache();this.baseSnapshot===this.snapshot?this.dispatchEventToListeners("sorting complete"):this._populateChildren()},_populateChildren:function(){this.baseSnapshot.aggregatesForDiff(function(a){this.snapshot.calculateSnapshotDiff(this.baseSnapshot.uid,a,function(a){for(var c in a)this.appendTopLevelNode(new WebInspector.HeapSnapshotDiffNode(this,c,a[c]));this.sortingChanged()}.bind(this))}.bind(this))},__proto__:WebInspector.HeapSnapshotViewportDataGrid.prototype};
WebInspector.HeapSnapshotDominatorsDataGrid=function(){var a=[{id:"object",title:WebInspector.UIString("Object"),disclosure:!0,sortable:!0},{id:"shallowSize",title:WebInspector.UIString("Shallow Size"),width:"120px",sortable:!0},{id:"retainedSize",title:WebInspector.UIString("Retained Size"),width:"120px",sort:WebInspector.DataGrid.Order.Descending,sortable:!0}];WebInspector.HeapSnapshotSortableDataGrid.call(this,a);this._objectIdToSelect=null};
WebInspector.HeapSnapshotDominatorsDataGrid.prototype={defaultPopulateCount:function(){return 25},setDataSource:function(a){this.snapshot=a;this.setRootNode(new WebInspector.HeapSnapshotDominatorObjectNode(this,{nodeIndex:this.snapshot.rootNodeIndex}));this.rootNode().sort();this._objectIdToSelect&&(this.highlightObjectByHeapSnapshotId(this._objectIdToSelect),this._objectIdToSelect=null)},sortingChanged:function(){this.rootNode().sort()},highlightObjectByHeapSnapshotId:function(a){function b(a){if(a){var b=
this.rootNode();c.call(this,a,b)}else WebInspector.log(WebInspector.UIString("Cannot find corresponding heap snapshot node"))}function c(a,b){if(b)if(a.length){var f=a.pop();b.retrieveChildBySnapshotObjectId(f,c.bind(this,a))}else this.highlightNode(b),b.element.scrollIntoViewIfNeeded(!0);else console.error("Cannot find dominator node")}this.snapshot?this.snapshot.dominatorIdsForNode(parseInt(a,10),b.bind(this)):this._objectIdToSelect=a},__proto__:WebInspector.HeapSnapshotSortableDataGrid.prototype};
WebInspector.HeapSnapshotGridNode=function(a,b){WebInspector.DataGridNode.call(this,null,b);this._dataGrid=a;this._instanceCount=0;this._savedChildren=null;this._retrievedChildrenRanges=[]};WebInspector.HeapSnapshotGridNode.Events={PopulateComplete:"PopulateComplete"};
WebInspector.HeapSnapshotGridNode.prototype={createProvider:function(){throw Error("Needs implemented.");},_provider:function(){this._providerObject||(this._providerObject=this.createProvider());return this._providerObject},createCell:function(a){a=WebInspector.DataGridNode.prototype.createCell.call(this,a);this._searchMatched&&a.addStyleClass("highlight");return a},collapse:function(){WebInspector.DataGridNode.prototype.collapse.call(this);this._dataGrid.updateVisibleNodes()},dispose:function(){this._provider()&&
this._provider().dispose();for(var a=this.children[0];a;a=a.traverseNextNode(!0,this,!0))a.dispose&&a.dispose()},_reachableFromWindow:!1,queryObjectContent:function(a){},wasDetached:function(){this._dataGrid.nodeWasDetached(this)},_toPercentString:function(a){return a.toFixed(0)+"\u2009%"},childForPosition:function(a){for(var b=0,c=0;c<this._retrievedChildrenRanges.length;c++){var e=this._retrievedChildrenRanges[c];if(e.from<=a&&a<e.to)return this.children[b+a-e.from];b+=e.to-e.from+1}return null},
_createValueCell:function(a){var b=document.createElement("td");b.className=a+"-column";if(0!==this.dataGrid.snapshot.totalSize){var c=document.createElement("div"),e=document.createElement("span");e.textContent=this.data[a];c.appendChild(e);a+="-percent";a in this.data&&(e=document.createElement("span"),e.className="percent-column",e.textContent=this.data[a],c.appendChild(e),c.addStyleClass("heap-snapshot-multiple-values"));b.appendChild(c)}return b},populate:function(a){function b(){this._populateChildren()}
this._populated||(this._populated=!0,this._provider().sortAndRewind(this.comparator(),b.bind(this)))},expandWithoutPopulate:function(a){this._populated=!0;this.expand();this._provider().sortAndRewind(this.comparator(),a)},_populateChildren:function(a,b,c){function e(){if(!(h>=b)){var a=Math.min(h+this._dataGrid.defaultPopulateCount(),b);this._provider().serializeItemsRange(h,a,g.bind(this));h=a}}function d(a,b){if(this._savedChildren){var c=this._childHashForEntity(a);if(c in this._savedChildren){this.insertChild(this._savedChildren[c],
b);return}}this.insertChild(this._createChildNode(a),b)}function f(a,b,c){a=new WebInspector.ShowMoreDataGridNode(this._populateChildren.bind(this),a,b,this._dataGrid.defaultPopulateCount());this.insertChild(a,c)}function g(a){var g=0,m=a.startPosition,n=0;if(this._retrievedChildrenRanges.length){for(var p=0,q=!1,s;p<this._retrievedChildrenRanges.length;){s=this._retrievedChildrenRanges[p];if(s.to>=m){q=!0;break}n+=s.to-s.from;s.to<a.totalLength&&(n+=1);++p}!q||a.startPosition<s.from?(this.children[n-
1].setEndPosition(a.startPosition),f.call(this,a.startPosition,q?s.from:a.totalLength,n),s={from:a.startPosition,to:a.startPosition},q||(p=this._retrievedChildrenRanges.length),this._retrievedChildrenRanges.splice(p,0,s)):n+=m-s.from;for(;s.to<a.endPosition;){var m=s.to-m,n=n+m,g=g+m,m=s.to,r=(q=this._retrievedChildrenRanges[p+1])?q.from:a.totalLength;r>a.endPosition&&(r=a.endPosition);for(;m<r;)d.call(this,a[g++],n++),++m;q&&r===q.from?(s.to=q.to,this.removeChild(this.children[n]),this._retrievedChildrenRanges.splice(p+
1,1)):(s.to=r,r===a.totalLength?this.removeChild(this.children[n]):this.children[n].setStartPosition(a.endPosition))}}else{0<a.startPosition&&(this._retrievedChildrenRanges.push({from:0,to:0}),f.call(this,0,a.startPosition,n++));this._retrievedChildrenRanges.push({from:a.startPosition,to:a.endPosition});g=0;for(p=a.length;g<p;++g)d.call(this,a[g],n++);a.endPosition<a.totalLength&&f.call(this,a.endPosition,a.totalLength,n++)}this._instanceCount+=a.length;h<b?e.call(this):(c&&c(),this.dispatchEventToListeners(WebInspector.HeapSnapshotGridNode.Events.PopulateComplete))}
a=a||0;b=b||a+this._dataGrid.defaultPopulateCount();var h=a;e.call(this)},_saveChildren:function(){this._savedChildren=null;for(var a=0,b=this.children.length;a<b;++a){var c=this.children[a];c.expanded&&(this._savedChildren||(this._savedChildren={}),this._savedChildren[this._childHashForNode(c)]=c)}},sort:function(){this._dataGrid.recursiveSortingEnter();this._provider().sortAndRewind(this.comparator(),function(){this._saveChildren();this.removeChildren();this._retrievedChildrenRanges=[];var a=this._instanceCount;
this._instanceCount=0;this._populateChildren(0,a,function(){for(var a=0,c=this.children.length;a<c;++a){var e=this.children[a];e.expanded&&e.sort()}this._dataGrid.recursiveSortingLeave()}.bind(this))}.bind(this))},__proto__:WebInspector.DataGridNode.prototype};
WebInspector.HeapSnapshotGenericObjectNode=function(a,b){this.snapshotNodeIndex=0;WebInspector.HeapSnapshotGridNode.call(this,a,!1);b&&(this._name=b.name,this._displayName=b.displayName,this._type=b.type,this._distance=b.distance,this._shallowSize=b.selfSize,this._retainedSize=b.retainedSize,this.snapshotNodeId=b.id,this.snapshotNodeIndex=b.nodeIndex,"string"===this._type?this._reachableFromWindow=!0:"object"===this._type&&this._name.startsWith("Window")?(this._name=this.shortenWindowURL(this._name,
!1),this._reachableFromWindow=!0):b.canBeQueried&&(this._reachableFromWindow=!0),b.detachedDOMTreeNode&&(this.detachedDOMTreeNode=!0))};
WebInspector.HeapSnapshotGenericObjectNode.prototype={createCell:function(a){a="object"!==a?this._createValueCell(a):this._createObjectCell();this._searchMatched&&a.addStyleClass("highlight");return a},_createObjectCell:function(){var a=document.createElement("td");a.className="object-column";var b=document.createElement("div");b.className="source-code event-properties";b.style.overflow="visible";var c=this.data.object;this._prefixObjectCell&&this._prefixObjectCell(b,c);var e=document.createElement("span");
e.className="value console-formatted-"+c.valueStyle;e.textContent=c.value;b.appendChild(e);this.data.displayName&&(e=document.createElement("span"),e.className="name console-formatted-name",e.textContent=" "+this.data.displayName,b.appendChild(e));e=document.createElement("span");e.className="console-formatted-id";e.textContent=" @"+c.nodeId;b.appendChild(e);this._postfixObjectCell&&this._postfixObjectCell(b,c);a.appendChild(b);a.addStyleClass("disclosure");this.depth&&a.style.setProperty("padding-left",
this.depth*this.dataGrid.indentWidth+"px");a.heapSnapshotNode=this;return a},get data(){var a=this._emptyData(),b=this._name,c="object";switch(this._type){case "string":b='"'+b+'"';c="string";break;case "regexp":b="/"+b+"/";c="string";break;case "closure":b="function"+(b?" ":"")+b+"()";c="function";break;case "number":c="number";break;case "hidden":c="null";break;case "array":b=b?b+"[]":"[]"}this._reachableFromWindow&&(c+=" highlight");"Object"===b&&(b="");this.detachedDOMTreeNode&&(c+=" detached-dom-tree-node");
a.object={valueStyle:c,value:b,nodeId:this.snapshotNodeId};a.displayName=this._displayName;a.distance=this._distance;a.shallowSize=Number.withThousandsSeparator(this._shallowSize);a.retainedSize=Number.withThousandsSeparator(this._retainedSize);a["shallowSize-percent"]=this._toPercentString(this._shallowSizePercent);a["retainedSize-percent"]=this._toPercentString(this._retainedSizePercent);return this._enhanceData?this._enhanceData(a):a},queryObjectContent:function(a,b){"string"===this._type?a(WebInspector.RemoteObject.fromPrimitiveValue(this._name)):
HeapProfilerAgent.getObjectByHeapObjectId(String(this.snapshotNodeId),b,function(b,e){!b&&e.type?a(WebInspector.RemoteObject.fromPayload(e),!!b):a(WebInspector.RemoteObject.fromPrimitiveValue(WebInspector.UIString("Not available")))})},get _retainedSizePercent(){return this._retainedSize/this.dataGrid.snapshot.totalSize*100},get _shallowSizePercent(){return this._shallowSize/this.dataGrid.snapshot.totalSize*100},updateHasChildren:function(){this._provider().isEmpty(function(a){this.hasChildren=!a}.bind(this))},
shortenWindowURL:function(a,b){var c=a.indexOf("/"),e=b?a.indexOf("@"):a.length;if(-1!==c&&-1!==e){var d=a.substring(c+1,e).trimLeft().trimURL();40<d.length&&(d=d.centerEllipsizedToLength(40));return a.substr(0,c+2)+d+a.substr(e)}return a},__proto__:WebInspector.HeapSnapshotGridNode.prototype};
WebInspector.HeapSnapshotObjectNode=function(a,b,c,e){WebInspector.HeapSnapshotGenericObjectNode.call(this,a,c.node);this._referenceName=c.name;this._referenceType=c.type;this._distance=c.distance;this.showRetainingEdges=a.showRetainingEdges;this._isFromBaseSnapshot=b;this._parentGridNode=e;(this._cycledWithAncestorGridNode=this._findAncestorWithSameSnapshotNodeId())||this.updateHasChildren()};
WebInspector.HeapSnapshotObjectNode.prototype={createProvider:function(){var a=this._dataGrid,b=WebInspector.settings.showHeapSnapshotObjectsHiddenProperties.get(),a=this._isFromBaseSnapshot?a.baseSnapshot:a.snapshot;return this.showRetainingEdges?a.createRetainingEdgesProvider(this.snapshotNodeIndex,b):a.createEdgesProvider(this.snapshotNodeIndex,b)},_findAncestorWithSameSnapshotNodeId:function(){for(var a=this._parentGridNode;a;){if(a.snapshotNodeId===this.snapshotNodeId)return a;a=a._parentGridNode}return null},
_createChildNode:function(a){return new WebInspector.HeapSnapshotObjectNode(this._dataGrid,this._isFromBaseSnapshot,a,this)},_childHashForEntity:function(a){return(this.showRetainingEdges?a.node.id+"#":"")+a.type+"#"+a.name},_childHashForNode:function(a){return(this.showRetainingEdges?a.snapshotNodeId+"#":"")+a._referenceType+"#"+a._referenceName},comparator:function(){var a=this._dataGrid.isSortOrderAscending(),b=this._dataGrid.sortColumnIdentifier();return WebInspector.HeapSnapshotFilteredOrderedIterator.prototype.createComparator({object:["!edgeName",
a,"retainedSize",!1],count:["!edgeName",!0,"retainedSize",!1],shallowSize:["selfSize",a,"!edgeName",!0],retainedSize:["retainedSize",a,"!edgeName",!0],distance:["distance",a,"_name",!0]}[b]||["!edgeName",!0,"retainedSize",!1])},_emptyData:function(){return{count:"",addedCount:"",removedCount:"",countDelta:"",addedSize:"",removedSize:"",sizeDelta:""}},_enhanceData:function(a){var b=this._referenceName;""===b&&(b="(empty)");var c="name";switch(this._referenceType){case "context":c="console-formatted-number";
break;case "internal":case "hidden":c="console-formatted-null";break;case "element":b="["+b+"]"}a.object.nameClass=c;a.object.name=b;a.distance=this._distance;return a},_prefixObjectCell:function(a,b){this._cycledWithAncestorGridNode&&(a.className+=" cycled-ancessor-node");var c=document.createElement("span");c.className=b.nameClass;c.textContent=b.name;a.appendChild(c);c=document.createElement("span");c.className="grayed";c.textContent=this.showRetainingEdges?" in ":" :: ";a.appendChild(c)},__proto__:WebInspector.HeapSnapshotGenericObjectNode.prototype};
WebInspector.HeapSnapshotInstanceNode=function(a,b,c,e){WebInspector.HeapSnapshotGenericObjectNode.call(this,a,e);this._baseSnapshotOrSnapshot=b||c;this._isDeletedNode=!!b;this.updateHasChildren()};
WebInspector.HeapSnapshotInstanceNode.prototype={createProvider:function(){var a=WebInspector.settings.showHeapSnapshotObjectsHiddenProperties.get();return this._baseSnapshotOrSnapshot.createEdgesProvider(this.snapshotNodeIndex,a)},_createChildNode:function(a){return new WebInspector.HeapSnapshotObjectNode(this._dataGrid,this._isDeletedNode,a,null)},_childHashForEntity:function(a){return a.type+"#"+a.name},_childHashForNode:function(a){return a._referenceType+"#"+a._referenceName},comparator:function(){var a=
this._dataGrid.isSortOrderAscending(),b=this._dataGrid.sortColumnIdentifier();return WebInspector.HeapSnapshotFilteredOrderedIterator.prototype.createComparator({object:["!edgeName",a,"retainedSize",!1],distance:["distance",a,"retainedSize",!1],count:["!edgeName",!0,"retainedSize",!1],addedSize:["selfSize",a,"!edgeName",!0],removedSize:["selfSize",a,"!edgeName",!0],shallowSize:["selfSize",a,"!edgeName",!0],retainedSize:["retainedSize",a,"!edgeName",!0]}[b]||["!edgeName",!0,"retainedSize",!1])},_emptyData:function(){return{count:"",
countDelta:"",sizeDelta:""}},_enhanceData:function(a){this._isDeletedNode?(a.addedCount="",a.addedSize="",a.removedCount="\u2022",a.removedSize=Number.withThousandsSeparator(this._shallowSize)):(a.addedCount="\u2022",a.addedSize=Number.withThousandsSeparator(this._shallowSize),a.removedCount="",a.removedSize="");return a},get isDeletedNode(){return this._isDeletedNode},__proto__:WebInspector.HeapSnapshotGenericObjectNode.prototype};
WebInspector.HeapSnapshotConstructorNode=function(a,b,c,e){WebInspector.HeapSnapshotGridNode.call(this,a,0<c.count);this._name=b;this._aggregatesKey=e;this._distance=c.distance;this._count=c.count;this._shallowSize=c.self;this._retainedSize=c.maxRet};
WebInspector.HeapSnapshotConstructorNode.prototype={createProvider:function(){return this._dataGrid.snapshot.createNodesProviderForClass(this._name,this._aggregatesKey)},revealNodeBySnapshotObjectId:function(a){function b(a){-1===a?this.collapse():this._populateChildren(a,null,c.bind(this,a))}function c(a){for(var b=0,c=0;c<this._retrievedChildrenRanges.length;c++){var g=this._retrievedChildrenRanges[c];if(g.from<=a&&a<g.to){this._dataGrid.highlightNode(this.children[b+a-g.from]);break}b+=g.to-g.from+
1}}this.expandWithoutPopulate(function(){this._provider().nodePosition(a,b.bind(this))}.bind(this))},createCell:function(a){a="object"!==a?this._createValueCell(a):WebInspector.HeapSnapshotGridNode.prototype.createCell.call(this,a);this._searchMatched&&a.addStyleClass("highlight");return a},_createChildNode:function(a){return new WebInspector.HeapSnapshotInstanceNode(this._dataGrid,null,this._dataGrid.snapshot,a)},comparator:function(){var a=this._dataGrid.isSortOrderAscending(),b=this._dataGrid.sortColumnIdentifier();
return WebInspector.HeapSnapshotFilteredOrderedIterator.prototype.createComparator({object:["id",a,"retainedSize",!1],distance:["distance",!0,"retainedSize",!1],count:["id",!0,"retainedSize",!1],shallowSize:["selfSize",a,"id",!0],retainedSize:["retainedSize",a,"id",!0]}[b])},_childHashForEntity:function(a){return a.id},_childHashForNode:function(a){return a.snapshotNodeId},get data(){var a={object:this._name};a.count=Number.withThousandsSeparator(this._count);a.distance=this._distance;a.shallowSize=
Number.withThousandsSeparator(this._shallowSize);a.retainedSize=Number.withThousandsSeparator(this._retainedSize);a["count-percent"]=this._toPercentString(this._countPercent);a["shallowSize-percent"]=this._toPercentString(this._shallowSizePercent);a["retainedSize-percent"]=this._toPercentString(this._retainedSizePercent);return a},get _countPercent(){return this._count/this.dataGrid.snapshot.nodeCount*100},get _retainedSizePercent(){return this._retainedSize/this.dataGrid.snapshot.totalSize*100},
get _shallowSizePercent(){return this._shallowSize/this.dataGrid.snapshot.totalSize*100},__proto__:WebInspector.HeapSnapshotGridNode.prototype};WebInspector.HeapSnapshotDiffNodesProvider=function(a,b,c,e){this._addedNodesProvider=a;this._deletedNodesProvider=b;this._addedCount=c;this._removedCount=e};
WebInspector.HeapSnapshotDiffNodesProvider.prototype={dispose:function(){this._addedNodesProvider.dispose();this._deletedNodesProvider.dispose()},isEmpty:function(a){a(!1)},serializeItemsRange:function(a,b,c){function e(a,b){a.length||(a.startPosition=this._addedCount+b.startPosition);for(var d=0;d<b.length;d++)b[d].isAddedNotRemoved=!1,a.push(b[d]);a.endPosition=this._addedCount+b.endPosition;a.totalLength=this._addedCount+this._removedCount;c(a)}function d(a){for(var d=0;d<a.length;d++)a[d].isAddedNotRemoved=
!0;if(a.endPosition<b)return this._deletedNodesProvider.serializeItemsRange(0,b-a.endPosition,e.bind(this,a));a.totalLength=this._addedCount+this._removedCount;a.totalLength=this._addedCount+this._removedCount;c(a)}a<this._addedCount?this._addedNodesProvider.serializeItemsRange(a,b,d.bind(this)):this._deletedNodesProvider.serializeItemsRange(a-this._addedCount,b-this._addedCount,e.bind(this,[]))},sortAndRewind:function(a,b){this._addedNodesProvider.sortAndRewind(a,function(){this._deletedNodesProvider.sortAndRewind(a,
b)}.bind(this))}};WebInspector.HeapSnapshotDiffNode=function(a,b,c){WebInspector.HeapSnapshotGridNode.call(this,a,!0);this._name=b;this._addedCount=c.addedCount;this._removedCount=c.removedCount;this._countDelta=c.countDelta;this._addedSize=c.addedSize;this._removedSize=c.removedSize;this._sizeDelta=c.sizeDelta;this._deletedIndexes=c.deletedIndexes};
WebInspector.HeapSnapshotDiffNode.prototype={createProvider:function(){var a=this._dataGrid;return new WebInspector.HeapSnapshotDiffNodesProvider(a.snapshot.createAddedNodesProvider(a.baseSnapshot.uid,this._name),a.baseSnapshot.createDeletedNodesProvider(this._deletedIndexes),this._addedCount,this._removedCount)},_createChildNode:function(a){return a.isAddedNotRemoved?new WebInspector.HeapSnapshotInstanceNode(this._dataGrid,null,this._dataGrid.snapshot,a):new WebInspector.HeapSnapshotInstanceNode(this._dataGrid,
this._dataGrid.baseSnapshot,null,a)},_childHashForEntity:function(a){return a.id},_childHashForNode:function(a){return a.snapshotNodeId},comparator:function(){var a=this._dataGrid.isSortOrderAscending(),b=this._dataGrid.sortColumnIdentifier();return WebInspector.HeapSnapshotFilteredOrderedIterator.prototype.createComparator({object:["id",a,"selfSize",!1],addedCount:["selfSize",a,"id",!0],removedCount:["selfSize",a,"id",!0],countDelta:["selfSize",a,"id",!0],addedSize:["selfSize",a,"id",!0],removedSize:["selfSize",
a,"id",!0],sizeDelta:["selfSize",a,"id",!0]}[b])},_signForDelta:function(a){return 0===a?"":0<a?"+":"\u2212"},get data(){var a={object:this._name};a.addedCount=Number.withThousandsSeparator(this._addedCount);a.removedCount=Number.withThousandsSeparator(this._removedCount);a.countDelta=this._signForDelta(this._countDelta)+Number.withThousandsSeparator(Math.abs(this._countDelta));a.addedSize=Number.withThousandsSeparator(this._addedSize);a.removedSize=Number.withThousandsSeparator(this._removedSize);
a.sizeDelta=this._signForDelta(this._sizeDelta)+Number.withThousandsSeparator(Math.abs(this._sizeDelta));return a},__proto__:WebInspector.HeapSnapshotGridNode.prototype};WebInspector.HeapSnapshotDominatorObjectNode=function(a,b){WebInspector.HeapSnapshotGenericObjectNode.call(this,a,b);this.updateHasChildren()};
WebInspector.HeapSnapshotDominatorObjectNode.prototype={createProvider:function(){return this._dataGrid.snapshot.createNodesProviderForDominator(this.snapshotNodeIndex)},retrieveChildBySnapshotObjectId:function(a,b){function c(a){-1===a?(this.collapse(),b(null)):this._populateChildren(a,null,e.bind(this,a))}function e(a){a=this.childForPosition(a);b(a)}this.hasChildren=!0;this.expandWithoutPopulate(function(){this._provider().nodePosition(a,c.bind(this))}.bind(this))},_createChildNode:function(a){return new WebInspector.HeapSnapshotDominatorObjectNode(this._dataGrid,
a)},_childHashForEntity:function(a){return a.id},_childHashForNode:function(a){return a.snapshotNodeId},comparator:function(){var a=this._dataGrid.isSortOrderAscending(),b=this._dataGrid.sortColumnIdentifier();return WebInspector.HeapSnapshotFilteredOrderedIterator.prototype.createComparator({object:["id",a,"retainedSize",!1],shallowSize:["selfSize",a,"id",!0],retainedSize:["retainedSize",a,"id",!0]}[b])},_emptyData:function(){return{}},__proto__:WebInspector.HeapSnapshotGenericObjectNode.prototype};
WebInspector.HeapSnapshotLoader=function(){this._reset()};
WebInspector.HeapSnapshotLoader.prototype={dispose:function(){this._reset()},_reset:function(){this._json="";this._state="find-snapshot-info";this._snapshot={}},close:function(){this._json&&this._parseStringsArray()},buildSnapshot:function(a){a=new WebInspector[a](this._snapshot);this._reset();return a},_parseUintArray:function(){for(var a=0,b=this._json.length;;){for(;a<b;){var c=this._json.charCodeAt(a);if(48<=c&&57>=c)break;else if(93===c)return this._json=this._json.slice(a+1),!1;++a}if(a===b)return this._json=
"",!0;for(var e=0,d=a;a<b;){c=this._json.charCodeAt(a);if(48>c||57<c)break;e*=10;e+=c-48;++a}if(a===b)return this._json=this._json.slice(d),!0;this._array[this._arrayIndex++]=e}},_parseStringsArray:function(){var a=this._json.lastIndexOf("]");if(-1===a)throw Error("Incomplete JSON");this._json=this._json.slice(0,a+1);this._snapshot.strings=JSON.parse(this._json)},write:function(a){this._json+=a;switch(this._state){case "find-snapshot-info":a=this._json.indexOf('"snapshot"');if(-1===a)throw Error("Snapshot token not found");
this._json=this._json.slice(a+10+1);this._state="parse-snapshot-info";case "parse-snapshot-info":a=WebInspector.findBalancedCurlyBrackets(this._json);if(-1===a)break;this._snapshot.snapshot=JSON.parse(this._json.slice(0,a));this._json=this._json.slice(a);this._state="find-nodes";case "find-nodes":a=this._json.indexOf('"nodes"');if(-1===a)break;a=this._json.indexOf("[",a);if(-1===a)break;this._json=this._json.slice(a+1);this._array=new Uint32Array(this._snapshot.snapshot.node_count*this._snapshot.snapshot.meta.node_fields.length);
this._arrayIndex=0;this._state="parse-nodes";case "parse-nodes":if(this._parseUintArray())break;this._snapshot.nodes=this._array;this._state="find-edges";this._array=null;case "find-edges":a=this._json.indexOf('"edges"');if(-1===a)break;a=this._json.indexOf("[",a);if(-1===a)break;this._json=this._json.slice(a+1);this._array=new Uint32Array(this._snapshot.snapshot.edge_count*this._snapshot.snapshot.meta.edge_fields.length);this._arrayIndex=0;this._state="parse-edges";case "parse-edges":if(this._parseUintArray())break;
this._snapshot.edges=this._array;this._array=null;this._state="find-strings";case "find-strings":a=this._json.indexOf('"strings"');if(-1===a)break;a=this._json.indexOf("[",a);if(-1===a)break;this._json=this._json.slice(a);this._state="accumulate-strings"}}};WebInspector.HeapSnapshotWorkerWrapper=function(){};WebInspector.HeapSnapshotWorkerWrapper.prototype={postMessage:function(a){},terminate:function(){},__proto__:WebInspector.Object.prototype};
WebInspector.HeapSnapshotRealWorker=function(){this._worker=new Worker("HeapSnapshotWorker.js");this._worker.addEventListener("message",this._messageReceived.bind(this),!1)};
WebInspector.HeapSnapshotRealWorker.prototype={_messageReceived:function(a){a=a.data;"callId"in a?this.dispatchEventToListeners("message",a):"console"!==a.object?console.log(WebInspector.UIString("Worker asks to call a method '%s' on an unsupported object '%s'.",a.method,a.object)):"log"!==a.method&&"info"!==a.method&&"error"!==a.method?console.log(WebInspector.UIString("Worker asks to call an unsupported method '%s' on the console object.",a.method)):console[a.method].apply(window[a.object],a.arguments)},
postMessage:function(a){this._worker.postMessage(a)},terminate:function(){this._worker.terminate()},__proto__:WebInspector.HeapSnapshotWorkerWrapper.prototype};WebInspector.AsyncTaskQueue=function(){this._queue=[];this._isTimerSheduled=!1};
WebInspector.AsyncTaskQueue.prototype={addTask:function(a){this._queue.push(a);this._scheduleTimer()},_onTimeout:function(){this._isTimerSheduled=!1;var a=this._queue;this._queue=[];for(var b=0;b<a.length;b++)try{a[b]()}catch(c){console.error("Exception while running task: "+c.stack)}this._scheduleTimer()},_scheduleTimer:function(){this._queue.length&&!this._isTimerSheduled&&(setTimeout(this._onTimeout.bind(this),0),this._isTimerSheduled=!0)}};
WebInspector.HeapSnapshotFakeWorker=function(){this._dispatcher=new WebInspector.HeapSnapshotWorkerDispatcher(window,this._postMessageFromWorker.bind(this));this._asyncTaskQueue=new WebInspector.AsyncTaskQueue};
WebInspector.HeapSnapshotFakeWorker.prototype={postMessage:function(a){this._asyncTaskQueue.addTask(function(){this._dispatcher&&this._dispatcher.dispatchMessage({data:a})}.bind(this))},terminate:function(){this._dispatcher=null},_postMessageFromWorker:function(a){this._asyncTaskQueue.addTask(function(){this.dispatchEventToListeners("message",a)}.bind(this))},__proto__:WebInspector.HeapSnapshotWorkerWrapper.prototype};
WebInspector.HeapSnapshotWorker=function(){this._nextCallId=this._nextObjectId=1;this._callbacks=[];this._previousCallbacks=[];this._worker="undefined"===typeof InspectorTest?new WebInspector.HeapSnapshotRealWorker:new WebInspector.HeapSnapshotFakeWorker;this._worker.addEventListener("message",this._messageReceived,this)};
WebInspector.HeapSnapshotWorker.prototype={createLoader:function(a,b){var c=this._nextObjectId++,e=new WebInspector.HeapSnapshotLoaderProxy(this,c,a,b);this._postMessage({callId:this._nextCallId++,disposition:"create",objectId:c,methodName:"WebInspector.HeapSnapshotLoader"});return e},dispose:function(){this._worker.terminate();this._interval&&clearInterval(this._interval)},disposeObject:function(a){this._postMessage({callId:this._nextCallId++,disposition:"dispose",objectId:a})},callGetter:function(a,
b,c){var e=this._nextCallId++;this._callbacks[e]=a;this._postMessage({callId:e,disposition:"getter",objectId:b,methodName:c})},callFactoryMethod:function(a,b,c,e){var d=this._nextCallId++,f=Array.prototype.slice.call(arguments,4),g=this._nextObjectId++;if(a)return this._callbacks[d]=function(b){a(b?new e(this,g):null)}.bind(this),this._postMessage({callId:d,disposition:"factory",objectId:b,methodName:c,methodArguments:f,newObjectId:g}),null;this._postMessage({callId:d,disposition:"factory",objectId:b,
methodName:c,methodArguments:f,newObjectId:g});return new e(this,g)},callMethod:function(a,b,c){var e=this._nextCallId++,d=Array.prototype.slice.call(arguments,3);a&&(this._callbacks[e]=a);this._postMessage({callId:e,disposition:"method",objectId:b,methodName:c,methodArguments:d})},startCheckingForLongRunningCalls:function(){this._interval||(this._checkLongRunningCalls(),this._interval=setInterval(this._checkLongRunningCalls.bind(this),300))},_checkLongRunningCalls:function(){for(var a in this._previousCallbacks)a in
this._callbacks||delete this._previousCallbacks[a];var b=!1;for(a in this._previousCallbacks){b=!0;break}this.dispatchEventToListeners("wait",b);for(a in this._callbacks)this._previousCallbacks[a]=!0},_findFunction:function(a){a=a.split(".");for(var b=window,c=0;c<a.length;++c)b=b[a[c]];return b},_messageReceived:function(a){var b=a.data;a.data.error?(a.data.errorMethodName&&WebInspector.log(WebInspector.UIString("An error happened when a call for method '%s' was requested",a.data.errorMethodName)),
WebInspector.log(a.data.errorCallStack),delete this._callbacks[b.callId]):this._callbacks[b.callId]&&(a=this._callbacks[b.callId],delete this._callbacks[b.callId],a(b.result))},_postMessage:function(a){this._worker.postMessage(a)},__proto__:WebInspector.Object.prototype};WebInspector.HeapSnapshotProxyObject=function(a,b){this._worker=a;this._objectId=b};
WebInspector.HeapSnapshotProxyObject.prototype={_callWorker:function(a,b){b.splice(1,0,this._objectId);return this._worker[a].apply(this._worker,b)},dispose:function(){this._worker.disposeObject(this._objectId)},disposeWorker:function(){this._worker.dispose()},callFactoryMethod:function(a,b,c,e){return this._callWorker("callFactoryMethod",Array.prototype.slice.call(arguments,0))},callGetter:function(a,b){return this._callWorker("callGetter",Array.prototype.slice.call(arguments,0))},callMethod:function(a,
b,c){return this._callWorker("callMethod",Array.prototype.slice.call(arguments,0))},get worker(){return this._worker}};WebInspector.HeapSnapshotLoaderProxy=function(a,b,c,e){WebInspector.HeapSnapshotProxyObject.call(this,a,b);this._snapshotConstructorName=c;this._proxyConstructor=e;this._pendingSnapshotConsumers=[]};
WebInspector.HeapSnapshotLoaderProxy.prototype={addConsumer:function(a){this._pendingSnapshotConsumers.push(a)},write:function(a,b){this.callMethod(b,"write",a)},close:function(){function a(a){this.dispose();a.updateStaticData(b.bind(this))}function b(a){for(var b=0;b<this._pendingSnapshotConsumers.length;++b)this._pendingSnapshotConsumers[b](a);this._pendingSnapshotConsumers=[]}this.callMethod(function(){this.callFactoryMethod(a.bind(this),"buildSnapshot",this._proxyConstructor,this._snapshotConstructorName)}.bind(this),
"close")},__proto__:WebInspector.HeapSnapshotProxyObject.prototype};WebInspector.HeapSnapshotProxy=function(a,b){WebInspector.HeapSnapshotProxyObject.call(this,a,b)};
WebInspector.HeapSnapshotProxy.prototype={aggregates:function(a,b,c,e){this.callMethod(e,"aggregates",a,b,c)},aggregatesForDiff:function(a){this.callMethod(a,"aggregatesForDiff")},calculateSnapshotDiff:function(a,b,c){this.callMethod(c,"calculateSnapshotDiff",a,b)},nodeClassName:function(a,b){this.callMethod(b,"nodeClassName",a)},dominatorIdsForNode:function(a,b){this.callMethod(b,"dominatorIdsForNode",a)},createEdgesProvider:function(a,b){return this.callFactoryMethod(null,"createEdgesProvider",
WebInspector.HeapSnapshotProviderProxy,a,b)},createRetainingEdgesProvider:function(a,b){return this.callFactoryMethod(null,"createRetainingEdgesProvider",WebInspector.HeapSnapshotProviderProxy,a,b)},createAddedNodesProvider:function(a,b){return this.callFactoryMethod(null,"createAddedNodesProvider",WebInspector.HeapSnapshotProviderProxy,a,b)},createDeletedNodesProvider:function(a){return this.callFactoryMethod(null,"createDeletedNodesProvider",WebInspector.HeapSnapshotProviderProxy,a)},createNodesProvider:function(a){return this.callFactoryMethod(null,
"createNodesProvider",WebInspector.HeapSnapshotProviderProxy,a)},createNodesProviderForClass:function(a,b){return this.callFactoryMethod(null,"createNodesProviderForClass",WebInspector.HeapSnapshotProviderProxy,a,b)},createNodesProviderForDominator:function(a){return this.callFactoryMethod(null,"createNodesProviderForDominator",WebInspector.HeapSnapshotProviderProxy,a)},dispose:function(){this.disposeWorker()},get nodeCount(){return this._staticData.nodeCount},get rootNodeIndex(){return this._staticData.rootNodeIndex},
updateStaticData:function(a){this.callMethod(function(b){this._staticData=b;a(this)}.bind(this),"updateStaticData")},get totalSize(){return this._staticData.totalSize},get uid(){return this._staticData.uid},__proto__:WebInspector.HeapSnapshotProxyObject.prototype};WebInspector.NativeHeapSnapshotProxy=function(a,b){WebInspector.HeapSnapshotProxy.call(this,a,b)};WebInspector.NativeHeapSnapshotProxy.prototype={images:function(a){this.callMethod(a,"images")},__proto__:WebInspector.HeapSnapshotProxy.prototype};
WebInspector.HeapSnapshotProviderProxy=function(a,b){WebInspector.HeapSnapshotProxyObject.call(this,a,b)};WebInspector.HeapSnapshotProviderProxy.prototype={nodePosition:function(a,b){this.callMethod(b,"nodePosition",a)},isEmpty:function(a){this.callMethod(a,"isEmpty")},serializeItemsRange:function(a,b,c){this.callMethod(c,"serializeItemsRange",a,b)},sortAndRewind:function(a,b){this.callMethod(b,"sortAndRewind",a)},__proto__:WebInspector.HeapSnapshotProxyObject.prototype};
WebInspector.HeapSnapshotView=function(a,b){WebInspector.View.call(this);this.element.addStyleClass("heap-snapshot-view");this.parent=a;this.parent.addEventListener("profile added",this._onProfileHeaderAdded,this);this.viewsContainer=document.createElement("div");this.viewsContainer.addStyleClass("views-container");this.element.appendChild(this.viewsContainer);this.containmentView=new WebInspector.View;this.containmentView.element.addStyleClass("view");this.containmentDataGrid=new WebInspector.HeapSnapshotContainmentDataGrid;
this.containmentDataGrid.element.addEventListener("mousedown",this._mouseDownInContentsGrid.bind(this),!0);this.containmentDataGrid.show(this.containmentView.element);this.containmentDataGrid.addEventListener(WebInspector.DataGrid.Events.SelectedNode,this._selectionChanged,this);this.constructorsView=new WebInspector.View;this.constructorsView.element.addStyleClass("view");this.constructorsView.element.appendChild(this._createToolbarWithClassNameFilter());this.constructorsDataGrid=new WebInspector.HeapSnapshotConstructorsDataGrid;
this.constructorsDataGrid.element.addStyleClass("class-view-grid");this.constructorsDataGrid.element.addEventListener("mousedown",this._mouseDownInContentsGrid.bind(this),!0);this.constructorsDataGrid.show(this.constructorsView.element);this.constructorsDataGrid.addEventListener(WebInspector.DataGrid.Events.SelectedNode,this._selectionChanged,this);this.diffView=new WebInspector.View;this.diffView.element.addStyleClass("view");this.diffView.element.appendChild(this._createToolbarWithClassNameFilter());
this.diffDataGrid=new WebInspector.HeapSnapshotDiffDataGrid;this.diffDataGrid.element.addStyleClass("class-view-grid");this.diffDataGrid.show(this.diffView.element);this.diffDataGrid.addEventListener(WebInspector.DataGrid.Events.SelectedNode,this._selectionChanged,this);this.dominatorView=new WebInspector.View;this.dominatorView.element.addStyleClass("view");this.dominatorDataGrid=new WebInspector.HeapSnapshotDominatorsDataGrid;this.dominatorDataGrid.element.addEventListener("mousedown",this._mouseDownInContentsGrid.bind(this),
!0);this.dominatorDataGrid.show(this.dominatorView.element);this.dominatorDataGrid.addEventListener(WebInspector.DataGrid.Events.SelectedNode,this._selectionChanged,this);this.retainmentViewHeader=document.createElement("div");this.retainmentViewHeader.addStyleClass("retainers-view-header");WebInspector.installDragHandle(this.retainmentViewHeader,this._startRetainersHeaderDragging.bind(this),this._retainersHeaderDragging.bind(this),this._endRetainersHeaderDragging.bind(this),"row-resize");var c=document.createElement("div");
c.className="title";var e=document.createElement("span");e.textContent=WebInspector.UIString("Object's retaining tree");c.appendChild(e);this.retainmentViewHeader.appendChild(c);this.element.appendChild(this.retainmentViewHeader);this.retainmentView=new WebInspector.View;this.retainmentView.element.addStyleClass("view");this.retainmentView.element.addStyleClass("retaining-paths-view");this.retainmentDataGrid=new WebInspector.HeapSnapshotRetainmentDataGrid;this.retainmentDataGrid.show(this.retainmentView.element);
this.retainmentDataGrid.addEventListener(WebInspector.DataGrid.Events.SelectedNode,this._inspectedObjectChanged,this);this.retainmentView.show(this.element);this.retainmentDataGrid.reset();this.dataGrid=this.constructorsDataGrid;this.currentView=this.constructorsView;this.viewSelectElement=document.createElement("select");this.viewSelectElement.className="status-bar-item";this.viewSelectElement.addEventListener("change",this._onSelectedViewChanged.bind(this),!1);this.views=[{title:"Summary",view:this.constructorsView,
grid:this.constructorsDataGrid},{title:"Comparison",view:this.diffView,grid:this.diffDataGrid},{title:"Containment",view:this.containmentView,grid:this.containmentDataGrid},{title:"Dominators",view:this.dominatorView,grid:this.dominatorDataGrid}];for(c=this.views.current=0;c<this.views.length;++c){var e=this.views[c],d=document.createElement("option");d.label=WebInspector.UIString(e.title);this.viewSelectElement.appendChild(d)}this._profileUid=b.uid;this._profileTypeId=b.profileType().id;this.baseSelectElement=
document.createElement("select");this.baseSelectElement.className="status-bar-item";this.baseSelectElement.addEventListener("change",this._changeBase.bind(this),!1);this._updateBaseOptions();this.filterSelectElement=document.createElement("select");this.filterSelectElement.className="status-bar-item";this.filterSelectElement.addEventListener("change",this._changeFilter.bind(this),!1);this._updateFilterOptions();this.helpButton=new WebInspector.StatusBarButton("","heap-snapshot-help-status-bar-item status-bar-item");
this.helpButton.addEventListener("click",this._helpClicked,this);this._popoverHelper=new WebInspector.ObjectPopoverHelper(this.element,this._getHoverAnchor.bind(this),this._resolveObjectForPopover.bind(this),void 0,!0);this.profile.load(function(a){for(var b=this._profiles(),c,d=0;d<b.length;++d)if(b[d].uid===this._profileUid){c=d;break}this.baseSelectElement.selectedIndex=0<c?c-1:c;this.dataGrid.setDataSource(a)}.bind(this))};
WebInspector.HeapSnapshotView.prototype={dispose:function(){this.profile.dispose();this.baseProfile&&this.baseProfile.dispose();this.containmentDataGrid.dispose();this.constructorsDataGrid.dispose();this.diffDataGrid.dispose();this.dominatorDataGrid.dispose();this.retainmentDataGrid.dispose()},statusBarItems:function(){function a(a,c){var e=document.createElement("span");e.className="status-bar-select-container"+(c?" hidden":"");e.appendChild(a);return e}return[a(this.viewSelectElement),a(this.baseSelectElement,
!0),a(this.filterSelectElement),this.helpButton.element]},get profile(){return this.parent.getProfile(this._profileTypeId,this._profileUid)},get baseProfile(){return this.parent.getProfile(this._profileTypeId,this._baseProfileUid)},wasShown:function(){function a(){this.currentView.show(this.viewsContainer)}this.profile.load(function(){this.baseProfile?this.baseProfile.load(a.bind(this)):a.call(this)}.bind(this))},willHide:function(){this._currentSearchResultIndex=-1;this._popoverHelper.hidePopover();
this.helpPopover&&this.helpPopover.isShowing()&&this.helpPopover.hide()},onResize:function(){this._updateRetainmentViewHeight(this.retainmentView.element.clientHeight)},searchCanceled:function(){if(this._searchResults)for(var a=0;a<this._searchResults.length;++a){var b=this._searchResults[a].node;delete b._searchMatched;b.refresh()}delete this._searchFinishedCallback;this._currentSearchResultIndex=-1;this._searchResults=[]},performSearch:function(a,b){function c(b){return"_name"in b&&b._name.hasSubstring(a,
!0)}function e(b){return"snapshotNodeId"in b&&b.snapshotNodeId===a}function d(a){delete a._searchMatched;return f(a)?(a._searchMatched=!0,a.refresh(),!0):!1}this.searchCanceled();a=a.trim();if(a.length&&(this.currentView===this.constructorsView||this.currentView===this.diffView)){this._searchFinishedCallback=b;var f;"@"!==a.charAt(0)?f=c:(a=parseInt(a.substring(1),10),f=e);for(var g=this.dataGrid.rootNode().children[0],h=0,k={};g;)d(g)&&this._searchResults.push({node:g}),g=g.traverseNextNode(!1,null,
1<=h,k),h+=k.depthChange;b(this,this._searchResults.length)}},jumpToFirstSearchResult:function(){this._searchResults&&this._searchResults.length&&(this._currentSearchResultIndex=0,this._jumpToSearchResult(this._currentSearchResultIndex))},jumpToLastSearchResult:function(){this._searchResults&&this._searchResults.length&&(this._currentSearchResultIndex=this._searchResults.length-1,this._jumpToSearchResult(this._currentSearchResultIndex))},jumpToNextSearchResult:function(){this._searchResults&&this._searchResults.length&&
(++this._currentSearchResultIndex>=this._searchResults.length&&(this._currentSearchResultIndex=0),this._jumpToSearchResult(this._currentSearchResultIndex))},jumpToPreviousSearchResult:function(){this._searchResults&&this._searchResults.length&&(0>--this._currentSearchResultIndex&&(this._currentSearchResultIndex=this._searchResults.length-1),this._jumpToSearchResult(this._currentSearchResultIndex))},showingFirstSearchResult:function(){return 0===this._currentSearchResultIndex},showingLastSearchResult:function(){return this._searchResults&&
this._currentSearchResultIndex===this._searchResults.length-1},_jumpToSearchResult:function(a){(a=this._searchResults[a])&&a.node.revealAndSelect()},refreshVisibleData:function(){for(var a=this.dataGrid.rootNode().children[0];a;)a.refresh(),a=a.traverseNextNode(!1,null,!0)},_changeBase:function(){if(this._baseProfileUid!==this._profiles()[this.baseSelectElement.selectedIndex].uid){this._baseProfileUid=this._profiles()[this.baseSelectElement.selectedIndex].uid;var a=this.dataGrid;a.snapshot&&this.baseProfile.load(a.setBaseDataSource.bind(a));
this.currentQuery&&this._searchFinishedCallback&&this._searchResults&&(this._searchFinishedCallback(this,-this._searchResults.length),this.performSearch(this.currentQuery,this._searchFinishedCallback))}},_changeFilter:function(){var a=this.filterSelectElement.selectedIndex-1;this.dataGrid.filterSelectIndexChanged(this._profiles(),a);WebInspector.notifications.dispatchEventToListeners(WebInspector.UserMetrics.UserAction,{action:WebInspector.UserMetrics.UserActionNames.HeapSnapshotFilterChanged,label:this.filterSelectElement[this.filterSelectElement.selectedIndex].label});
this.currentQuery&&this._searchFinishedCallback&&this._searchResults&&(this._searchFinishedCallback(this,-this._searchResults.length),this.performSearch(this.currentQuery,this._searchFinishedCallback))},_createToolbarWithClassNameFilter:function(){var a=document.createElement("div");a.addStyleClass("class-view-toolbar");var b=document.createElement("input");b.addStyleClass("class-name-filter");b.setAttribute("placeholder",WebInspector.UIString("Class filter"));b.addEventListener("keyup",this._changeNameFilter.bind(this,
b),!1);a.appendChild(b);return a},_changeNameFilter:function(a){this.dataGrid.changeNameFilter(a.value)},_profiles:function(){return this.parent.getProfileType(this._profileTypeId).getProfiles()},populateContextMenu:function(a,b){this.dataGrid.populateContextMenu(this.parent,a,b)},_selectionChanged:function(a){this._setRetainmentDataGridSource(a.target.selectedNode);this._inspectedObjectChanged(a)},_inspectedObjectChanged:function(a){a=a.target.selectedNode;!this.profile.fromFile()&&a instanceof WebInspector.HeapSnapshotGenericObjectNode&&
ConsoleAgent.addInspectedHeapObject(a.snapshotNodeId)},_setRetainmentDataGridSource:function(a){a&&a.snapshotNodeIndex?this.retainmentDataGrid.setDataSource(a.isDeletedNode?a.dataGrid.baseSnapshot:a.dataGrid.snapshot,a.snapshotNodeIndex):this.retainmentDataGrid.reset()},_mouseDownInContentsGrid:function(a){if(!(2>a.detail)){var b=a.target.enclosingNodeOrSelfWithNodeName("td");b&&(b.hasStyleClass("count-column")||b.hasStyleClass("shallowSize-column")||b.hasStyleClass("retainedSize-column"))&&a.consume(!0)}},
changeView:function(a,b){function c(a){a=a.data;a.removeEventListener(WebInspector.HeapSnapshotSortableDataGrid.Events.ContentShown,c,this);a===this.dataGrid&&b()}for(var e=null,d=0;d<this.views.length;++d)if(this.views[d].title===a){e=d;break}this.views.current===e?setTimeout(b,0):(this.views[e].grid.addEventListener(WebInspector.HeapSnapshotSortableDataGrid.Events.ContentShown,c,this),this.viewSelectElement.selectedIndex=e,this._changeView(e))},_updateDataSourceAndView:function(){function a(a){this.dataGrid===
c&&(c.snapshot!==a&&c.setDataSource(a),c===this.diffDataGrid&&(this._baseProfileUid||(this._baseProfileUid=this._profiles()[this.baseSelectElement.selectedIndex].uid),this.baseProfile.load(b.bind(this))))}function b(a){this.diffDataGrid.baseSnapshot!==a&&this.diffDataGrid.setBaseDataSource(a)}var c=this.dataGrid;c.snapshot||this.profile.load(a.bind(this))},_onSelectedViewChanged:function(a){this._changeView(a.target.selectedIndex)},_updateSelectorsVisibility:function(){this.currentView===this.diffView?
this.baseSelectElement.parentElement.removeStyleClass("hidden"):this.baseSelectElement.parentElement.addStyleClass("hidden");this.currentView===this.constructorsView?this.filterSelectElement.parentElement.removeStyleClass("hidden"):this.filterSelectElement.parentElement.addStyleClass("hidden")},_changeView:function(a){a!==this.views.current&&(this.views.current=a,this.currentView.detach(),a=this.views[this.views.current],this.currentView=a.view,this.dataGrid=a.grid,this.currentView.show(this.viewsContainer),
this.refreshVisibleData(),this.dataGrid.updateWidths(),this._updateSelectorsVisibility(),this._updateDataSourceAndView(),this.currentQuery&&this._searchFinishedCallback&&this._searchResults&&(this._searchFinishedCallback(this,-this._searchResults.length),this.performSearch(this.currentQuery,this._searchFinishedCallback)))},_getHoverAnchor:function(a){var b=a.enclosingNodeOrSelfWithNodeName("span");if(b&&(a=a.enclosingNodeOrSelfWithNodeName("tr")))return b.node=a._dataGridNode,b},_resolveObjectForPopover:function(a,
b,c){this.profile.fromFile()||a.node.queryObjectContent(b,c)},_helpClicked:function(a){if(!this._helpPopoverContentElement){a=["a:","console-formatted-name",WebInspector.UIString("property"),"0:","console-formatted-name",WebInspector.UIString("element"),"a:","console-formatted-number",WebInspector.UIString("context var"),"a:","console-formatted-null",WebInspector.UIString("system prop")];var b=' a ;console-formatted-object;Object;"a";console-formatted-string;String;/a/;console-formatted-string;RegExp;a();console-formatted-function;Function;a[];console-formatted-object;Array;num;console-formatted-number;Number; a ;console-formatted-null;System'.split(";"),
c=document.createElement("table");c.className="heap-snapshot-help";var e=document.createElement("tr"),d=document.createElement("th");d.textContent=WebInspector.UIString("Property types:");e.appendChild(d);d=document.createElement("th");d.textContent=WebInspector.UIString("Object types:");e.appendChild(d);c.appendChild(e);for(var e=function(a,b,c){var d=document.createElement("div");d.className="source-code event-properties";var e=document.createElement("span");e.textContent=a[b];e.className=a[b+1];
d.appendChild(e);e=document.createElement("span");e.textContent=" "+a[b+2];d.appendChild(e);c.appendChild(d)},d=Math.max(a.length,b.length),f=0;f<d;f+=3){var g=document.createElement("tr"),h=document.createElement("td");a[f]&&e(a,f,h);g.appendChild(h);h=document.createElement("td");b[f]&&e(b,f,h);g.appendChild(h);c.appendChild(g)}this._helpPopoverContentElement=c;this.helpPopover=new WebInspector.Popover}this.helpPopover.isShowing()?this.helpPopover.hide():this.helpPopover.show(this._helpPopoverContentElement,
this.helpButton.element)},_startRetainersHeaderDragging:function(a){if(!this.isShowing())return!1;this._previousDragPosition=a.pageY;return!0},_retainersHeaderDragging:function(a){var b=this.retainmentView.element.clientHeight,b=b+(this._previousDragPosition-a.pageY);this._previousDragPosition=a.pageY;this._updateRetainmentViewHeight(b);a.consume(!0)},_endRetainersHeaderDragging:function(a){delete this._previousDragPosition;a.consume()},_updateRetainmentViewHeight:function(a){a=Number.constrain(a,
Preferences.minConsoleHeight,this.element.clientHeight-Preferences.minConsoleHeight);this.viewsContainer.style.bottom=a+this.retainmentViewHeader.clientHeight+"px";this.retainmentView.element.style.height=a+"px";this.retainmentViewHeader.style.bottom=a+"px";this.currentView.doResize()},_updateBaseOptions:function(){var a=this._profiles();if(this.baseSelectElement.length!==a.length)for(var b=this.baseSelectElement.length,c=a.length;b<c;++b){var e=document.createElement("option"),d=a[b].title;WebInspector.ProfilesPanelDescriptor.isUserInitiatedProfile(d)&&
(d=WebInspector.UIString("Snapshot %d",WebInspector.ProfilesPanelDescriptor.userInitiatedProfileIndex(d)));e.label=d;this.baseSelectElement.appendChild(e)}},_updateFilterOptions:function(){var a=this._profiles();if(this.filterSelectElement.length-1!==a.length){if(!this.filterSelectElement.length){var b=document.createElement("option");b.label=WebInspector.UIString("All objects");this.filterSelectElement.appendChild(b)}if(!this.profile.fromFile())for(var c=this.filterSelectElement.length-1,e=a.length;c<
e;++c){var b=document.createElement("option"),d=a[c].title;WebInspector.ProfilesPanelDescriptor.isUserInitiatedProfile(d)&&(d=WebInspector.ProfilesPanelDescriptor.userInitiatedProfileIndex(d),d=c?WebInspector.UIString("Objects allocated between Snapshots %d and %d",d-1,d):WebInspector.UIString("Objects allocated before Snapshot %d",d));b.label=d;this.filterSelectElement.appendChild(b)}}},_onProfileHeaderAdded:function(a){a.data&&a.data.type===this._profileTypeId&&(this._updateBaseOptions(),this._updateFilterOptions())},
__proto__:WebInspector.View.prototype};WebInspector.HeapSnapshotProfileType=function(){WebInspector.ProfileType.call(this,WebInspector.HeapSnapshotProfileType.TypeId,WebInspector.UIString("Take Heap Snapshot"));InspectorBackend.registerHeapProfilerDispatcher(this)};WebInspector.HeapSnapshotProfileType.TypeId="HEAP";
WebInspector.HeapSnapshotProfileType.prototype={get buttonTooltip(){return WebInspector.UIString("Take heap snapshot.")},isInstantProfile:function(){return!0},buttonClicked:function(){this._takeHeapSnapshot();return!1},get treeItemTitle(){return WebInspector.UIString("HEAP SNAPSHOTS")},get description(){return WebInspector.UIString("Heap snapshot profiles show memory distribution among your page's JavaScript objects and related DOM nodes.")},createTemporaryProfile:function(a){a=a||WebInspector.UIString("Snapshotting\u2026");
return new WebInspector.HeapProfileHeader(this,a)},createProfile:function(a){return new WebInspector.HeapProfileHeader(this,a.title,a.uid,a.maxJSObjectId||0)},_takeHeapSnapshot:function(){this.findTemporaryProfile()||this.addProfile(this.createTemporaryProfile());HeapProfilerAgent.takeHeapSnapshot(!0,function(){});WebInspector.userMetrics.ProfilesHeapProfileTaken.record()},addProfileHeader:function(a){this.addProfile(this.createProfile(a))},addHeapSnapshotChunk:function(a,b){var c=this._profilesIdMap[this._makeKey(a)];
c&&c.transferChunk(b)},finishHeapSnapshot:function(a){(a=this._profilesIdMap[this._makeKey(a)])&&a.finishHeapSnapshot()},reportHeapSnapshotProgress:function(a,b){var c=this.findTemporaryProfile();c&&this.dispatchEventToListeners(WebInspector.ProfileType.Events.ProgressUpdated,{profile:c,done:a,total:b})},resetProfiles:function(){this._reset()},removeProfile:function(a){WebInspector.ProfileType.prototype.removeProfile.call(this,a);a.isTemporary||HeapProfilerAgent.removeProfile(a.uid)},_requestProfilesFromBackend:function(a){HeapProfilerAgent.getProfileHeaders(a)},
__proto__:WebInspector.ProfileType.prototype};WebInspector.HeapProfileHeader=function(a,b,c,e){WebInspector.ProfileHeader.call(this,a,b,c);this.maxJSObjectId=e;this._snapshotProxy=this._receiver=null;this._totalNumberOfChunks=0};
WebInspector.HeapProfileHeader.prototype={createSidebarTreeElement:function(){return new WebInspector.ProfileSidebarTreeElement(this,WebInspector.UIString("Snapshot %d"),"heap-snapshot-sidebar-tree-item")},createView:function(a){return new WebInspector.HeapSnapshotView(a,this)},load:function(a){this._snapshotProxy?a(this._snapshotProxy):(this._savedChunks=this._numberOfChunks=0,this._savingToFile=!1,this._receiver||(this._setupWorker(),this.sidebarElement.subtitle=WebInspector.UIString("Loading\u2026"),
this.sidebarElement.wait=!0,this.startSnapshotTransfer()),this._receiver.addConsumer(a))},startSnapshotTransfer:function(){HeapProfilerAgent.getHeapSnapshot(this.uid)},snapshotConstructorName:function(){return"JSHeapSnapshot"},snapshotProxyConstructor:function(){return WebInspector.HeapSnapshotProxy},_setupWorker:function(){var a=new WebInspector.HeapSnapshotWorker;a.addEventListener("wait",function(a){this.sidebarElement.wait=a.data},this);a=a.createLoader(this.snapshotConstructorName(),this.snapshotProxyConstructor());
a.addConsumer(this._snapshotReceived.bind(this));this._receiver=a},dispose:function(){this._receiver?this._receiver.close():this._snapshotProxy&&this._snapshotProxy.dispose()},_updateTransferProgress:function(a,b){var c=(100*(b?a/b:0)).toFixed(0);this.sidebarElement.subtitle=this._savingToFile?WebInspector.UIString("Saving\u2026 %d%",c):WebInspector.UIString("Loading\u2026 %d%",c)},_updateSnapshotStatus:function(){this.sidebarElement.subtitle=Number.bytesToString(this._snapshotProxy.totalSize);this.sidebarElement.wait=
!1},transferChunk:function(a){++this._numberOfChunks;this._receiver.write(a,function(){this._updateTransferProgress(++this._savedChunks,this._totalNumberOfChunks);this._totalNumberOfChunks===this._savedChunks&&(this._savingToFile?this._updateSnapshotStatus():this.sidebarElement.subtitle=WebInspector.UIString("Parsing\u2026"),this._receiver.close())}.bind(this))},_snapshotReceived:function(a){this._receiver=null;a&&(this._snapshotProxy=a);this._updateSnapshotStatus();a=this._snapshotProxy.worker;this.isTemporary=
!1;a.startCheckingForLongRunningCalls()},finishHeapSnapshot:function(){this._totalNumberOfChunks=this._numberOfChunks},canSaveToFile:function(){return!this.fromFile()&&!!this._snapshotProxy&&!this._receiver},saveToFile:function(){this._numberOfChunks=0;var a=new WebInspector.FileOutputStream;this._savingToFile=!0;this._fileName=this._fileName||"Heap-"+(new Date).toISO8601Compact()+".heapsnapshot";a.open(this._fileName,function(){this._receiver=a;this._savedChunks=0;this._updateTransferProgress(0,
this._totalNumberOfChunks);HeapProfilerAgent.getHeapSnapshot(this.uid)}.bind(this))},loadFromFile:function(a){this.title=a.name;this.sidebarElement.subtitle=WebInspector.UIString("Loading\u2026");this.sidebarElement.wait=!0;this._setupWorker();this._numberOfChunks=0;this._savingToFile=!1;var b=new WebInspector.HeapSnapshotLoadFromFileDelegate(this);this._createFileReader(a,b).start(this._receiver)},_createFileReader:function(a,b){return new WebInspector.ChunkedFileReader(a,1E7,b)},__proto__:WebInspector.ProfileHeader.prototype};
WebInspector.HeapSnapshotLoadFromFileDelegate=function(a){this._snapshotHeader=a};
WebInspector.HeapSnapshotLoadFromFileDelegate.prototype={onTransferStarted:function(){},onChunkTransferred:function(a){this._snapshotHeader._updateTransferProgress(a.loadedSize(),a.fileSize())},onTransferFinished:function(){this._snapshotHeader.finishHeapSnapshot()},onError:function(a,b){switch(b.target.error.code){case b.target.error.NOT_FOUND_ERR:this._snapshotHeader.sidebarElement.subtitle=WebInspector.UIString("'%s' not found.",a.fileName());break;case b.target.error.NOT_READABLE_ERR:this._snapshotHeader.sidebarElement.subtitle=
WebInspector.UIString("'%s' is not readable",a.fileName());break;case b.target.error.ABORT_ERR:break;default:this._snapshotHeader.sidebarElement.subtitle=WebInspector.UIString("'%s' error %d",a.fileName(),b.target.error.code)}}};WebInspector.HeapSnapshotWorkerDispatcher=function(a,b){this._objects=[];this._global=a;this._postMessage=b};
WebInspector.HeapSnapshotWorkerDispatcher.prototype={_findFunction:function(a){a=a.split(".");for(var b=this._global,c=0;c<a.length;++c)b=b[a[c]];return b},dispatchMessage:function(a){a=a.data;var b={callId:a.callId};try{switch(a.disposition){case "create":var c=this._findFunction(a.methodName);this._objects[a.objectId]=new c;break;case "dispose":delete this._objects[a.objectId];break;case "getter":var e=this._objects[a.objectId],d=e[a.methodName];b.result=d;break;case "factory":e=this._objects[a.objectId];
(d=e[a.methodName].apply(e,a.methodArguments))&&(this._objects[a.newObjectId]=d);b.result=!!d;break;case "method":e=this._objects[a.objectId],b.result=e[a.methodName].apply(e,a.methodArguments)}}catch(f){b.error=f.toString(),b.errorCallStack=f.stack,a.methodName&&(b.errorMethodName=a.methodName)}this._postMessage(b)}};
WebInspector.JSHeapSnapshot=function(a){this._nodeFlags={canBeQueried:1,detachedDOMTreeNode:2,pageObject:4,visitedMarkerMask:65535,visitedMarker:65536};WebInspector.HeapSnapshot.call(this,a)};
WebInspector.JSHeapSnapshot.prototype={createNode:function(a){return new WebInspector.JSHeapSnapshotNode(this,a)},createEdge:function(a,b){return new WebInspector.JSHeapSnapshotEdge(this,a,b)},createRetainingEdge:function(a,b){return new WebInspector.JSHeapSnapshotRetainerEdge(this,a,b)},classNodesFilter:function(){return function(a){return a.isUserObject()}},containmentEdgesFilter:function(a){return function(b){return b.isInvisible()?!1:a?!0:!b.isHidden()&&!b.node().isHidden()}},retainingEdgesFilter:function(a){var b=
this.containmentEdgesFilter(a);return function(a){return b(a)?1!==a.node().id()&&!a.node().isSynthetic()&&!a.isWeak():!1}},dispose:function(){WebInspector.HeapSnapshot.prototype.dispose.call(this);delete this._flags},_markInvisibleEdges:function(){for(var a=this.rootNode().edges();a.hasNext();a.next()){var b=a.edge;if(b.isShortcut()){for(var c={},b=b.node().edges();b.hasNext();b.next()){var e=b.edge;e.isShortcut()&&(c[e._nameOrIndex()]=!0)}for(b.rewind();b.hasNext();b.next())e=b.edge,!e.isShortcut()&&
e.node().isHidden()&&e._hasStringName()&&e._nameOrIndex()in c&&(this._containmentEdges[e._edges._start+e.edgeIndex+this._edgeTypeOffset]=this._edgeInvisibleType)}}},_calculateFlags:function(){this._flags=new Uint32Array(this.nodeCount);this._markDetachedDOMTreeNodes();this._markQueriableHeapObjects();this._markPageOwnedNodes()},distanceForUserRoot:function(a){return a.isWindow()?1:a.isDocumentDOMTreesRoot()?0:-1},userObjectsMapAndFlag:function(){return{map:this._flags,flag:this._nodeFlags.pageObject}},
_flagsOfNode:function(a){return this._flags[a.nodeIndex/this._nodeFieldCount]},_markDetachedDOMTreeNodes:function(){for(var a=this._nodeFlags.detachedDOMTreeNode,b,c=this.rootNode().edges();c.hasNext();c.next()){var e=c.edge.node();if("(Detached DOM trees)"===e.name()){b=e;break}}if(b)for(var d=/^Detached DOM tree/,c=b.edges();c.hasNext();c.next())if(e=c.edge.node(),d.test(e.className()))for(b=e.edges();b.hasNext();b.next())this._flags[b.edge.node().nodeIndex/this._nodeFieldCount]|=a},_markQueriableHeapObjects:function(){for(var a=
this._nodeFlags.canBeQueried,b=this._edgeHiddenType,c=this._edgeInternalType,e=this._edgeInvisibleType,d=this._edgeWeakType,f=this._edgeToNodeOffset,g=this._edgeTypeOffset,h=this._edgeFieldsCount,k=this._containmentEdges,l=this._nodeFieldCount,m=this._firstEdgeIndexes,n=this._flags,p=[],q=this.rootNode().edges();q.hasNext();q.next())q.edge.node().isWindow()&&p.push(q.edge.node().nodeIndex/l);for(;p.length;){var s=p.pop();if(!(n[s]&a))for(n[s]|=a,q=m[s+1],s=m[s];s<q;s+=h){var r=k[s+f]/l;if(!(n[r]&
a)){var t=k[s+g];t!==b&&t!==e&&t!==c&&t!==d&&p.push(r)}}}},_markPageOwnedNodes:function(){for(var a=this._edgeShortcutType,b=this._edgeElementType,c=this._edgeToNodeOffset,e=this._edgeTypeOffset,d=this._edgeFieldsCount,f=this._edgeWeakType,g=this._firstEdgeIndexes,h=this._containmentEdges,k=this._nodeFieldCount,l=this._flags,m=this._nodeFlags.pageObject,n=this._nodeFlags.visitedMarker,p=this._nodeFlags.visitedMarkerMask,q=n|m,s=new Uint32Array(this.nodeCount),r=0,t=this._rootNodeIndex/k,u=this.rootNode(),
w=g[t],t=g[t+1];w<t;w+=d){var v=h[w+e],E=h[w+c];if(v===b){if(u.nodeIndex=E,!u.isDocumentDOMTreesRoot())continue}else if(v!==a)continue;v=E/k;s[r++]=v;l[v]|=n}for(;r;)for(v=s[--r],l[v]|=m,l[v]&=p,w=g[v],t=g[v+1];w<t;w+=d)a=h[w+c]/k,l[a]&q||h[w+e]===f||(s[r++]=a,l[a]|=n)},__proto__:WebInspector.HeapSnapshot.prototype};WebInspector.JSHeapSnapshotNode=function(a,b){WebInspector.HeapSnapshotNode.call(this,a,b)};
WebInspector.JSHeapSnapshotNode.prototype={canBeQueried:function(){return!!(this._snapshot._flagsOfNode(this)&this._snapshot._nodeFlags.canBeQueried)},isUserObject:function(){return!!(this._snapshot._flagsOfNode(this)&this._snapshot._nodeFlags.pageObject)},className:function(){var a=this.type();switch(a){case "hidden":return"(system)";case "object":case "native":return this.name();case "code":return"(compiled code)";default:return"("+a+")"}},classIndex:function(){var a=this._snapshot,b=a._nodes,c=
b[this.nodeIndex+a._nodeTypeOffset];return c===a._nodeObjectType||c===a._nodeNativeType?b[this.nodeIndex+a._nodeNameOffset]:-1-c},id:function(){var a=this._snapshot;return a._nodes[this.nodeIndex+a._nodeIdOffset]},isHidden:function(){return this._type()===this._snapshot._nodeHiddenType},isSynthetic:function(){return this._type()===this._snapshot._nodeSyntheticType},isWindow:function(){return/^Window/.test(this.name())},isDocumentDOMTreesRoot:function(){return this.isSynthetic()&&"(Document DOM trees)"===
this.name()},serialize:function(){var a=WebInspector.HeapSnapshotNode.prototype.serialize.call(this),b=this._snapshot._flagsOfNode(this);b&this._snapshot._nodeFlags.canBeQueried&&(a.canBeQueried=!0);b&this._snapshot._nodeFlags.detachedDOMTreeNode&&(a.detachedDOMTreeNode=!0);return a},__proto__:WebInspector.HeapSnapshotNode.prototype};WebInspector.JSHeapSnapshotEdge=function(a,b,c){WebInspector.HeapSnapshotEdge.call(this,a,b,c)};
WebInspector.JSHeapSnapshotEdge.prototype={clone:function(){return new WebInspector.JSHeapSnapshotEdge(this._snapshot,this._edges,this.edgeIndex)},hasStringName:function(){return this.isShortcut()?isNaN(parseInt(this._name(),10)):this._hasStringName()},isElement:function(){return this._type()===this._snapshot._edgeElementType},isHidden:function(){return this._type()===this._snapshot._edgeHiddenType},isWeak:function(){return this._type()===this._snapshot._edgeWeakType},isInternal:function(){return this._type()===
this._snapshot._edgeInternalType},isInvisible:function(){return this._type()===this._snapshot._edgeInvisibleType},isShortcut:function(){return this._type()===this._snapshot._edgeShortcutType},name:function(){if(!this.isShortcut())return this._name();var a=parseInt(this._name(),10);return isNaN(a)?this._name():a},toString:function(){var a=this.name();switch(this.type()){case "context":return"->"+a;case "element":return"["+a+"]";case "weak":return"[["+a+"]]";case "property":return-1===a.indexOf(" ")?
"."+a:'["'+a+'"]';case "shortcut":return"string"===typeof a?-1===a.indexOf(" ")?"."+a:'["'+a+'"]':"["+a+"]";case "internal":case "hidden":case "invisible":return"{"+a+"}"}return"?"+a+"?"},_hasStringName:function(){return!this.isElement()&&!this.isHidden()&&!this.isWeak()},_name:function(){return this._hasStringName()?this._snapshot._strings[this._nameOrIndex()]:this._nameOrIndex()},_nameOrIndex:function(){return this._edges.item(this.edgeIndex+this._snapshot._edgeNameOffset)},_type:function(){return this._edges.item(this.edgeIndex+
this._snapshot._edgeTypeOffset)},__proto__:WebInspector.HeapSnapshotEdge.prototype};WebInspector.JSHeapSnapshotRetainerEdge=function(a,b,c){WebInspector.HeapSnapshotRetainerEdge.call(this,a,b,c)};
WebInspector.JSHeapSnapshotRetainerEdge.prototype={clone:function(){return new WebInspector.JSHeapSnapshotRetainerEdge(this._snapshot,this._retainedNodeIndex,this.retainerIndex())},isHidden:function(){return this._edge().isHidden()},isInternal:function(){return this._edge().isInternal()},isInvisible:function(){return this._edge().isInvisible()},isShortcut:function(){return this._edge().isShortcut()},isWeak:function(){return this._edge().isWeak()},__proto__:WebInspector.HeapSnapshotRetainerEdge.prototype};
WebInspector.NativeHeapSnapshot=function(a){WebInspector.HeapSnapshot.call(this,a);this._nodeObjectType=this._metaNode.type_strings.object;this._edgeWeakType=this._metaNode.type_strings.weak;this._edgeElementType=this._metaNode.type_strings.property};
WebInspector.NativeHeapSnapshot.prototype={createNode:function(a){return new WebInspector.NativeHeapSnapshotNode(this,a)},createEdge:function(a,b){return new WebInspector.NativeHeapSnapshotEdge(this,a,b)},createRetainingEdge:function(a,b){return new WebInspector.NativeHeapSnapshotRetainerEdge(this,a,b)},_markInvisibleEdges:function(){},_calculateFlags:function(){},userObjectsMapAndFlag:function(){return null},images:function(){var a=this.aggregates(!1,"allObjects"),b=[];this._addNodes(a["WebCore::CachedImage"],
function(a){return a.name()},b);this._addNodes(a["WebCore::HTMLCanvasElement"],function(a){return"HTMLCanvasElement"},b);return b},_addNodes:function(a,b,c){if(a)for(var e=this.rootNode(),d=0;d<a.idxs.length;d++)e.nodeIndex=a.idxs[d],c.push({name:b(e),size:e.retainedSize()})},__proto__:WebInspector.HeapSnapshot.prototype};WebInspector.NativeHeapSnapshotNode=function(a,b){WebInspector.HeapSnapshotNode.call(this,a,b)};
WebInspector.NativeHeapSnapshotNode.prototype={className:function(){return this._snapshot._strings[this.classIndex()]},classIndex:function(){return this._snapshot._nodes[this.nodeIndex+this._snapshot._nodeTypeOffset]},id:function(){return this._snapshot._nodes[this.nodeIndex+this._snapshot._nodeIdOffset]},name:function(){return this._snapshot._strings[this._snapshot._nodes[this.nodeIndex+this._snapshot._nodeNameOffset]]},serialize:function(){return{id:this.id(),name:this.className(),displayName:this.name(),
distance:this.distance(),nodeIndex:this.nodeIndex,retainedSize:this.retainedSize(),selfSize:this.selfSize(),type:this._snapshot._nodeObjectType}},isHidden:function(){return!1},isSynthetic:function(){return!1},__proto__:WebInspector.HeapSnapshotNode.prototype};WebInspector.NativeHeapSnapshotEdge=function(a,b,c){WebInspector.HeapSnapshotEdge.call(this,a,b,c)};
WebInspector.NativeHeapSnapshotEdge.prototype={clone:function(){return new WebInspector.NativeHeapSnapshotEdge(this._snapshot,this._edges,this.edgeIndex)},hasStringName:function(){return!0},isHidden:function(){return!1},isWeak:function(){return!1},isInternal:function(){return!1},isInvisible:function(){return!1},isShortcut:function(){return!1},name:function(){return this._snapshot._strings[this._nameOrIndex()]},toString:function(){return"NativeHeapSnapshotEdge: "+this.name()},_nameOrIndex:function(){return this._edges.item(this.edgeIndex+
this._snapshot._edgeNameOffset)},__proto__:WebInspector.HeapSnapshotEdge.prototype};WebInspector.NativeHeapSnapshotRetainerEdge=function(a,b,c){WebInspector.HeapSnapshotRetainerEdge.call(this,a,b,c)};
WebInspector.NativeHeapSnapshotRetainerEdge.prototype={clone:function(){return new WebInspector.NativeHeapSnapshotRetainerEdge(this._snapshot,this._retainedNodeIndex,this.retainerIndex())},isHidden:function(){return this._edge().isHidden()},isInternal:function(){return this._edge().isInternal()},isInvisible:function(){return this._edge().isInvisible()},isShortcut:function(){return this._edge().isShortcut()},isWeak:function(){return this._edge().isWeak()},__proto__:WebInspector.HeapSnapshotRetainerEdge.prototype};
WebInspector.ProfileLauncherView=function(a){WebInspector.View.call(this);this._panel=a;this.element.addStyleClass("profile-launcher-view");this.element.addStyleClass("panel-enabler-view");this._contentElement=this.element.createChild("div","profile-launcher-view-content");this._innerContentElement=this._contentElement.createChild("div");this._controlButton=this._contentElement.createChild("button","control-profiling");this._controlButton.addEventListener("click",this._controlButtonClicked.bind(this),
!1)};
WebInspector.ProfileLauncherView.prototype={addProfileType:function(a){this._innerContentElement.createChild("h1").textContent=a.description;var b=a.decorationElement();b&&this._innerContentElement.appendChild(b);this._isInstantProfile=a.isInstantProfile()},_controlButtonClicked:function(){this._panel.toggleRecordButton()},_updateControls:function(){this._isInstantProfile?(this._controlButton.removeStyleClass("running"),this._controlButton.textContent=WebInspector.UIString("Take Snapshot")):this._isProfiling?
(this._controlButton.addStyleClass("running"),this._controlButton.textContent=WebInspector.UIString("Stop")):(this._controlButton.removeStyleClass("running"),this._controlButton.textContent=WebInspector.UIString("Start"))},profileStarted:function(){this._isProfiling=!0;this._updateControls()},profileFinished:function(){this._isProfiling=!1;this._updateControls()},__proto__:WebInspector.View.prototype};
WebInspector.MultiProfileLauncherView=function(a){WebInspector.ProfileLauncherView.call(this,a);this._innerContentElement.createChild("h1").textContent=WebInspector.UIString("Select profiling type");this._profileTypeSelectorForm=this._innerContentElement.createChild("form");this._innerContentElement.createChild("div","flexible-space")};WebInspector.MultiProfileLauncherView.EventTypes={ProfileTypeSelected:"profile-type-selected"};
WebInspector.MultiProfileLauncherView.prototype={addProfileType:function(a){var b=!this._profileTypeSelectorForm.children.length,c=this._profileTypeSelectorForm.createChild("label");c.textContent=a.name;var e=document.createElement("input");c.insertBefore(e,c.firstChild);e.type="radio";e.name="profile-type";e.style.hidden=!0;b&&(e.checked=b,this.dispatchEventToListeners(WebInspector.MultiProfileLauncherView.EventTypes.ProfileTypeSelected,a));e.addEventListener("change",this._profileTypeChanged.bind(this,
a),!1);c.createChild("p").textContent=a.description;(a=a.decorationElement())&&c.appendChild(a)},_controlButtonClicked:function(){this._panel.toggleRecordButton()},_updateControls:function(){WebInspector.ProfileLauncherView.prototype._updateControls.call(this);for(var a=this._profileTypeSelectorForm.elements,b=0;b<a.length;++b)"radio"===a[b].type&&(a[b].disabled=this._isProfiling)},_profileTypeChanged:function(a,b){this.dispatchEventToListeners(WebInspector.MultiProfileLauncherView.EventTypes.ProfileTypeSelected,
a);this._isInstantProfile=a.isInstantProfile();this._updateControls()},profileStarted:function(){this._isProfiling=!0;this._updateControls()},profileFinished:function(){this._isProfiling=!1;this._updateControls()},__proto__:WebInspector.ProfileLauncherView.prototype};WebInspector.TopDownProfileDataGridNode=function(a,b){WebInspector.ProfileDataGridNode.call(this,a,b,!(!a.children||!a.children.length));this._remainingChildren=a.children};
WebInspector.TopDownProfileDataGridNode.prototype={_sharedPopulate:function(){for(var a=this._remainingChildren,b=a.length,c=0;c<b;++c)this.appendChild(new WebInspector.TopDownProfileDataGridNode(a[c],this.tree));this._remainingChildren=null},_exclude:function(a){this._remainingChildren&&this.populate();this._save();for(var b=this.children,c=this.children.length;c--;)b[c]._exclude(a);(a=this.childrenByCallUID[a])&&this._merge(a,!0)},__proto__:WebInspector.ProfileDataGridNode.prototype};
WebInspector.TopDownProfileDataGridTree=function(a,b){WebInspector.ProfileDataGridTree.call(this,a,b);this._remainingChildren=b.children;WebInspector.TopDownProfileDataGridNode.prototype.populate.call(this)};
WebInspector.TopDownProfileDataGridTree.prototype={focus:function(a){a&&(this._save(),a.savePosition(),this.children=[a],this.totalTime=a.totalTime)},exclude:function(a){a&&(this._save(),WebInspector.TopDownProfileDataGridNode.prototype._exclude.call(this,a.callUID),this.lastComparator&&this.sort(this.lastComparator,!0))},restore:function(){this._savedChildren&&(this.children[0].restorePosition(),WebInspector.ProfileDataGridTree.prototype.restore.call(this))},_merge:WebInspector.TopDownProfileDataGridNode.prototype._merge,
_sharedPopulate:WebInspector.TopDownProfileDataGridNode.prototype._sharedPopulate,__proto__:WebInspector.ProfileDataGridTree.prototype};
WebInspector.CanvasProfileView=function(a){WebInspector.View.call(this);this.registerRequiredCSS("canvasProfiler.css");this._profile=a;this._traceLogId=a.traceLogId();this.element.addStyleClass("canvas-profile-view");this._linkifier=new WebInspector.Linkifier;this._splitView=new WebInspector.SplitView(!1,"canvasProfileViewSplitLocation",300);a=this._splitView.firstElement();a.id="canvas-replay-image-container";this._replayImageElement=a.createChild("image","canvas-replay-image");this._debugInfoElement=
a.createChild("div","canvas-debug-info hidden");this._spinnerIcon=a.createChild("img","canvas-spinner-icon hidden");var b=this._splitView.secondElement();a=b.createChild("div","status-bar");b=b.createChild("div","canvas-replay-log");this._createControlButton(a,"canvas-replay-first-step",WebInspector.UIString("First call."),this._onReplayFirstStepClick.bind(this));this._createControlButton(a,"canvas-replay-prev-step",WebInspector.UIString("Previous call."),this._onReplayStepClick.bind(this,!1));this._createControlButton(a,
"canvas-replay-next-step",WebInspector.UIString("Next call."),this._onReplayStepClick.bind(this,!0));this._createControlButton(a,"canvas-replay-prev-draw",WebInspector.UIString("Previous drawing call."),this._onReplayDrawingCallClick.bind(this,!1));this._createControlButton(a,"canvas-replay-next-draw",WebInspector.UIString("Next drawing call."),this._onReplayDrawingCallClick.bind(this,!0));this._createControlButton(a,"canvas-replay-last-step",WebInspector.UIString("Last call."),this._onReplayLastStepClick.bind(this));
this._replayContextSelector=new WebInspector.StatusBarComboBox(this._onReplayContextChanged.bind(this));this._replayContextSelector.createOption("<screenshot auto>",WebInspector.UIString("Show screenshot of the last replayed resource."),"");a.appendChild(this._replayContextSelector.element);this._replayContexts={};this._currentResourceStates={};a=[{title:"#",sortable:!0,width:"5%"},{title:WebInspector.UIString("Call"),sortable:!0,width:"75%",disclosure:!0},{title:WebInspector.UIString("Location"),
sortable:!0,width:"20%"}];this._logGrid=new WebInspector.DataGrid(a);this._logGrid.element.addStyleClass("fill");this._logGrid.show(b);this._logGrid.addEventListener(WebInspector.DataGrid.Events.SelectedNode,this._replayTraceLog.bind(this));this._splitView.show(this.element);this._requestTraceLog(0)};WebInspector.CanvasProfileView.TraceLogPollingInterval=500;
WebInspector.CanvasProfileView.prototype={dispose:function(){this._linkifier.reset()},statusBarItems:function(){return[]},get profile(){return this._profile},elementsToRestoreScrollPositionsFor:function(){return[this._logGrid.scrollContainer]},_createControlButton:function(a,b,c,e){a=a.createChild("button","status-bar-item");a.addStyleClass(b);a.title=c;a.createChild("img");a.addEventListener("click",e,!1)},_onReplayContextChanged:function(){function a(a,b){this._enableWaitIcon(!1);a||(this._currentResourceStates[b.id]=
b,this._replayContextSelector.selectedOption().value===b.id&&(this._replayImageElement.src=b.imageURL))}var b=this._replayContextSelector.selectedOption().value||"auto",c=this._currentResourceStates[b];c?this._replayImageElement.src=c.imageURL:(this._enableWaitIcon(!0),this._replayImageElement.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",CanvasAgent.getResourceState(this._traceLogId,b,a.bind(this)))},_onReplayStepClick:function(a){var b=this._logGrid.selectedNode;
b&&((a?b.traverseNextNode(!1):b.traversePreviousNode(!1))||b).revealAndSelect()},_onReplayDrawingCallClick:function(a){var b=this._logGrid.selectedNode;if(b){for(var c=b;c;){var e=a?c.nextSibling:c.previousSibling;if(e){if(c=e,c.hasChildren||c.call.isDrawingCall)break}else if(c=c.parent,!a)break}!c&&a?this._onReplayLastStepClick():(c||b).revealAndSelect()}},_onReplayFirstStepClick:function(){var a=this._logGrid.rootNode().children[0];a&&a.revealAndSelect()},_onReplayLastStepClick:function(){var a=
this._logGrid.rootNode().children.peekLast();if(a){for(;a.expanded;){var b=a.children.peekLast();if(!b)break;a=b}a.revealAndSelect()}},_enableWaitIcon:function(a){this._spinnerIcon.enableStyleClass("hidden",!a);this._debugInfoElement.enableStyleClass("hidden",a)},_replayTraceLog:function(){function a(a,d){delete this._pendingReplayTraceLogEvent;b!==this._selectedCallIndex()?this._replayTraceLog():(this._enableWaitIcon(!1),a||(this._currentResourceStates={},this._currentResourceStates.auto=d,this._currentResourceStates[d.id]=
d,this._debugInfoElement.textContent="Replay time: "+(Date.now()-c)+"ms",this._onReplayContextChanged()))}if(!this._pendingReplayTraceLogEvent){var b=this._selectedCallIndex();if(-1!==b&&b!==this._lastReplayCallIndex){this._lastReplayCallIndex=b;this._pendingReplayTraceLogEvent=!0;var c=Date.now();this._enableWaitIcon(!0);CanvasAgent.replayTraceLog(this._traceLogId,b,a.bind(this))}}},_didReceiveTraceLog:function(a,b){this._enableWaitIcon(!1);if(!a&&b){for(var c=[],e=b.calls,d=b.startOffset,f=0,g=
e.length;f<g;++f){var h=e[f];this._requestReplayContextInfo(h.contextId);h=this._createCallNode(d++,h);c.push(h)}this._appendCallNodes(c);b.alive?setTimeout(this._requestTraceLog.bind(this,d),WebInspector.CanvasProfileView.TraceLogPollingInterval):this._flattenSingleFrameNode();this._profile._updateCapturingStatus(b);this._onReplayLastStepClick()}},_requestTraceLog:function(a){this._enableWaitIcon(!0);CanvasAgent.getTraceLog(this._traceLogId,a,void 0,this._didReceiveTraceLog.bind(this))},_requestReplayContextInfo:function(a){function b(b,
e){b?delete this._replayContexts[a]:this._replayContextSelector.createOption(e.description,WebInspector.UIString("Show screenshot of this context's canvas."),a)}this._replayContexts[a]||(this._replayContexts[a]=!0,CanvasAgent.getResourceInfo(a,b.bind(this)))},_selectedCallIndex:function(){var a=this._logGrid.selectedNode;return a?this._peekLastRecursively(a).index:-1},_peekLastRecursively:function(a){for(var b;b=a.children.peekLast();)a=b;return a},_appendCallNodes:function(a){var b=this._logGrid.rootNode(),
c=b.children.peekLast();c&&this._peekLastRecursively(c).call.isFrameEndCall&&(c=null);for(var e=0,d=a.length;e<d;++e){c||(c={0:""},c[1]="Frame #"+(b.children.length+1),c[2]="",c=new WebInspector.DataGridNode(c),c.selectable=!0,b.appendChild(c));for(var f=e+1;f<d&&!a[f-1].call.isFrameEndCall;)++f;this._appendCallNodesToFrameNode(c,a,e,f);e=f-1;c=null}},_appendCallNodesToFrameNode:function(a,b,c,e){function d(){var b=g._drawCallGroupsCount||0,c={0:""};c[1]="Draw call group #"+(b+1);c[2]="";c=new WebInspector.DataGridNode(c);
c.selectable=!0;g._drawCallGroupsCount=b+1;a.appendChild(c);return c}function f(a){for(var b=0,c;(c=a.children[b])&&!c.call.isDrawingCall;)++b;c=d();for(var e;e=a.children[b+1];)c.appendChild(e);return c}var g=this,h=a.children.peekLast(),k=!1;if(h)for(var l=0,m=h.children.length;l<m;++l){if(h.children[l].call.isDrawingCall){k=!0;break}}else h=d();for(l=c;l<e;++l)c=b[l],h.appendChild(c),c.call.isDrawingCall&&(k?h=f(h):k=!0)},_createCallNode:function(a,b){var c={};c[0]=a+1;c[1]=b.functionName||"context."+
b.property;c[2]="";if(b.sourceURL){var e=Math.max(0,b.lineNumber-1)||0,d=Math.max(0,b.columnNumber-1)||0;c[2]=this._linkifier.linkifyLocation(b.sourceURL,e,d)}b.arguments?(e=b.arguments.map(function(a){return a.description}),c[1]+="("+e.join(", ")+")"):c[1]+=" = "+b.value.description;"undefined"!==typeof b.result&&(c[1]+=" => "+b.result.description);c=new WebInspector.DataGridNode(c);c.index=a;c.selectable=!0;c.call=b;return c},_flattenSingleFrameNode:function(){var a=this._logGrid.rootNode();if(1===
a.children.length){for(var b=a.children[0];b.children[0];)a.appendChild(b.children[0]);a.removeChild(b)}},__proto__:WebInspector.View.prototype};
WebInspector.CanvasProfileType=function(){WebInspector.ProfileType.call(this,WebInspector.CanvasProfileType.TypeId,WebInspector.UIString("Capture Canvas Frame"));this._nextProfileUid=1;this._recording=!1;this._lastProfileHeader=null;this._capturingModeSelector=new WebInspector.StatusBarComboBox(this._dispatchViewUpdatedEvent.bind(this));this._capturingModeSelector.element.title=WebInspector.UIString("Canvas capture mode.");this._capturingModeSelector.createOption(WebInspector.UIString("Single Frame"),
WebInspector.UIString("Capture a single canvas frame."),"");this._capturingModeSelector.createOption(WebInspector.UIString("Consecutive Frames"),WebInspector.UIString("Capture consecutive canvas frames."),"1");this._frameOptions={};this._framesWithCanvases={};this._frameSelector=new WebInspector.StatusBarComboBox(this._dispatchViewUpdatedEvent.bind(this));this._frameSelector.element.title=WebInspector.UIString("Frame containing the canvases to capture.");this._frameSelector.element.addStyleClass("hidden");
WebInspector.runtimeModel.contextLists().forEach(this._addFrame,this);WebInspector.runtimeModel.addEventListener(WebInspector.RuntimeModel.Events.FrameExecutionContextListAdded,this._frameAdded,this);WebInspector.runtimeModel.addEventListener(WebInspector.RuntimeModel.Events.FrameExecutionContextListRemoved,this._frameRemoved,this);this._decorationElement=document.createElement("div");this._decorationElement.addStyleClass("profile-canvas-decoration");this._decorationElement.addStyleClass("hidden");
this._decorationElement.textContent=WebInspector.UIString("There is an uninstrumented canvas on the page. Reload the page to instrument it.");var a=this._decorationElement.createChild("button");a.type="button";a.textContent=WebInspector.UIString("Reload");a.addEventListener("click",this._onReloadPageButtonClick.bind(this),!1);this._dispatcher=new WebInspector.CanvasDispatcher(this);CanvasAgent.enable(this._updateDecorationElement.bind(this));WebInspector.resourceTreeModel.addEventListener(WebInspector.ResourceTreeModel.EventTypes.MainFrameNavigated,
this._updateDecorationElement,this)};WebInspector.CanvasProfileType.TypeId="CANVAS_PROFILE";
WebInspector.CanvasProfileType.prototype={statusBarItems:function(){return[this._capturingModeSelector.element,this._frameSelector.element]},get buttonTooltip(){return this._isSingleFrameMode()?WebInspector.UIString("Capture next canvas frame."):this._recording?WebInspector.UIString("Stop capturing canvas frames."):WebInspector.UIString("Start capturing canvas frames.")},buttonClicked:function(){this._recording?(this._recording=!1,this._stopFrameCapturing()):this._isSingleFrameMode()?(this._recording=
!1,this._runSingleFrameCapturing()):(this._recording=!0,this._startFrameCapturing());return this._recording},_runSingleFrameCapturing:function(){var a=this._selectedFrameId();CanvasAgent.captureFrame(a,this._didStartCapturingFrame.bind(this,a))},_startFrameCapturing:function(){var a=this._selectedFrameId();CanvasAgent.startCapturing(a,this._didStartCapturingFrame.bind(this,a))},_stopFrameCapturing:function(){function a(){b._updateCapturingStatus()}if(this._lastProfileHeader){var b=this._lastProfileHeader,
c=b.traceLogId();this._lastProfileHeader=null;CanvasAgent.stopCapturing(c,a.bind(this))}},_didStartCapturingFrame:function(a,b,c){b||this._lastProfileHeader&&this._lastProfileHeader.traceLogId()===c||(a=new WebInspector.CanvasProfileHeader(this,WebInspector.UIString("Trace Log %d",this._nextProfileUid),this._nextProfileUid,c,a),++this._nextProfileUid,this._lastProfileHeader=a,this.addProfile(a),a._updateCapturingStatus())},get treeItemTitle(){return WebInspector.UIString("CANVAS PROFILE")},get description(){return WebInspector.UIString("Canvas calls instrumentation")},
decorationElement:function(){return this._decorationElement},_reset:function(){WebInspector.ProfileType.prototype._reset.call(this);this._nextProfileUid=1},removeProfile:function(a){WebInspector.ProfileType.prototype.removeProfile.call(this,a);this._recording&&a===this._lastProfileHeader&&(this._recording=!1)},setRecordingProfile:function(a){this._recording=a},createTemporaryProfile:function(a){a=a||WebInspector.UIString("Capturing\u2026");return new WebInspector.CanvasProfileHeader(this,a)},createProfile:function(a){return new WebInspector.CanvasProfileHeader(this,
a.title,-1)},_updateDecorationElement:function(){CanvasAgent.hasUninstrumentedCanvases(function(a,b){this._decorationElement.enableStyleClass("hidden",a||!b)}.bind(this))},_onReloadPageButtonClick:function(a){PageAgent.reload(a.shiftKey)},_isSingleFrameMode:function(){return!this._capturingModeSelector.selectedOption().value},_frameAdded:function(a){this._addFrame(a.data)},_addFrame:function(a){var b=a.frameId,c=document.createElement("option");c.text=a.displayName;c.title=a.url;c.value=b;this._frameOptions[b]=
c;this._framesWithCanvases[b]&&(this._frameSelector.addOption(c),this._dispatchViewUpdatedEvent())},_frameRemoved:function(a){a=a.data.frameId;var b=this._frameOptions[a];b&&this._framesWithCanvases[a]&&(this._frameSelector.removeOption(b),this._dispatchViewUpdatedEvent());delete this._frameOptions[a];delete this._framesWithCanvases[a]},_contextCreated:function(a){!this._framesWithCanvases[a]&&(this._framesWithCanvases[a]=!0,a=this._frameOptions[a])&&(this._frameSelector.addOption(a),this._dispatchViewUpdatedEvent())},
_traceLogsRemoved:function(a,b){for(var c=[],e=this.treeElement&&this.treeElement.children||[],d=0,f=e.length;d<f;++d){var g=e[d].profile;g&&(a&&a!==g.frameId()||b&&b!==g.traceLogId()||c.push(e[d]))}d=0;for(f=c.length;d<f;++d)c[d].ondelete()},_selectedFrameId:function(){var a=this._frameSelector.selectedOption();return a?a.value:void 0},_dispatchViewUpdatedEvent:function(){this._frameSelector.element.enableStyleClass("hidden",1>=this._frameSelector.size());this.dispatchEventToListeners(WebInspector.ProfileType.Events.ViewUpdated)},
__proto__:WebInspector.ProfileType.prototype};WebInspector.CanvasDispatcher=function(a){this._profileType=a;InspectorBackend.registerCanvasDispatcher(this)};WebInspector.CanvasDispatcher.prototype={contextCreated:function(a){this._profileType._contextCreated(a)},traceLogsRemoved:function(a,b){this._profileType._traceLogsRemoved(a,b)}};
WebInspector.CanvasProfileHeader=function(a,b,c,e,d){WebInspector.ProfileHeader.call(this,a,b,c);this._traceLogId=e||"";this._frameId=d;this._alive=!0;this._traceLogSize=0};
WebInspector.CanvasProfileHeader.prototype={traceLogId:function(){return this._traceLogId},frameId:function(){return this._frameId},createSidebarTreeElement:function(){return new WebInspector.ProfileSidebarTreeElement(this,WebInspector.UIString("Trace Log %d"),"profile-sidebar-tree-item")},createView:function(a){return new WebInspector.CanvasProfileView(this)},dispose:function(){this._traceLogId&&(CanvasAgent.dropTraceLog(this._traceLogId),clearTimeout(this._requestStatusTimer),this._alive=!1)},_updateCapturingStatus:function(a){this.sidebarElement&&
this._traceLogId&&(a&&(this._alive=a.alive,this._traceLogSize=a.totalAvailableCalls),this.sidebarElement.subtitle=this._alive?WebInspector.UIString("Capturing\u2026 %d calls",this._traceLogSize):WebInspector.UIString("Captured %d calls",this._traceLogSize),this.sidebarElement.wait=this._alive)&&(clearTimeout(this._requestStatusTimer),this._requestStatusTimer=setTimeout(this._requestCapturingStatus.bind(this),WebInspector.CanvasProfileView.TraceLogPollingInterval))},_requestCapturingStatus:function(){CanvasAgent.getTraceLog(this._traceLogId,
0,0,function(a,b){a||(this._alive=b.alive,this._traceLogSize=b.totalAvailableCalls,this._updateCapturingStatus())}.bind(this))},__proto__:WebInspector.ProfileHeader.prototype};
